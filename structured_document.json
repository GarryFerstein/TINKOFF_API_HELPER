[
  {
    "h1": "Общие сведения",
    "h2": "Что такое TINKOFF INVEST API",
    "fragment": "TINKOFF INVEST API — это gRPC-интерфейс для взаимодействия с торговой платформой Тинькофф Инвестиции. TINKOFF INVEST API позволяет вам: выставлять все виды торговых поручений на биржи (лимитные, рыночные, стоп-заявки); получать рыночные данные (в том числе исторические) как в виде стриминга, так и unary-запросами; получать информацию по своему портфелю и его доходности; проверять алгоритмы торговли на исторических данных (механизм проверки теорий разрабатывается клиентом самостоятельно). Для использования TINKOFF INVEST API требуется: ознакомиться с идентификаторами торговых инструментов выбрать подходящий протокол взаимодействия и язык программирования (для некоторых разработаны SDK для упрощения разработки: Python, Java, С#, Golang) изучить полезную информацию изучить термины и параметры, используемые в методах TINKOFF INVEST API - Глоссарий посмотреть описание сервисов TINKOFF INVEST API и ответы на часто задаваемые вопросы в раздела FAQ каждого сервиса быть клиентом Тинькофф Инвестиций; получить токен доступа. Подробнее о протоколе взаимодействия"
  },
  {
    "h1": "Общие сведения",
    "h2": "Адреса сервиса TINKOFF INVEST API",
    "fragment": "Все вызовы продового сервиса выполняются по адресу invest-public-api.tinkoff.ru:443. Все вызовы сервиса песочницы выполняются по адресу sandbox-invest-public-api.tinkoff.ru:443. Различия работы контуров описаны на странице."
  },
  {
    "h1": "Общие сведения",
    "h2": "Protobuf-файлы сервиса",
    "fragment": "Скачать полный список прото-контрактов сервиса можно по ссылке: TINKOFF INVEST API"
  },
  {
    "h1": "Общие сведения",
    "h2": "SDK для разработки с использованием Public API",
    "fragment": "Для упрощения разработки торгового робота разработан ряд официальных и неофициальных SDK для нескольких языков программирования. Python Java C# Все данные предоставляемые Tinkoff Invest API являются бесплатными"
  },
  {
    "h1": "Глоссарий",
    "h2": "Список глоссариев по сервисам",
    "fragment": "Голоссарий списков инструментов"
  },
  {
    "h1": "Глоссарий",
    "h2": "Термины биржевой торговли",
    "fragment": "Ценные бумаги — это акции, облигации, еврооблигации, паи, акции фондов и т.п. Более подробную информацию можно получить по ссылке: Ценные бумаги. Лот (лотность) — это минимальное количество ценных бумаг одной компании, доступных для покупки. Обычно акции торгуются крупными лотами: по 10, 100 или даже 1000 акций в одном лоте. У облигаций и ETF один лот равен одной ценной бумаге. Все операции с ценными бумагами должны быть кратны установленной лотности. Акция — это доля в компании. Покупая акцию, инвестор становится совладельцем компании, получает права на часть ее прибыли и участие в ее управлении. Акция. Облигация — это долговая ценная бумага, почти как долговая расписка. Выпуская облигации, компания или государство берет деньги в долг и затем возвращает их с процентами. Облигация. Oпцион - это контракты, которые предусматривают право покупателя опциона купить или продать базовый актив в указанный период и по определенной цене. Здесь важно, что покупатель получает именно право, а не обязанность, — это ключевое отличие опциона от фьючерса."
  },
  {
    "h1": "Глоссарий",
    "h2": "Термины алгоритмической биржевой торговли. Опцион",
    "fragment": "Биржевой фонд — это набор имущества, который можно купить и продать на бирже. Чаще всего имуществом фондов являются акции или облигации. ETF. Фьючерс — это договор между покупателем и продавцом о поставке базового актива в будущем или о выплате одной из сторон другой стороне разницы между стоимостью контракта и стоимостью базового актива в будущем. Срочный рынок. Купон, или купонный доход — это процентные выплаты держателям облигаций со стороны эмитента, то есть компании или госоргана, выпустивших этот тип ценных бумаг. Даты выплат процентов по облигациям и размер купона известны заранее. Размер купона задается в процентах от номинала — то есть от цены облигации при ее выпуске. Величина купона может быть фиксированной или плавающей — то есть привязанной к инфляции, ключевой ставке Центробанка России или другим ориентирам. Иногда у облигации может вовсе не быть купона. Купонный доход по облигациям. Маржинальная торговля — режим торговли, в котором можно совершать сделки не только со своими деньгами и ценными бумагами, но и с активами, которые вы как бы берете взаймы у брокера. Маржинальная торговля. Маржинальная торговля в лонг — вид маржинальной торговли, когда ставка трейдера делается на рост цены в будущем. Маржинальная торговля в лонг. Маржинальная торговля в шорт — вид маржинальной торговли, когда ставка трейдера делается на снижение цены в будущем. Маржинальная торговля в шорт. Маржин-колл — это состояние ликвидного портфеля, когда его стоимость опускается ниже минимальной маржи. После этого в любой момент брокер может принудительно закрыть часть позиций за счет активов на вашем брокерском счете или ИИС, чтобы стоимость ликвидного портфеля не упала до нуля и не ушла в минус. Маржин-колл. Квалифицированный инвестор — инвестор, подтвердивший свой опыт, профессиональную квалификацию или финансовые возможности. В Тинькофф Инвестициях без статуса квалифицированного инвестора можно торговать ценными бумагами российских компаний, биржевыми фондами, фьючерсами и валютой на Московской бирже, а также бумагами некоторых иностранных компаний на Санкт-Петербургской бирже. Квалифицированный инвестор. Биржевая заявка (ордер, приказ) — это специальный торговый приказ, который помогает купить или продать нужное количество лотов по определенной цене. Биржевые заявки. Ликвидность — ликвидность ценной бумаги обычно оценивают по количеству совершаемых сделок (объём торгов) и величине спреда — разницы между максимальными ценами заявок на покупку и минимальными ценами заявок на продажу (их можно увидеть в биржевом стакане). Чем больше сделок и меньше разница, тем больше ликвидность. Пул ликвидности — секция биржи, в рамках которой исполнение заявки происходит изолированно от другой секции. Например, на Санкт-Петербургской бирже есть 2 пула ликвидности: внутренний и внешний. Внешний пул ликвидности подключается к торгам в 14:30 по МСК (летнее время). Подробнее о пулах ликвидности Санкт-Петербургской биржи: Описание рынка. Об особенностях работы с пулами ликвидности можно узнать по ссылке: Работа с заявками в TINKOFF INVEST API Спред — разность между лучшими ценами заявок на продажу (аск) и на покупку (бид) в один и тот же момент времени на какой-либо актив. Лимитная заявка — это указание брокеру, какую бумагу или валюту, сколько лотов и по какой цене вы хотите купить или продать. Лимитные заявки попадают в биржевой стакан и ожидают исполнения по указанным ценам (появления встречной заявки по такой же цене). Лимитная заявка Рыночная заявка — это заявка на покупку или продажу активов по той цене, что есть на бирже в данный момент. Рыночные заявки исполняются по текущим ценам рынка (при наличии встречных предложений). Рыночная заявка Биржевой стакан — это список активных лимитных заявок по инструменту на данный момент. В стакане отображаются как заявки на покупку, так и заявки на продажу. Рыночные заявки не попадают в стакан по причине их немедленного исполнения. Биржевой стакан Японская свеча — это визуальное отображение цены открытия, закрытия, а также максимума и минимума за определенный промежуток времени (минута, час, день). Свечи формируются по совершённым сделкам и позволяют отслеживать изменения цены. Алготрейдинг — тип биржевой торговли, основанный на программных алгоритмах и принципах автоматизации процесса выставления и отмены торговых поручений. Торговый робот — реализованный алгоритм, автоматизирующий торговлю на бирже. Роботы могут отличаться по методам реализации и целям, однако в основе всех них лежит принцип минимизации участия человека в процессе. Токен — это специальный набор символов, представляющий собой зашифрованную информацию о владельце, уровне прав доступа и прочей необходимой для авторизации в TINKOFF INVEST API информации. Токен TINKOFF INVEST API. SDK — набор средств разработки, предоставляющий разработчику торгового робота библиотеку взаимодействия с TINKOFF INVEST API. Главной целью разработки SDK является значительное упрощение разработки торгового алгоритма. Список SDK TINKOFF INVEST API. correctedMargin (скорректированная маржа) - начальная маржа, в которой плановые позиции рассчитываются с учётом активных заявок на покупку позиций лонг или продажу позиций шорт."
  },
  {
    "h1": "Лимитная политика TINKOFF INVEST API",
    "h2": "Без подзаголовка",
    "fragment": "В процессе работы торговые роботы могут генерировать огромное количество заявок. Причём особенностью именно алгоритмической торговли можно назвать большой процент отмен заявок. Таким образом пользователи могут генерировать большую нагрузку на инфраструктуру брокера. По этой причине TINKOFF INVEST API обладает системой динамического формирования лимитов для пользователей. Важно Значение лимита конкретного сервиса включает в себя суммарное количество допустимых запросов по всем методам этого сервиса. Важно Лимитная политика распространяется на все аккаунты (cчета) пользователя. Таблица лимитов Unary-методов Всего существует 5 уровней доступа, которые зависят от количества выставленных заявок (любого типа) и процента их исполнения: Важно В рамках одного stream-соединения сервиса котировок существует ограничение в 300 одновременных подписок на свечи, стаканы и ленту обезличенных сделок. Лимит считается суммарно по всем трём типам данных. Лимитов на количество подписок в рамках одного стрима на торговые статусы инструментов (подписка Info) нет. Важно В методе Запрос тарифа пользователя лимиты для стрим соединений могут возвращаться на 1 больше, это сделано на балансировщике для того, чтобы вы могли переподключить стримы, поэтому мы не рекомендуем использовать максимальное количество из лимита. Важно При превышении лимита клиент получит соответствующую ошибку. Превышение лимита не произойдет, если количество запросов в минуту с IP-адреса клиента не превышает 1000 запросов. Если вы подозреваете, что ваш IP-адрес забанили - обратитесь к нам в поддержку или в Telegram-чат по общим вопросам. Счетчик количества стрим соединений обновляется каждые 2 минуты. Изменения лимитного грейда пользователя происходит раз в сутки после окончания торгов. Для изменения грейда берётся статистика заявок, выполненных пользователем за последние 30 дней от текущей даты. Т.е. чем больше пользователь выставляет заявок при сохранении высокого уровня исполнения, тем выше его лимиты. Стоит дополнительно отметить, что лимита на количество активных заявок нет. Расчёт лимитных грейдов происходит только для пользователей TINKOFF INVEST API, выставлявших заявки. Поэтому, если вы не используете данную версию апи для выставления заявок, у вас будет грейд 1. Для того чтобы расчёт грейда происходил, нужно выставить хотя бы одну заявку в месяц."
  },
  {
    "h1": "Токен для работы с TINKOFF INVEST API",
    "h2": "Без подзаголовка",
    "fragment": "Токен – это набор символов, в котором зашифрована информация о владельце, правах доступа и прочей необходимой для авторизации в TINKOFF INVEST API информации. В процессе работы с TINKOFF INVEST API токен следует передавать в metadata каждого unary-запроса, а также в запросах на установление всех видов stream-соединений. Работа с TINKOFF INVEST API без выпуска и использования токена невозможна."
  },
  {
    "h1": "Токен для работы с TINKOFF INVEST API",
    "h2": "Виды токенов",
    "fragment": "В TINKOFF INVEST API существует несколько видов токенов с разным набором доступных прав — вы можете выпустить несколько токенов для решения разных задач алгоритмической торговли или мониторинга рынка ценных бумаг. Readonly token — данный тип токена предназначен только для получения различной информации, такой как состояние портфеля, расписание торгов различных торговых площадок, текущие котировки, исторические данные и т.п. С данным типом токена невозможно выставление торговых поручений. Full-access token — с данным типом токена доступно выполнение всех методов TINKOFF INVEST API. Это основной тип токена для реальной работы с TINKOFF INVEST API. Токен с доступом к конкретному счёту — данный вид токена позволяет получить доступ только к одному конкретному счёту пользователя. Уровень прав доступа (readonly, full-access) при этом так же можно настроить. Sandbox token – токен для работы с песочницей. Песочница – это эмуляция работы торговых площадок, основанная на реальных данных, но не ведущая к изменению состава портфеля или баланса вашего счёта. Данный тип токена предназначен в первую очередь для тестирования вашего робота и проверки работоспособности всех алгоритмов."
  },
  {
    "h1": "Токен для работы с TINKOFF INVEST API",
    "h2": "Получение токена",
    "fragment": "Перейдите в настройки профиля Тинькофф Инвестиции по ссылке: https://www.tinkoff.ru/invest/settings/ Авторизуйтесь в системе, если это требуется. Функция \"Подтверждение сделок кодом\" должна быть отключена. Обратите внимание, что сделки на сумму выше 6 000 000 рублей или $100 000, или €100 000 требуют подтверждения, т.е. будут недоступны через API. Выпустите токен TINKOFF INVEST API для биржи и/или Sandbox. Возможно, система попросит вас авторизоваться еще раз. Не беспокойтесь, это необходимо для подключения робота к торговой платформе. Скопируйте токен и сохраните его. Токен отображается только один раз, просмотреть его позже не получится. Тем не менее вы можете выпускать неограниченное количество токенов."
  },
  {
    "h1": "Токен для работы с TINKOFF INVEST API",
    "h2": "Срок жизни токена",
    "fragment": "Срок жизни токена составляет три месяца с даты последнего использования. Убедитесь, что ваши обращения выполняются с актуальным токеном. Если была получена ошибка 40003, то это значит, что токен перестал быть актуальным. Токен может перестать быть актуальным в следующих случаях: Пользователь перестал быть клиентом Тинькофф; Пользователь завершил активные сессии для всех устройств; Блокировка аккаунта пользователя; Блокировка карты пользователя; Осуществлен отзыв токенов."
  },
  {
    "h1": "Токен для работы с TINKOFF INVEST API",
    "h2": "Отзыв токена",
    "fragment": "Отозвать токен TINKOFF INVEST API можно на странице https://id.tinkoff.ru/account."
  },
  {
    "h1": "Токен для работы с TINKOFF INVEST API",
    "h2": "Невалидный токен",
    "fragment": "В случае использования невалидного токена Вы получите ошибку: \"code\": \"40003\" \"message\": \"authentication token is missing or invalid\""
  },
  {
    "h1": "Токен для работы с TINKOFF INVEST API",
    "h2": "Использование токена песочницы",
    "fragment": "Токен песочницы можно использовать только для сервиса песочницы. В случае использования sandbox-токена для обычных методов и стримов, будет возвращена ошибка."
  },
  {
    "h1": "Идентификация торговых инструментов",
    "h2": "Без подзаголовка",
    "fragment": "Для точного определения различных торговых инструментов используются различные идентификаторы: Isin(англ.: International Security Identification Number) — международный идентификационный номер ценной бумаги, состоит из 12 символов цифр и латинских букв, которые начинаются, как правило, с 2-буквенного кода страны эмитента ценной бумаги. Структура ISIN: Первые два символа — буквы, определяющие код страны эмитента согласно стандарту ISO 3166-1 (например, российские ISIN-коды начинаются буквами RU). Далее следуют 9 букв и цифр национального идентификационного кода ценной бумаги (англ. National Securities Identifying Number, NSIN). Завершает код контрольная цифра. Например, ISIN акции TCS Group — US87238U2033. Ticker — краткое (1-5 букв) наименование ценной бумаги на конкретной бирже. Без указания биржи и режима торгов, по сути, является бессмысленным набором букв. Для этого на российских биржах MOEX и SPBE используется специальный признак \"Режим торгов\", который соответствует техническому термину \"class_сode\". Комбинация тикера и \"class_code\" является уникальным идентификатором. Отдельно же, только тикер, - нет. Например, тикер TCS Group Tinkoff - TCSG. FIGI(англ.: Financial Instrument Global Identifier) — глобальный идентификатор финансового инструмента. Представляет собой 12-символьный код из латинских букв и цифр, определяется как идентификатор ценной бумаги на торговой площадке (бирже), которая является некоторым \"источником цен\". Важно: не всегда FIGI, присваемые в Тинькофф Инвестициях, совпадают с международным классификатором. Является устаревшим параметром и не рекомендуется к использованию."
  },
  {
    "h1": "Идентификация торговых инструментов",
    "h2": "Идентификаторы из модели финансовых инструментов Тинькофф Инвестиций",
    "fragment": "В Тинькофф Инвестициях применяется иерархическая система идентификации финансовых объектов. На верхнем уровне находится актив - это по сути работающая на финансовом рынке компания, являющаяся эмитентом ценных бумаг. Примером актива может быть например Сбербанк. У актива может несколько финансовых инструментов: акции (в т.ч. на разных биржах), облигации и т.д., каждая из подобных ценных бумаг называется позиция. То есть Позиция - это совокупность актива, типа и торговой площадки(биржи). Но одна и та же позиция может торговаться в разных режимах торгов и по разной цене: например: валюта разной лотности может иметь различную стоимость; или акцию можно продать за биржевом рынке, так и на внебиржевом (в торговле на выходных). Поэтому есть еще один идентификатор - торговый инструмент - он определяется как ценная бумага на торговой площадке (бирже) в указанном режиме торгов. Получить котировки можно только по торговому инструменту. Подведем итоги, идентификатор актива - это asset_uid идентификатор позиции - это position_uid идентификатор торгового инструмента - это instrument_uid Для удобства клиентов, использовавших в своих системах устаревший идентификатор FIGI в многих методах API Тинькофф предусмотрено универсальное поле Instrument_Id - в которое можно передавать как FIGI, так и instrument_uid. Вы можете получить идентификаторы конкретного инструмента с помощью метода FindInstrument, передав в параметр query известный идентификатор или название инструмента. Использование Instrument_Id является более предпочтительным, так как предполагает возможность использования instrument_uid или FIGI. На данный момент при передаче значения в параметр Instrument_Id сначала выполняется поиск инструмента по instrument_uid, а потом уже по FIGI. Основным идентификатором торгового инструмента при работе с TINKOFF INVEST API является UID, так как, например, в опционах идентификатор FIGI не поддерживается"
  },
  {
    "h1": "Нестандартные типы данных TINKOFF INVEST API",
    "h2": "Timestamp",
    "fragment": "Тип данных Timestamp является основным для передачи времени в формате protoсol-buffers и представляет собой значение в диапазоне интервала дат от 0001-01-01T00:00:00Z до 9999-12-31T23:59:59.999999999Z Timestamp всегда работает в формате UTC с нулевым смещением. Тип Timestamp состоит из двух полей целого типа: seconds и nanos. Seconds содержит количество секунд с полуночи (00:00:00) 01.01.1970, а nanos принимает значение от 0 до 999999999. Примеры timestamp { //Пример конвертации из POSIX функции time() Timestamp timestamp; timestamp.set_seconds(time(NULL)); timestamp.set_nanos(0); } { //Пример конвертации из POSIX функции gettimeofday() struct timeval tv; gettimeofday(&tv, NULL); Timestamp timestamp; timestamp.set_seconds(tv.tv_sec); timestamp.set_nanos(tv.tv_usec * 1000); } { //Пример конвертации из Windows функции GetSystemTimeAsFileTime() FILETIME ft; GetSystemTimeAsFileTime(&ft); UINT64 ticks = (((UINT64)ft.dwHighDateTime) << 32) | ft.dwLowDateTime; // A Windows tick is 100 nanoseconds. Windows epoch 1601-01-01T00:00:00Z // is 11644473600 seconds before Unix epoch 1970-01-01T00:00:00Z. Timestamp timestamp; timestamp.set_seconds((INT64) ((ticks / 10000000) - 11644473600LL)); timestamp.set_nanos((INT32) ((ticks % 10000000) * 100)); }"
  },
  {
    "h1": "Нестандартные типы данных TINKOFF INVEST API",
    "h2": "MoneyValue",
    "fragment": "Данный тип данных используется для параметров, имеющих денежный эквивалент. Например, стоимость ценных бумаг. Тип состоит из трёх параметров: currency — строковый ISO-код валюты. Например, RUB или USD. units — целая часть суммы. nano — дробная часть суммы (миллиардные доли). Для корректной работы с данным типом данных требуется его конвертация в стандартные типы языка программирования, который используется для написания торгового робота. Пример конвертации на Java { //MoneyValue - конвертация из BigDecimal в MoneyValue и обратно BigDecimal value = new BigDecimal(\"123.456\"); String currency = \"RUB\"; MoneyValue moneyValue = MoneyValue.newBuilder() .setCurrency(currency) .setUnits(value != null ? value.longValue() : 0) .setNano(value != null ? value.remainder(BigDecimal.ONE).multiply(BigDecimal.valueOf(1_000_000_000)).intValue() : 0) .build(); BigDecimal bigDecimal = moneyValue.getUnits() == 0 && moneyValue.getNano() == 0 ? BigDecimal.ZERO : BigDecimal.valueOf(moneyValue.getUnits()).add(BigDecimal.valueOf(moneyValue.getNano(), 9)); } Примеры конвертированных значений"
  },
  {
    "h1": "Нестандартные типы данных TINKOFF INVEST API",
    "h2": "Quotation",
    "fragment": "Данный тип данных аналогичен MoneyValue с той лишь разницей, что в нём не содержится информации о валюте. units — целая часть суммы. nano — дробная часть суммы. Пример конвертации на Java { //Пример конвертации из BigDecimal в Quotation и обратно BigDecimal value = new BigDecimal(\"123.456\"); Quotation quotation = Quotation.newBuilder() .setUnits(value != null ? value.longValue() : 0) .setNano(value != null ? value.remainder(BigDecimal.ONE).multiply(BigDecimal.valueOf(1_000_000_000)).intValue() : 0) .build(); BigDecimal bigDecimal = quotation.getUnits() == 0 && quotation.getNano() == 0 ? BigDecimal.ZERO : BigDecimal.valueOf(quotation.getUnits()).add(BigDecimal.valueOf(quotation.getNano(), 9)); } Примеры конвертированных значений"
  },
  {
    "h1": "Торговые статусы инструментов и расписание торгов",
    "h2": "Без подзаголовка",
    "fragment": "Рекомендуем смотреть актуальную информацию по режимам и статусам торгов на сайтах Московской биржи и СПБ биржи. Получить актуальный торговый статус инструмента можно методом GetTradingStatus или подпиской Info в рамках stream-соединения сервиса котировок. В зависимости от торгового статуса определяется возможность выставления торговых поручений определённого типа:"
  },
  {
    "h1": "Торговые статусы инструментов и расписание торгов",
    "h2": "Описание торговых статусов",
    "fragment": "UNSPECIFIED — служебное значение торгового статуса. Устанавливается, если от биржи пришёл неизвестный торговый статус инструмента. NOT_AVAILABLE_FOR_TRADING — торговля инструментом недоступна. Данный статус возвращается, когда торги по инструменту недоступны. Например, при закрытии торговой площадки. OPENING_PERIOD — период открытия торгов (премаркет). По инструменту происходит аукцион открытия. Это особый режим торгов, когда биржа собирает заявки на покупку/продажу в биржевой стакан. По результатам аукциона открытия при помощи специального алгоритма биржи определяется цена открытия торгов основной сессии. В данном режиме торгов доступно выставление только лимитных поручений. CLOSING_PERIOD — период закрытия торгов (постмаркет). По инструменту происходит аукцион закрытия. Это режим торгов, когда биржа собирается заявки для определения цены закрытия сессии. Доступны только лимитные заявки. BREAK_IN_TRADING — перерыв в торговле инструментов. Перерыв в торгах по конкретным или всем инструментам биржа может устанавливать по разным причинам. Например, технические сбои или высокая волатильность на рынке. В данном статусе недоступно выставление поручений по инструменту. NORMAL_TRADING — нормальный режим торгов по инструменту. В данном режиме доступны все виды поручений. CLOSING_AUCTION — то же, что и CLOSING_PERIOD. DARK_POOL_AUCTION — режим торгов крупными пакетами (Dark Pool). Это режим торгов со скрытым стаканом для заключения крупных сделок. Торги проходят в формате непрерывного заключения сделок (при наличии встречных заявок) по Цене аукциона. Цена аукциона определяется перед его началом на основе заявок в Режиме основных торгов. В данном режиме доступно выставление только рыночных торговых поручений с ограничением на минимальный объём заявки. DISCRETE_AUCTION — дискретный аукцион. Особый режим, который применяется вместо перерыва в торгах в моменты высокой волатильности рынков. В данном режиме возможно выставление только лимитных заявок, исполнение сделок не происходит до момента возобновления торгов. Отсутствуют механизмы расчёта \"рыночной цены\". OPENING_AUCTION_PERIOD — то же, что и OPENING_PERIOD. TRADING_AT_CLOSING_AUCTION_PRICE — режим торгов по цене аукциона закрытия. В данном режиме возможно выставление рыночных заявок и лимитных заявок с ценой аукциона закрытия. Все заявки во время данного режима исполняются по цене аукциона закрытия (при наличии встречных предложений). SESSION_ASSIGNED — торговая сессия назначена. Технический статус, время клиринга. В данном режиме выставление всех видов торговых поручений недоступно. SESSION_CLOSE — сессия закрыта, торговля инструментом недоступна (для опционов и фьючерсов на московской бирже). SESSION_OPEN — сессия открыта, торговля инструментом доступна (для опционов и фьючерсов на московской бирже). DEALER_NORMAL_TRADING — торги в режиме внутренней ликвидности брокера. Данный статус устанавливается брокером (Тинькофф Инвестиции) во время торговли по выходным. В этом режиме недоступно выставление лимитных заявок. Исполняются только рыночные заявки по цене, сформированной по алгоритмам брокера (при наличии встречных предложений). DEALER_BREAK_IN_TRADING — перерыв в торгах в режиме внутренней ликвидности брокера. Выставление торговых поручений недоступно. DEALER_NOT_AVAILABLE_FOR_TRADING — то же, что и NOT_AVAILABLE_FOR_TRADING."
  },
  {
    "h1": "Загрузка исторических котировок",
    "h2": "Без подзаголовка",
    "fragment": "TINKOFF INVEST API предоставляет своим пользователям возможность получения исторических рыночных данных по инструментам. Для загрузки истории котировок можно воспользоваться unary-методом GetCandles сервиса котировок. Обратите внимание, что дата начала истории по одному и тому же инструменту может отличаться на разных интервалах свечей. Также глубина исторических данных может быть разной для разных инструментов. Связано это с особенностями получения исторических данных в Тинькофф Инвестициях. С целью сокращения нагрузки на инфраструктуру системы в TINKOFF INVEST API имеется ограничение на максимальную длину запрашиваемого интервала. Ограничение зависит от интервала свечи: Для получения информации о дате начала истории добавлены параметры first_1min_candle_date и first_1day_candle_date в методах сервиса инструментов. Так же для получения исторических данных за год можно воспользоваться информацией со страницы GetHistory. Архивы с историческими данными можно получить как за один инструмент, так и по списку инструментов, воспользовавшись специально подготовленным скриптом."
  },
  {
    "h1": "Алгоритм и особенности исполнения торговых поручений",
    "h2": "Выставление торговых поручений",
    "fragment": "Лимитное торговое поручение Чтобы не тратить время на постоянное отслеживание котировок на бирже, вы можете выставить так называемую лимитную заявку — это указание брокеру, какую бумагу или валюту, сколько лотов и по какой цене вы хотите купить или продать. Биржа ограничивает цену, которую можно указать в лимитной заявке, крайними предложениями в биржевом стакане (параметры limit_up и limit_down). Обратите внимание, что в некоторых случаях может возникнуть ситуация, когда limitDown > limitUp. Это нормально, т.к. limitUp ограничивает на покупку, а limitDown - на продажу, потому ситуация limitDown > limitUp не является аномальной. Выставить лимитное торговое поручение (заявку) можно при помощи unary-метода postOrder или при использовании bidirectional-stream OrdersStream. Подробнее: Что такое лимитное торговое поручение? Рыночное торговое поручение Это заявка на покупку или продажу активов по той цене, что есть на бирже в данный момент. У нее есть важная особенность. При исполнении рыночной заявки может оказаться, что в данный момент на бирже по текущей цене торгуется меньше лотов, чем вы указали, при этом другие лоты есть, но их цена отличается в негативную для вас сторону. В этом случае брокер купит имеющееся количество лотов по текущей цене, а оставшуюся часть заявки будет покупать по следующей по списку цене. Если на бирже низкая ликвидность — например, торги рано утром или до открытия американской биржи, — то оставшаяся часть заявки может быть исполнена по невыгодной для вас цене. Проверить текущую ликвидность можно в биржевом стакане. Выставить рыночное торговое поручение (заявку) можно при помощи метода unary-метода postOrder или при использовании bidirectional-stream OrdersStream Подробнее: Что такое рыночное торговое поручение? \"Лучшая цена\" (Best price) Это заявка на покупку или продажу активов по той цене, что есть на бирже в данный момент, но с защитным механизмом. Цена на бирже меняется ежесекундно, и, чтобы не отменять сделку при каждом таком изменении, брокер дополнительно блокирует на вашем счете примерно 0,3% от суммы заявки. Если цена актива изменится больше, чем на 0,3% в худшую для вас сторону, сделка автоматически отменится, а заблокированная сумма вернется обратно на брокерский счет. Заявка по \"лучшей цене\" - это лимитная заявка, цена которой на 0,3% выше, чем цена \"Last Price\". Но в отличие от обычной лимитной заявки исполняется сразу и не добавляется в стакан. Подробнее о \"лучшей цене\". Выставить торговое поручение по \"лучшей цене\" можно при помощи метода unary-метода postOrder.\""
  },
  {
    "h1": "Алгоритм и особенности исполнения торговых поручений",
    "h2": "Особенности исполнения заявок на Санкт-Петербургской бирже",
    "fragment": "Все операции с иностранными ценными бумагами в Тинькофф Инвестициях производятся на Санкт-Петербургской бирже, которая имеет ряд особенностей исполнения заявок. У данной биржи есть два пула ликвидности — США и собственный. Пул США подключается в 14:30 (мск) по летнему американскому времени. Ранее выставленные заявки остаются на СПБ. В момент выставления торгового поручения механизм best execution проверяет, в каком пуле лучше условия и выставляет заявку туда. После выставления заявка уже не переносится между пулами, поэтому может быть ситуация, что пул, в котором выставлена заявка, не достиг лимитной цены, а в другом пуле нужная цена достигалась. Вся биржевая информация (свечи, стаканы) транслируется, агрегируя информацию со всех пулов ликвидности. Исходя из этого может случиться ситуация, когда выставленное торговое поручение не исполняется, хотя имеются подходящие в стакане цены/предложения. В данных ситуациях команда OpenAPI рекомендует перевыставлять (отменить и выставить заново) заявки, чтобы механизм выбора пула ликвидности разместил заявку в более подходящем пуле. Неисполненные заявки могут сниматься в разное время по описанным выше причинам. Время жизни заявки в каждом пуле ликвидности соответствует времени работы соответствующей сессии пула."
  },
  {
    "h1": "Определение доступности выставления торгового поручения",
    "h2": "Без подзаголовка",
    "fragment": "Для успешного размещения заявки на бирже должно выполняться ряд условий: Счёт доступен пользователю для совершения операции. У пользователя достаточно активов для совершения операции или пользователю доступно необходимое количество активов для совершения маржинальной сделки. Для получения текущего состояния портфеля пользователя можно использовать метод getPositions. Для получения маржинальных показателей счёта — метод getMarginAttributes. Инструмент доступен для торгов. Большая часть инструментов доступна для торговли в течении всего времени работы торговой площадки (для получения расписания торгов используйте метод getTradingSchedules). Однако, возможны случаи перерывов и остановок торгов по той или иной бумаге. Для получения актуального статуса торговле по инструменту можно использовать методы сервиса инструментов или стрим информации по инструменту."
  },
  {
    "h1": "Дедлайны запросов",
    "h2": "Без подзаголовка",
    "fragment": "TINKOFF INVEST API работает по протоколу gRPC, который предполагает использование параметра deadline на стороне клиента. Данный параметр отвечает за обозначение крайнего срока выполнения запроса, т.е. по истечению объявленного срока запрос будет прерван принудительно. В TINKOFF INVEST API не существует жёсткого регулирования полученного дедлайна, однако стоит учитывать, что время выполнения запроса зависит от множества факторов (объёма данных, скорости их обработки, сложности вычислений и т.п.) Поэтому команда TINKOFF INVEST API не рекомендует использовать параметр deadline со значениями ниже обозначенных в таблице. Подробнее про deadline: gRPC and Deadlines."
  },
  {
    "h1": "Описание наиболее популярных кейсов",
    "h2": "Без подзаголовка",
    "fragment": "Наиболее популярные кейсы Для понимания алгоритма выполнения основных задач ознакомьтесь с доступными SDK в разделе \"Языки программирования\". Рекомендуется также прочитать статью о создании торгового робота. В статье описаны популярные сценарии для пользователей Tinkoff Invest API. Как создать заявку на покупку или продажу инструмента В случае, когда стратегия дает команду продавать или покупать, необходимо создать заявку: Проверьте существует ли позиция по бумаге с помощью метода FindInstrument. Проверьте статус торгового инструмента с помощью метода GetTradingStatus. Получите последние цены на инструмент с помощью метода GetLastPrice. Получите параметр min_price_increment для расчета цены, которую возможно выставить, с помощью метода GetInstrumentBy. Проверьте свой счет на аккаунте. Выставите заявку с помощью метода PostOrder и сохраните полученный параметр order_id. Получите список активных заявок с помощью метода GetOrders и проверьте есть ли заявка в списке активных по параметру order_id. Информацию об исполненной заявке возможно получить с помощью метода GetOrderState по параметру order_id. Начало работы и получение информации об аккаунте Для получения информации об аккаунте: Вызовите метод GetAccounts для получения списка счетов, их статусов и типов. Вызовите метод GetInfo, который позволяет: определить наличие у пользователя статуса квалифицированного инвестора, премиального клиента; получить список типов инструментов, к которым пользователь имеет доступ по итогам тестирования. Эта информация помогает определить ограничения в торговле. 3. Получите доступные лимиты с помощью метода GetInfo. 4. Периодически обновляйте информацию о маржинальных показателях счета с помощью метода GetMarginAttributes по параметру accountId для торговли на срочном рынке. Как найти базовый актив фьючерса Для поиска базового актива фьючерса: Вызовите один из методов: GetFutureBy или GetFutures. Сохраните значение параметра basic_asset_position_uid (уникальный идентификатор позиции основного инструмента). Примечание Для поиска базового актива фьючерса можно также использовать метод FindInstrument. Для этого достаточно передать в query значение параметра basic_asset_position_uid, возвращаемое методами GetFutureBy и GetFutures."
  },
  {
    "h1": "Доступные протоколы взаимодействия",
    "h2": "Без подзаголовка",
    "fragment": "TINKOFF INVEST API поддерживает возможность использования различных протоколов. О том, как начать работать с gRPC, описано на странице."
  },
  {
    "h1": "Протокол взаимодействия с TINKOFF INVEST API",
    "h2": "Без подзаголовка",
    "fragment": "Вся работа с TINKOFF INVEST API происходит по протоколу gRPC, документацию которого можно найти по ссылке: https://grpc.io/docs/. Одной из ключевых особенностей протокола следует назвать Bidirectional-stream — это особый режим работы, при котором открывается одно стрим-соединение, отправлять сообщения в которое могут оба участника взаимодействия. Это позволяет более гибко и оперативно реализовать работу. Например, bidirectional-stream сервиса котировок в одном и том же соединении принимает сообщения об изменении статуса подписки и предоставляет различные виды биржевой информации (стаканы, свечи, поток обезличенных сделок и т.д.). Подробнее о данном режиме работы можно ознакомиться в документации протокола."
  },
  {
    "h1": "Протокол взаимодействия с TINKOFF INVEST API",
    "h2": "Авторизация в TINKOFF INVEST API",
    "fragment": "Для успешной работы с TINKOFF INVEST API требуется передавать токен доступа в metadata каждого запроса. Формат заголовка: Authorization: Bearer [токен доступа] Например: Authorization: Bearer t.QtEo8ahkNFX4RTpbqp0u4z4GDZq27HzUp6AotJASBx7_DVqmqZMHfM2Cy7JmUjS80boI9eVg"
  },
  {
    "h1": "Протокол взаимодействия с TINKOFF INVEST API",
    "h2": "Адреса сервиса TINKOFF INVEST API",
    "fragment": "Все вызовы продового сервиса выполняются по адресу invest-public-api.tinkoff.ru:443. Все вызовы сервиса песочницы выполняются по адресу sandbox-invest-public-api.tinkoff.ru:443. Различия работы контуров описаны на странице."
  },
  {
    "h1": "Протокол взаимодействия с TINKOFF INVEST API",
    "h2": "tracking-id запросов",
    "fragment": "Во все ответы unary-методов TINKOFF INVEST API добавляется заголовок x-tracking-id. Это уникальный uuid-идентификатор запроса, который необходим технической поддержке для разбора различных инцидентов. При обращении в службу технической поддержки обязательно указывайте tracking-id запроса, это ускорит решение вашего вопроса. Для сообщений управления статусом подписки в рамках stream-соединений tracking-id передаётся явно в виде выходного параметра."
  },
  {
    "h1": "Протокол взаимодействия с TINKOFF INVEST API",
    "h2": "Полный текст ошибки",
    "fragment": "В случае ошибки при исполнении методов в TINKOFF INVEST API в ответ добавляется заголовок message. В данном заголовке приходит полный текст описания ошибки. В Kreya вы можете посмотреть текст ошибки на вкладке Header, в поле message."
  },
  {
    "h1": "Протокол взаимодействия с TINKOFF INVEST API",
    "h2": "Appname запросов",
    "fragment": "TINKOFF INVEST API позволяет в запросах добавлять служебный заголовок x-app-name, который нужен для сбора статистики по используемым инструментам. Если вы разработчик SDK, рекомендуется использовать app-name формата <Ник в GitHub>.<Название репозитория>. Например, user.tinkoffSDK."
  },
  {
    "h1": "Протокол взаимодействия с TINKOFF INVEST API",
    "h2": "Рекомендации по тестированию методов TINKOFF INVEST API",
    "fragment": "Для тестирования работы TINKOFF INVEST API можно использовать любой доступный grpc-клиент. Ниже приведены краткие инструкции по настройке двух наиболее популярных из них, а также ссылка на гайд по настройке встроенного gRPS клиента IntelliJ от энтузиаста. Kreya Данный бесплатный gRPC-клиент предоставляет довольно широкий набор функциональности и возможностей. Скачать его можно с официального сайта kreya.app. После установки и запуска приложения перейдите в меню Project — Importers. Нажмите New importer. Укажите название источника данных и его тип (gRPC proto files). Нажмите Add proto directory и укажите папку со скаченными proto-контрактами сервиса TINKOFF INVEST API. Вы также можете нажать Add proto files и выбрать ручным способом все proto-файлы из папки. Скачать актуальную версию контрактов можно по ссылке на официальном GitHub: TINKOFF INVEST API. Сохраните изменения и нажмите Back. В левом окне нажмите на появившуюся папку Tinkoff. Укажите Endpoint сервиса: https://invest-public-api.tinkoff.ru:443. Остальные настройки укажите в соответствии со скриншотом. Обратите внимание на блок Metadata, в нём требуется указать заголовок Authorization, в значении которого передаётся строка \"Bearer <токен доступа>\". Подробнее о том, как получить токен можно узнать по ссылке: Токен доступа Теперь вы можете выполнять запросы к сервису. Kreya позволяет увидеть служебные заголовки ответа сервера: x-ratelimit-limit — показывает текущий лимит пользователя по данному методу. x-ratelimit-remaining — количество оставшихся запросов данного типа в минуту. x-ratelimit-reset — время в секундах до обнуления счётчика запросов. Важно!! Если вы получили ошибку \"The referenced gRPC method is not imported.\", убедитесь, что вы очистили проект в Kreya от прошлых загруженных контрактов. Также всегда проверяйте путь до папки с загружаемыми контрактами, полное наличие всех proto-файлов и их соответствие актуальной версии на официальном GitHub: TINKOFF INVEST API. Изменение proto-файлов повлечет за собой ошибку их прочтения у gRPS-клиентов. BloomRPC Скачать данный клиент можно по ссылке: bloomrpc releases. Интерфейс утилиты достаточно прост, для старта работы требуется указать домен сервиса и импортировать все proto-файлы. Импортируйте скаченные proto-контракты сервиса. Скачать актуальную версию контрактов можно по ссылке на официальном GitHub: TINKOFF INVEST API. Укажите адрес сервера invest-public-api.tinkoff.ru:443 и заполните поле metadata значением (подставьте своё значение токена доступа). { \"Authorization\": \"Bearer t.QtEo8ahkNFX4RTpbqp0u4z4GDZq27HzUp6AotJASBx7_DVqmqZMHfM2Cy7JmUjS80boI9eVg\" } 3. При выполнении запросов следует обязательно указывать тип TLS-подключения: 4. Теперь вы можете выполнять запросы к сервису. BloomRPC не позволяет увидеть заголовки ответа сервера, поэтому команда TINKOFF INVEST API рекомендует использовать Kreya."
  },
  {
    "h1": "Websocket proxy for grpc streaming",
    "h2": "Без подзаголовка",
    "fragment": "Сервис для получения сообщений grpc streaming Тинькофф Инвестиции через json websocket Адрес для подключения wss://invest-public-api.tinkoff.ru/ws/ *token - токен доступа к счету Тинькофф Инвестиции можно передать в заголовке Authorization: Bearer *token , либо в заголовке Web-Socket-Protocol: json, *token запрос на подключение требует указание протокола json в заголовоке Web-Socket-Protocol: json Чтобы получать сообщения c наименованиями полей идентичными наименованиям полей из proto-контрактов, необходимо использовать протокол в заголовке WebSocket-Protocol json-proto вместо json Отправка json-сообщений поддерживается в обоих вариантах, как в camelCase, так и snake_case."
  },
  {
    "h1": "Websocket proxy for grpc streaming",
    "h2": "Сервис поручений",
    "fragment": "Лента сделок. TradesStreamRequest TradesStreamResponse Пример запроса { \"accounts\": [ \"*accountId\" ] } Пример ответа { \"orderTrades\": { \"orderId\": \"36042910361\", \"createdAt\": \"2023-05-16T13:27:14.682140664Z\", \"direction\": \"ORDER_DIRECTION_SELL\", \"figi\": \"BBG00RPRPX12\", \"trades\": [ { \"dateTime\": \"2023-05-16T13:27:13.423246Z\", \"price\": { \"units\": \"1\", \"nano\": 235000000 }, \"quantity\": \"1\", \"tradeId\": \"7653265991\" } ], \"accountId\": \"*accountId\", \"instrumentUid\": \"ade12bc5-07d9-44fe-b27a-1543e05bacfd\" } } Проверить"
  },
  {
    "h1": "Websocket proxy for grpc streaming",
    "h2": "Сервис операций",
    "fragment": "Лента событий по позициям. PositionsStreamRequest PositionsStreamResponse Пример запроса { \"accounts\": [ \"*accountId\" ] } Пример ответа - подписка успешна { \"subscriptions\": { \"accounts\": [ { \"accountId\": \"*accountId\", \"subscriptionStatus\": \"POSITIONS_SUBSCRIPTION_STATUS_SUCCESS\" } ] } } Пример события - изменение позици в портфеле { \"position\": { \"accountId\": \"*accountId\", \"money\": [ { \"availableValue\": { \"currency\": \"rub\", \"units\": \"3148\", \"nano\": 130000000 }, \"blockedValue\": { \"currency\": \"rub\", \"units\": \"0\", \"nano\": 20000000 } } ], \"securities\": [ { \"figi\": \"BBG00RPRPX12\", \"blocked\": \"0\", \"balance\": \"9\", \"positionUid\": \"eee36ccf-5f28-4419-9c29-c6465f39581a\", \"instrumentUid\": \"ade12bc5-07d9-44fe-b27a-1543e05bacfd\", \"exchangeBlocked\": false, \"instrumentType\": \"etf\" } ], \"futures\": [], \"options\": [], \"date\": \"2023-05-16T13:29:13.411710Z\" } } Проверить Лента событий по портфелям. PortfolioStreamRequest PortfolioStreamResponse Пример запроса { \"accounts\": [ \"*accountId\" ] } Пример ответа подписка успешна { \"subscriptions\": { \"accounts\": [ { \"accountId\": \"*accountId\", \"subscriptionStatus\": \"PORTFOLIO_SUBSCRIPTION_STATUS_SUCCESS\" } ] } } Пример события изменения по портфелю { \"portfolio\": { \"totalAmountShares\": { \"currency\": \"rub\", \"units\": \"2787\", \"nano\": 700000000 }, \"totalAmountBonds\": { \"currency\": \"rub\", \"units\": \"0\", \"nano\": 0 }, \"totalAmountEtf\": { \"currency\": \"rub\", \"units\": \"11\", \"nano\": 115000000 }, \"totalAmountCurrencies\": { \"currency\": \"rub\", \"units\": \"3194\", \"nano\": 843600000 }, \"expectedYield\": { \"units\": \"9158\", \"nano\": 160000000 }, \"positions\": [ { \"figi\": \"BBG004S68473\", \"instrumentType\": \"share\", \"quantity\": { \"units\": \"400\", \"nano\": 0 }, \"averagePositionPrice\": { \"currency\": \"rub\", \"units\": \"3\", \"nano\": 942567000 }, \"expectedYield\": { \"units\": \"6\", \"nano\": 352000000 }, \"averagePositionPricePt\": { \"units\": \"3\", \"nano\": 942567000 }, \"currentPrice\": { \"currency\": \"rub\", \"units\": \"4\", \"nano\": 193000000 }, \"averagePositionPriceFifo\": { \"currency\": \"rub\", \"units\": \"3\", \"nano\": 956275000 }, \"quantityLots\": { \"units\": \"4\", \"nano\": 0 }, \"blocked\": false, \"positionUid\": \"427f9bcc-2cab-4561-bf94-942d4261fbb7\", \"instrumentUid\": \"2dfbc1fd-b92a-436e-b011-928c79e805f2\" } ], \"accountId\": \"*accountId\", \"virtualPositions\": [] } } Проверить"
  },
  {
    "h1": "Websocket proxy for grpc streaming",
    "h2": "Сервис рыночных данных",
    "fragment": "MarketDataRequest MarketDataResponse Лента торговых статусов инструментов Пример запроса { \"subscribeInfoRequest\": { \"subscriptionAction\": \"SUBSCRIPTION_ACTION_SUBSCRIBE\", \"instruments\": [ { \"instrumentId\": \"962e2a95-02a9-4171-abd7-aa198dbe643a\" } ] } } Пример ответа - подписка успешна { \"subscribeInfoResponse\": { \"trackingId\": \"644a898058ce5265b24f9adc21011f67\", \"infoSubscriptions\": [ { \"figi\": \"BBG004730RP0\", \"subscriptionStatus\": \"SUBSCRIPTION_STATUS_SUCCESS\", \"instrumentUid\": \"962e2a95-02a9-4171-abd7-aa198dbe643a\" } ] } } Пример сообщения торговый статус по инструменту { \"tradingStatus\": { \"figi\": \"BBG004730RP0\", \"tradingStatus\": \"SECURITY_TRADING_STATUS_NORMAL_TRADING\", \"time\": \"2023-05-16T07:00:00.750460Z\", \"limitOrderAvailableFlag\": true, \"marketOrderAvailableFlag\": true, \"instrumentUid\": \"962e2a95-02a9-4171-abd7-aa198dbe643a\" } } Проверить Лента цен последних сделок Пример запроса { \"subscribeLastPriceRequest\": { \"subscriptionAction\": \"SUBSCRIPTION_ACTION_SUBSCRIBE\", \"instruments\": [ { \"instrumentId\": \"962e2a95-02a9-4171-abd7-aa198dbe643a\" } ] } } Пример ответа - подписка успешна { \"subscribeLastPriceResponse\": { \"trackingId\": \"644a875239934cfcda96460984a55ced\", \"lastPriceSubscriptions\": [ { \"figi\": \"BBG004730RP0\", \"subscriptionStatus\": \"SUBSCRIPTION_STATUS_SUCCESS\", \"instrumentUid\": \"962e2a95-02a9-4171-abd7-aa198dbe643a\" } ] } } Пример сообщения последние цены по инструменту { \"lastPrice\": { \"figi\": \"BBG004730RP0\", \"price\": { \"units\": \"178\", \"nano\": 790000000 }, \"time\": \"2023-05-16T08:49:31.085056Z\", \"instrumentUid\": \"962e2a95-02a9-4171-abd7-aa198dbe643a\" } } Проверить Лента обезличенных сделок Пример запроса { \"subscribeTradesRequest\": { \"subscriptionAction\": \"SUBSCRIPTION_ACTION_SUBSCRIBE\", \"instruments\": [ { \"instrumentId\": \"962e2a95-02a9-4171-abd7-aa198dbe643a\" } ] } } Пример ответа - подписка успешна { \"subscribeTradesResponse\": { \"trackingId\": \"6440d32adb48515bc217b426880a99a7\", \"tradeSubscriptions\": [ { \"figi\": \"BBG004730RP0\", \"subscriptionStatus\": \"SUBSCRIPTION_STATUS_SUCCESS\", \"instrumentUid\": \"962e2a95-02a9-4171-abd7-aa198dbe643a\" } ] } } Пример сообщения обезличиные сделки по инстурменту { \"trade\": { \"figi\": \"BBG004730RP0\", \"direction\": \"TRADE_DIRECTION_SELL\", \"price\": { \"units\": \"178\", \"nano\": 860000000 }, \"quantity\": \"200\", \"time\": \"2023-05-16T08:50:22.807741Z\", \"instrumentUid\": \"962e2a95-02a9-4171-abd7-aa198dbe643a\" } } Проверить Лента событий по стаканам Пример запроса { \"subscribeOrderBookRequest\": { \"subscriptionAction\": \"SUBSCRIPTION_ACTION_SUBSCRIBE\", \"instruments\": [ { \"depth\": 10, \"instrumentId\": \"962e2a95-02a9-4171-abd7-aa198dbe643a\" } ], \"waitingClose\": false } } Пример ответа - подписка успешна { \"subscribeOrderBookResponse\": { \"trackingId\": \"6440cfbaa85be1a52839fc81e5f0f14f\", \"orderBookSubscriptions\": [ { \"figi\": \"\", \"depth\": 10, \"subscriptionStatus\": \"SUBSCRIPTION_STATUS_SUCCESS\", \"instrumentUid\": \"962e2a95-02a9-4171-abd7-aa198dbe643a\" } ] } } Пример сообщения стака по инструменту { \"orderbook\": { \"figi\": \"BBG004730RP0\", \"depth\": 10, \"isConsistent\": true, \"bids\": [ { \"price\": { \"units\": \"178\", \"nano\": 970000000 }, \"quantity\": \"20\" }... # ...other 9 items collapsed ], \"asks\": [ { \"price\": { \"units\": \"178\", \"nano\": 980000000 }, \"quantity\": \"3\" }... # ...other 9 items collapsed ], \"time\": \"2023-05-16T08:54:00.549662Z\", \"limitUp\": { \"units\": \"191\", \"nano\": 440000000 }, \"limitDown\": { \"units\": \"156\", \"nano\": 240000000 }, \"instrumentUid\": \"962e2a95-02a9-4171-abd7-aa198dbe643a\" } } Проверить Лента события по свечам Пример запроса { \"subscribeCandlesRequest\": { \"subscriptionAction\": \"SUBSCRIPTION_ACTION_SUBSCRIBE\", \"instruments\": [ { \"interval\": \"SUBSCRIPTION_INTERVAL_ONE_MINUTE\", \"instrumentId\": \"962e2a95-02a9-4171-abd7-aa198dbe643a\" } ], \"waitingClose\": false } } Пример ответа - подписка успешна { \"subscribeCandlesResponse\": { \"trackingId\": \"644a8c236378693c5265a3f679698708\", \"candlesSubscriptions\": [ { \"figi\": \"BBG004730RP0\", \"interval\": \"SUBSCRIPTION_INTERVAL_ONE_MINUTE\", \"subscriptionStatus\": \"SUBSCRIPTION_STATUS_SUCCESS\", \"instrumentUid\": \"962e2a95-02a9-4171-abd7-aa198dbe643a\" } ] } } Пример события свеча по инструменту { \"candle\": { \"figi\": \"BBG004730RP0\", \"interval\": \"SUBSCRIPTION_INTERVAL_ONE_MINUTE\", \"open\": { \"units\": \"179\", \"nano\": 50000000 }, \"high\": { \"units\": \"179\", \"nano\": 70000000 }, \"low\": { \"units\": \"178\", \"nano\": 950000000 }, \"close\": { \"units\": \"178\", \"nano\": 950000000 }, \"volume\": \"4279\", \"time\": \"2023-05-16T08:44:00Z\", \"lastTradeTs\": \"2023-05-16T08:44:27.432487Z\", \"instrumentUid\": \"962e2a95-02a9-4171-abd7-aa198dbe643a\" } } Проверить"
  },
  {
    "h1": "Websocket proxy for grpc streaming",
    "h2": "Пинг сообщения",
    "fragment": "Пример { \"ping\": { \"time\": \"2023-05-16T08:32:00.472145624Z\" } }"
  },
  {
    "h1": "Как пользоваться Swagger?",
    "h2": "Без подзаголовка",
    "fragment": "C помощью Swagger вы можете тестировать методы Tinkoff Invest API. Cсылка на Swagger Tinkoff Invest API."
  },
  {
    "h1": "Как пользоваться Swagger?",
    "h2": "Что такое Swagger?",
    "fragment": "Swagger - это фреймворк для спецификации RESTful API. Один из его инструментов, Swagger UI, позволяет не только интерактивно просматривать спецификацию, но и отправлять запросы."
  },
  {
    "h1": "Как пользоваться Swagger?",
    "h2": "Что такое Swagger UI?",
    "fragment": "Swagger UI - один из самых популярных инструментов для создания интерактивной документации. Swagger UI создает интерактивную консоль API для экспериментов с запросами в реальном времени."
  },
  {
    "h1": "Как пользоваться Swagger?",
    "h2": "Инструкция по использованию",
    "fragment": "Авторизация Прежде чем делать какие-либо запросы, нужна авторизация. Нажимаем кнопку Authorize и заполняем информацию, требуемую в окне «Авторизация», изображенном ниже: В нашем случае необходимо ввести токен токен доступа. Подробнее о том, как получить токен можно узнать по ссылке: Токен доступа Например: t.QtEo8ahkNFX4RTpbqp0u4z4GDZq27HzUp6AotJASBx7_DVqmqZMHfM2Cy7JmUjS80boI9eVg Создание запроса Теперь создадим запрос: Разворачиваем конечную точку Нажимаем кнопку Try it out После того, как мы нажмем кнопку Try it out, значение примера в поле «Тело запроса» станет редактируемым. В редактируемом поле изменяем значения параметров. Нажимаем Execute. Пользовательский интерфейс Swagger отправляет запрос и показывает отправленный curl. Раздел Ответы показывает тело ответа и заголовки ответа. Самый ожидаемый ответ, в случае правильной обработки запроса сервером, имеет код 200 и показывает то, как должна выглядеть структура ответа. C помощью Swagger вы можете тестировать методы Tinkoff Invest API. Официальную документацию вы можете найти на сайте Swagger."
  },
  {
    "h1": "Алгоритмическая торговля",
    "h2": "Без подзаголовка",
    "fragment": "Алгоритмическая торговля (алготрейдинг) – это автоматическая система торговли на бирже, основанная на определённых алгоритмах. Алгоритмы также называют \"Торговыми роботами\". Существует большое количество стратегий и алгоритмов, реализуемых на базе торговых роботов."
  },
  {
    "h1": "Алгоритмическая торговля",
    "h2": "Этапы алгоритмической торговли",
    "fragment": "Вне зависимости от выбранной стратегии выделяется несколько этапов разработки торгового робота: Сбор и анализ исторических данных. На данном этапе перед разработчиком торгового робота стоит задача сбора максимального количество исторических данных с биржи, а именно котировки, свечи. Требуется это в первую очередь для анализа и подготовки гипотез, которые будут в последующем проверяться и дорабатываться. Выдвижение гипотезы. Используя исторические данные разработчик должен сформировать гипотезу, т.е. некую идею, которая будет реализовываться торговым роботом. Гипотеза необязательно должна быть \"человекочитаемой\" — это вполне может быть результат обучения алгоритма, основанного на интеллектуальных технологиях (нейросети, машинное обучение и т.п.). Проверка гипотезы на исторических данных. На данном этапе производится проверка выдвинутой на предыдущем шаге теории. Производится эмуляция торговли робота \"в прошлом\". Оценивается уровень доходности и прибыльность стратегии. Если результаты неудовлетворительные, то следует вернуться назад и доработать гипотезу или выдвинуть новую. Проверка гипотезы в реальном времени. Не всегда историческая доходность гарантирует доходность в будущем, поэтому кроме проверки на исторических данных требуется провести тестирование алгоритма и на реальных данных. Для этой задачи отлично подходит песочница Public Invest API. Хотя песочница и имеет ряд ограничений (например, отсутствует влияние на рынок самого алгоритма), для предварительной проверки гипотезы она вполне может подойти. Реальная торговля на бирже. На данном этапе запускается полноценная торговля на бирже — с последующим мониторингом доходности и корректировкой алгоритма, если того требует ситуация."
  },
  {
    "h1": "Алгоритмическая торговля",
    "h2": "Классификация алгоритмической торговли",
    "fragment": "Виды алгоритмической торговли: по степени автономности алгоритмов: сигнальные – тип алгоритмов, которые, исходя из внутренней логики, формируют сигналы трейдеру о покупке или продаже инструментов. Решение же о непосредственном выставлении заявки на биржу принимает человек (разработчик алгоритма); автоматические – тип торгового робота, который самостоятельно торгует на бирже, т.е. выставление/отмена торговых поручений происходит в полностью автоматическом режиме без участия человека. по частоте торгов: высокочастотная торговля (англ. high-frequency trading, HFT) – основная форма алгоритмической торговли на финансовых рынках, в которой современное оборудование и алгоритмы используются для быстрой торговли ценными бумагами. В HFT используются специальные торговые стратегии, при которых компьютеры покупают и продают позиции в течение долей секунды, получая при этом на каждой сделке минимальную прибыль (часто измеряемую сотыми долями процента). Данный тип алгоритмов очень критичен к скорости получения биржевой информации и скорости выставления поручений на торговую площадку. Задержки на считанные миллисекунды способны свести и без того небольшую доходность каждой сделки к нулю или даже к убыткам; интрадей торговля – торговля внутри одного торгового дня. При такой стратегии сделки с инструментами производятся строго в рамках одного торгового дня и никогда не переносятся на следующий. Отличие от HFT в первую очередь заключается во времени владения активом, оно может достигать минут и часов; фундаментальная торговля – вид алгоритмов, при котором отсутствует привязка к торговому дню биржи. Один актив может удерживаться торговым роботом в течение нескольких дней или даже недель в ожидании выгодного предложения о продаже/покупке. по цели реализации алгоритма: получение непосредственно прибыли – цель таких алгоритмов генерировать прибыль на спекуляции активами; уменьшение риска владения портфелем – данный тип алгоритмов предназначен для автоматической диверсификации и ребалансировки портфеля владельца. Основная цель самого алгоритма не генерация прибыли, а максимально быстрое реагирование на изменение баланса портфеля и приведение его к заранее заданным параметрам. Например, поддержание доли акций (по цене) в границах 30-40% от стоимости портфеля; оптимизация крупных сделок – данный тип алгоритмов предназначен для совершения очень крупных по объёму сделок. Особенности работы торговых площадок подразумевают сильное влияние на стоимость актива крупными торговыми поручениями. Например, если появляется заявка на покупку определённых акций на сумму $1млн, это неминуемо сильно повысит цены торгов. Чтобы избежать такого влияния, крупные участники рынка используют алгоритмы, которые могут в течение длительного времени маленькими партиями покупать или продавать инструменты по заданным параметрам цены. Такое \"дробление\" позволяет минимизировать влияние трейдера на рынок и получить требуемые объёмы сделок по приемлемым ценам. по количеству используемых пулов ликвидности: арбитражные – эти алгоритмы используют разницу цен на разных торговых площадках, а также курсовую разницу различных валют. Арбитражный алгоритм очень критичный к скорости работы алгоритм, т.к. разница цен может наблюдаться считанные доли секунды. монопульные – алгоритмы, использующие в своей работе только одну торговую площадку. по типам алгоритмов принятие решений и/или генерации сигналов: парная торговля с целью уменьшения спреда – тип алгоритмов, за основу которых берётся метод одновременного выставления поручений на покупку и продажу инструмента в границах текущего спреда стакана; машинное обучение и прочие элементы AI – использование возможностей нейросетей и прочих интеллектуальных технологий для поиска корреляций и прогнозирования динамики цены того или иного инструмента; индикаторная алгоритмическая торговля – тип алгоритмов, которые используют для прогнозирования высчитанные по строгому алгоритму индикаторы с заранее известными параметрами. по используемым инструментам: фьючерсная и индексная торговля; опционная торговля, включая опционный арбитраж. Важно! Приведённая классификация является достаточно общей и нужно понимать, что реально работающий торговый робот может объединять в себе алгоритмы нескольких видов."
  },
  {
    "h1": "Алгоритмическая торговля",
    "h2": "Риски алгоритмической торговли",
    "fragment": "При торговле на бирже необходимо учесть: Требуется определённый уровень компетентности в вопросах биржевой торговли. Мы настоятельно рекомендуем изучить теорию биржевой торговли и особенностей работы Тинькофф Инвестиций перед началом разработки своего торгового робота, чтобы исключить риски, связанные с неправильным пониманием функционирования торговых площадок и вашего брокера. Требуется определённый уровень компетентности в программировании. Несмотря на наличие подробной документации и ряда готовых решений, снижающих порог входа, от разработчика будет требоваться некоторый набор знаний и навыков для написания своего алгоритма. Убытки от работы торгового робота. На бирже никто не застрахован от неудач, алгоритмическая же торговля накладывает дополнительный риск, связанный со скоростью принятий решений и большим количеством сделок. Неправильно работающий робот может довольно быстро опустошить счёт (даже не используя маржинальную торговлю). Мы рекомендуем внимательно относиться к этапам бэктестинга алгоритмов, проверять работу робота не только на исторических данных, но и тестировать выбранную стратегию на реальных данных (например, используя песочницу). Также следует разумно подходить к объёму средств, которые \"доверяются\" роботу при старте его работы, когда алгоритм ещё не проверен \"в бою\". Различные ошибки в работе систем. Как и любая информационная система, вся инфраструктура TINKOFF INVEST API и инфраструктура пользователя подвержены рискам нештатных ситуаций, ошибок, перерывов в работе. Это же справедливо для самой биржи, там тоже порой возникают различные сбои. Поэтому рекомендуется предусмотреть в работе вашего алгоритма максимальное количество таких ситуаций и корректное реагирование на них. Это могут быть уведомления, которые робот присылает вам в случае возникновения ошибок, механизм аварийного прекращения торговли или перерыва в ней. Описание возможных ошибок TINKOFF INVEST API и рекомендации по их устранению представлены на странице."
  },
  {
    "h1": "Алгоритмическая торговля",
    "h2": "Стратегии алгоритмической торговли",
    "fragment": "Различают следующие виды стратегий: TWAP (с англ. Time Weighted Average Price — «взвешенная по времени средняя цена») — такой алгоритм открывает заявки через равные промежутки времени по ценам с лучшим спросом или предложением; VWAP (с англ. Volume Weighted Average Price – «взвешенная по объёму средняя цена») — данный алгоритм нужен для равномерного открытия позиции по равным частям определенного объёма в течение конкретного времени, а также по ценам не выше, чем средневзвешенное значение с момента запуска; Execution Strategy — алгоритм предназначен для покупки актива по средневзвешенной цене в большом объёме, как правило, используется крупными игроками (хедж-фондами и брокерами); Спекулятивная стратегия — стандартная модель для частных трейдеров, которая стремится к достижению максимально выгодной цены для входа в сделку с целью получения последующей прибыли; Data Mining — это поиск новых закономерностей для новых алгоритмов. Более 75% дата-майнинга приходится на сбор данных до запуска тестирования. Итог поиска зависит только от профессионального и глубокого подхода. Сам же поиск осуществляют различные алгоритмы по ручным настройкам. Например, найти паттерн, после которого в течение трех свечей рынок рос 2000 раз, а падал всего 200 раз. После этого найденные паттерны встраиваются в алгоритмы торговых роботов и успешно (либо не очень) торгуются."
  },
  {
    "h1": "Индикаторы технического анализа рынка",
    "h2": "Без подзаголовка",
    "fragment": "В биржевой торговле различают два крупных вида анализа текущего состояния инструмента или рынка в целом: Фундаментальный анализ – термин для обозначения методов прогнозирования рыночной (биржевой) стоимости компании, основанных на анализе финансовых и производственных показателей её деятельности. Используется в основном долгосрочными инвесторами и чаще всего предполагает долгосрочное инвестирование. Технический анализ – метод прогнозирования котировок при помощи индикаторов технического анализа, которые призваны предсказывать поведения рынка в будущем на основе анализа котировок за какой-то промежуток времени в прошлом. Как правило, именно на технический анализ опираются в своих прогнозах трейдеры (в том числе алгоритмические). Существует огромное количество индикаторов технического анализа. Целью данной статьи не является подробный разбор их всех, а лишь небольшое погружение в основные виды."
  },
  {
    "h1": "Индикаторы технического анализа рынка",
    "h2": "Виды индикаторов технического анализа рынка",
    "fragment": "Трендовые – индикаторы, отслеживающие текущий тренд, т.е. направление, для ценной бумаги (рост цены или её снижение). Позволяют трейдеру среагировать на изменение рынка или спрогнозировать его изменение. Подавляющее большинство трендовых индикаторов опираются на скользящую среднюю линию, имеющая массу разновидностей. Осцилляторы – индикаторы, которые хорошо работают в условиях стабильного рынка, то есть тогда, когда нет ярко выраженного направления движения цены. Они предупреждают о дисбалансе рынка, указывают на расхождение цены и показаний индикатора, говорят о возможности продолжения краткосрочного тренда внутри диапазона. Наиболее известными осцилляторами являются Стохастик и Индекс Относительной Силы. Их преимущество заключается в том, что они позволяют заранее увидеть, когда цена может сделать разворот и перейти от одного тренда к другому (но только в условиях диапазона!)"
  },
  {
    "h1": "Индикаторы технического анализа рынка",
    "h2": "Примеры индикаторов технического анализа",
    "fragment": "Скользящая средняя, скользящее среднее (англ. moving average) — трендовый технический индикатор, в основе которого лежит анализ поведения котировок ценной бумаги и их скользящего среднего. Для использования индикатора одновременно совмещаются графики цены и его скользящей средней. Вид скользящей средней и период построения (количество временных периодов, по которому осуществляется усреднение; иногда называется порядком или временным окном или длиной) выбирается трейдером на своё усмотрение и зависит от горизонта торговли, волатильности рынка и инструмента. Причём в разные промежутки времени могут использоваться различные виды скользящих средних и разные периоды построения. Выбор данных параметров считается настолько сложным, что стал отдельной ветвью технического анализа. Однако в общем случае признаётся, что чем больше время прогноза, тем больший порядок необходимо выбрать для скользящей средней, и наоборот. Для построения и анализа обычно используют любую из общепринятых биржевых цен (открытия, закрытия, максимум, минимум, средняя, средневзвешенная), но обычно используют цену закрытия. Наиболее простой является стратегия, при которой инструмент покупается при условии, что график цены пересекает свою скользящую среднюю снизу вверх, и продаётся, когда график цены пересекает график скользящей средней сверху вниз. И то и другое явление называют пробоем. Кроме того, полагают, что если линия графика цены находится выше скользящей средней, то рынок считается «бычьим», на котором можно покупать, а если наоборот — «медвежьим», предпочтительным для продажи. Различают четыре основных разновидности индикатора пересечений скользящих средних: SMA (простое); SMMA (сглаженное); EMA (экспоненциальное); LWMA (линейно-взвешенное). Примеры графиков различных видов скользящих средних в Терминале Тинькофф Инвестиций: Индикатор линейной регрессии (Linear Regression Indicator, LRI) – трендовый технический индикатор, разработанный Гильбертом Раффом 1991 году – эффективный и простой в эксплуатации инструмент, помогающий спрогнозировать будущие цены до того момента, как они станут «перегретыми». Отображается индикатор линейной регрессии на графике в виде канала, который образуют две параллельные линии, равноудаленные от тренда. Ширина этого коридора зависит исключительно от выбранного таймфрейма. Существует две основных стратегии работы с индикатором линейной регрессии: на разворот; на пробой. В первом случае трейдер ориентируется на динамику изменения цены в границах канала. При приближении её к линии сопротивления или поддержки ставка делается на то, что пойдет движение в обратном направлении. То есть если цена вплотную подошла к верхнему пределу, от актива можно избавляться. Если она в самом низу канала, есть смысл задуматься о покупке. Пример графика линейной регрессии в Терминале Тинькофф Инвестиций: Индикатор Аллигатор – осцилляторный индикатор технического анализа, созданный известным рыночным игроком Биллом Уильямсом. Используется для поиска моментов перехода тренда к стабильному движению и, наоборот, сигнализирует об его прекращении. График индикатора Аллигатор состоит из трех разноцветных линий, именуемых сглаженными скользящими средними (SMA) с разными периодами и сдвигом на графике. При этом во всех кривых используется средняя цена, а не цена закрытия. Рассчитывается она достаточно просто. Берется максимум и минимум за определенный период времени. Они складываются между собой и делятся на два. Синяя кривая, которая называется «Челюстью», имеет расчетный период 21 при смещении вперед на 8 баров. Она демонстрирует возможное местонахождение цены при отсутствии фундаментальных экономических новостей. Если линия «Челюсти» располагается ниже относительно графика цены, значит, рынок находится в состоянии позитивного ожидания восходящего движения. Если выше – рынок настроен негативно, и велика вероятность роста тренда. Красную кривую с расчетным периодом 11 при смещении вперед на 5 баров называют аллигаторовыми «Зубами». Она демонстрирует часовую тенденцию. «Губы» зеленого цвета с периодом 8 при смещении вперед на 3 бара отображают 12-минутную тенденцию на дневных таймфреймах (временных промежутках). Пример аллигатора в Терминале Тинькофф Инвестиций: Индекс относительной силы (Relative Strength Index) – популярный классический осциллятор, используемый для оценки силы тенденции и нахождения точек коррекции/разворота. Создателем индекса относительной силы является известный теоретик В. Уайлдер (J. Welles Wilder), представивший инструмент на суд широкой общественности в далеком 1978 году. Индикатор RSI сравнивает абсолютные величины роста и падения рынка за определенный временной промежуток. Значения индекса могут лежать в диапазоне от 0 до 100. Главным и единственным параметром инструмента является период. Например, если есть необходимость отсеять ложные сигналы, размер периода можно повысить до 21. Когда рынок спокоен, длину вполне можно снизить до 7, чтобы получать больше сообщений. Общий алгоритм расчета RSI для периода N выглядит следующим образом: Берутся цены закрытия за выбранный период, включая текущий день. Определяются дни, в которые цена закрытия была выше, чем открытие следующего дня. Вычисляется совокупная абсолютная величина этих приростов и делится на N, в результате чего получается средняя величина прироста (во многих случаях это экспоненциальное скользящее среднее). Определяются дни, когда цена закрытия была ниже, чем последующая цена открытия. Аналогично приросту вычисляется средняя величина падения. В результате деления среднего прироста на среднее падение, получаем относительную силу (RS), которая станет основой индикатора. На основании RS вычисляется индекс относительной силы: RSI = 100 – 100 / (RS + 1). Индекс относительной силы в Терминале Тинькофф Инвестиций:"
  },
  {
    "h1": "Режимы торгов и особенности работы торговых площадок",
    "h2": "Без подзаголовка",
    "fragment": "Все время указано для Москвы (UTC +3)"
  },
  {
    "h1": "Режимы торгов и особенности работы торговых площадок",
    "h2": "Московская биржа",
    "fragment": "Московская биржа предоставляет пользователям возможность торговли ценными бумагами российских эмитентов, валютой, производными инструментами и рядом зарубежных инструментов. Режимы торгов Аукцион открытия (премаркет) — время перед началом основных торгов, предназначенное для определения цены открытия. Данная цена определяется специальным алгоритмом биржи исходя из полученных заявок. Аукцион открытия длится с 9:50 до 10:00 по московскому времени. Основная торговая сессия — режим основных торгов московской биржи длится с 10:00 до 18:40. Аукцион закрытия (постмаркет) — время после окончания основных торгов, во время которого по аналогии с аукционом открытия биржей определяется цена закрытия. Проходит с 18:40 до 18:50. Аукцион открытия вечерней (дополнительной) сессии — с 19:00 до 19:05, принцип аналогичен аукциону открытия основной торговой сессии. Вечерняя сессия — с 19:05 до 23:50. Торги во время вечерней сессии производятся только самыми ликвидными инструментами, полный список можно получить по ссылке."
  },
  {
    "h1": "Режимы торгов и особенности работы торговых площадок",
    "h2": "Санкт-Петербургская биржа",
    "fragment": "Санкт-Петербургская биржа предоставляет пользователям возможность торговли иностранные ценными бумагами, еврооблигациями и прочими торговыми инструментами. Режимы торгов Утренняя дополнительная секция — с 7:00 до 10:00, торги производятся для следующих ценных бумаг. Основная торговая сессия — с 10:00 до 23:00. Дополнительная торговая сессия — с 23:00 до 1:45 следующего календарного дня. Аукцион закрытия — с 23:00 до 1:45 следующего календарного дня. Не производится для бумаг, определённых перечнем. Период дополнительной ликвидности До 14:30(МСК) по летнему американскому времени все торги на Санкт-Петербургской бирже производятся без привлечения дополнительной ликвидности бирж США, т.е. происходят исключительно внутри биржи. В 14:30 подключается дополнительный пул ликвидности США, который значительно повышает объёмы сделок. Связано это с открытием торгов на иностранных торговых площадках."
  },
  {
    "h1": "Квалифицированный инвестор",
    "h2": "Без подзаголовка",
    "fragment": "Согласно законодательству Российской Федерации, для доступа физического лица к операциям с определённым перечнем ценных бумаг требуется получить статус квалифицированного инвестора. Речь идёт, например, о доступе к торгам ценными бумагами на иностранных биржах и активами на внебиржевом рынке: сплитированными и целыми лотами евробондов российских и зарубежных компаний, структурными нотами и многим другим. Неквалифицированным инвесторам недоступна торговля ценными бумагами, отсутствующими на Бирже СПБ и ММВБ."
  },
  {
    "h1": "Квалифицированный инвестор",
    "h2": "Требования к квалифицированным инвесторам",
    "fragment": "Для получения статуса квалифицированного инвестора нужно выполнить одно из условий: владеть активами на сумму от 6 млн рублей; иметь опыт работы на финансовом рынке; профильное образование; оборот по сделкам от 6 млн рублей."
  },
  {
    "h1": "Корпоративные действия",
    "h2": "Без подзаголовка",
    "fragment": "В процессе владения ценными бумагами любой трейдер сталкивается с так называемыми \"корпоративными действиями\". Это события в жизни эмитента ценной бумаги, которое так или иначе влияет на депонента. К таким событиям относятся: Сплит акций (англ. stock split — дробление бумаг) — это увеличение количества ценных бумаг, торгуемых на бирже, путём уменьшения их стоимости. Сплит акций не влияет на общую капитализацию компании и проводится с целью снижения стоимости отдельной акции. Нужно это, как правило, для упрощения (удешевления) инвестиций в компанию. При сплите акций у трейдера изменяется количество данных акций в портфеле на коэффициент сплита. Общая же стоимость этих бумаг в портфеле не меняется. Например, компания выпускала 1000 акций по 1 $, а после дробления стало 2000 акций по 0,5 $. Количество акций определяет совет директоров. При этом стоимость компании не меняется. Консолидация (обратный сплит) — процедура по сути противоположная сплиту и проводится аналогично. С той лишь разницей, что количество ценных бумаг в портфеле трейдера будет уменьшено на коэффициент обратного сплита. Если компания выпустила 2000 акций по 1 $, после консолидации будет 1000 акций по 2 $. Сколько акций объединить, определяет совет директоров. Выделение (Spinoff) происходит, когда компания выделяет какую-то свою часть в самостоятельную организацию. Компания может отделить от себя несколько частей и создать несколько организаций. Ценные бумаги новых организаций распределяются между акционерами основной компании. Как их распределить, определяет совет директоров. Делистинг — исключение ценных бумаг определённого эмитента из котировального списка фондовой биржи. После делистинга ценные бумаги компании-эмитента не могут торговаться на бирже, где компания исключена из котировального списка. Ценные бумаги, исключенные из котировального списка, могут торговаться на внебиржевом рынке ценных бумаг. При делистинге возможны различные сценарии поведения позиций портфеля (выкуп акций эмитентом по определённой цене; сохранение позиций за трейдером, но невозможность биржевой торговли; выкуп по рыночной цене и т.п.) Выплата дивидендов в виде акций — при таком событии количество акций так же будет увеличено на сумму, эквивалентную сумме дивидендов к выплате. Конвертация ценных бумаг — бывает, что одна компания покупают другую, что компании сливаются в одну. Во всех этих случаях происходит изменение ценных бумаг. Это может быть смена идентификаторов (isin, figi, ticker), номинала, валюты расчётов, цены и т.п. В случае данного события так же очень многое зависит от условий, которые были обозначены компанией. Досрочное погашение (полное или частичное) — данное событие относится к облигациям, иногда компания может выкупить часть или полный выпуск облигаций досрочно по установленной цене. Делается это чаще всего с целью сократить количество купонных выплат при достижении финансовых показателей компании. Погашение в установленный срок — погашение облигаций в соответствии со сроком их выпуска. В данном случае все облигации нужного выпуска в портфеле \"продаются\" по цене номинала с учётом накопленного купонного дохода."
  },
  {
    "h1": "Как ускорить взаимодействие с Tinkoff Invest API",
    "h2": "Без подзаголовка",
    "fragment": "Следующие рекомендации позволят уменьшить временные издержки при запросе данных и выставлении поручений."
  },
  {
    "h1": "Как ускорить взаимодействие с Tinkoff Invest API",
    "h2": "Сетевые задержки",
    "fragment": "Сервера брокера находятся в датацентрах M1 и Dataspace, чем ближе ваше оборудование будет располагаться к ним, тем меньше будут сетевые задержки."
  },
  {
    "h1": "Как ускорить взаимодействие с Tinkoff Invest API",
    "h2": "Скорость исполнения поручений",
    "fragment": "Скорость исполнения поручений со включенной маржинальной торговлей значительно ниже, поэтому если маржинальная торговля не является обязательной для вас, ее лучше отключить. Задержки в скорости выставлении заявок пропорциональны количеству сделок, проведенных на данном аккаунте в течение торгового дня. Поэтому если вы выставляете много поручений (десятки тысяч в сутки) и испытываете проблемы со скоростью исполнения, рекомендуем открыть дополнительные брокерские счета и равномерно разделить торговлю между ними. Если исполнение осуществляется достаточно медленно, вам надо выставлять больше заявок и вы не успеваете выбирать весь предоставленный лимит, то рекомендуем архитектурно выставлять заявки в несколько программных потоков параллельно."
  },
  {
    "h1": "Как ускорить взаимодействие с Tinkoff Invest API",
    "h2": "Порядок доставки информации об исполнении заявок",
    "fragment": "Так как брокер - не строго-консистентная система, то при исполнении заявок в разных сервисах информация придет с различными задержками: Самое быстрое - придет обновление в GetOrders / GetOrderState Далее - GetPosition, TradeStream Далее - GetPortfolio Позже обновятся операции в GetOperations"
  },
  {
    "h1": "Как ускорить взаимодействие с Tinkoff Invest API",
    "h2": "Скорость доставки рыночных котировок",
    "fragment": "Рекомендуем следить, чтобы клиентский код успевал вычитывать все присланную в стриминге информацию, иначе сервер может разорвать соединение. Обновления в tradeStream приходят чуть быстрее, чем в Candles В потоке котировок свечей есть ограничение на частоту отправки - свечи не отправляются ранее, чем через 300мс с момента отправки последней свечи по тому же инструменту."
  },
  {
    "h1": "SLA",
    "h2": "Время жизни ключа идемпотентности на стороне брокера",
    "fragment": "Ключ идемпотентности, передаваемый как параметр order_id в методе postOrder, а так же передаваемый как idempotency_key в методе replaceOrder хранится на стороне брокера и имеет срок жизни один год. Счетчик стрим соединений обновляется каждые 2 минуты."
  },
  {
    "h1": "Примеры запросов",
    "h2": "Без подзаголовка",
    "fragment": "На данной странице представлены примеры запросов по некоторым методам в формате JSON."
  },
  {
    "h1": "Примеры запросов",
    "h2": "PostOrder – Метод выставления заявок",
    "fragment": "Задача: выставить лимитную заявку на покупку инструмента. { \"figi\": \"BBG000000001\", \\\\ FIGI инструмента по которому выставляется заявка. В данном случае используем Тинькофф Вечный портфель RUB. \"quantity\": \"1\", \\\\ количество лотов инструмента \"price\": { \\\\ цена, по которой будет выставлена заявка \"nano\": 600000000, \"units\": \"5\" }, \"direction\": \"ORDER_DIRECTION_BUY\", \\\\ Направление заявки, в данном случае покупка \"accountId\": \"XXXXXXXXXX\", \\\\ Номер счета с которого будет выставлена заявка \"orderType\": \"ORDER_TYPE_LIMIT\", \\\\ Тип заявки, в данном случае лимитная. \"orderId\": \"string\" \\\\ ключ идемпотентности. }"
  },
  {
    "h1": "Примеры запросов",
    "h2": "ReplaceOrder – Метод изменения выставленной заявки",
    "fragment": "Задача: изменить выставленную ранее заявку. { \"accountId\": \"XXXXXXXXXX\", \\\\ номер счета с которого выставлена заявка \"orderId\": \"XXXXXXXXX\", \\\\ номер выставленной заявки \"idempotencyKey\": \"string\", \\\\ ключ идемпотентности \"quantity\": \"4\", \\\\ новое количество лотов \"price\": { \\\\ новая цена заявки \"nano\": 700000000, \"units\": \"5\" } }"
  },
  {
    "h1": "Примеры запросов",
    "h2": "PostStopOrder – Метод выставления стоп-заявок",
    "fragment": "Задача: выставить лимитную заявку на покупку инструмента. { \"figi\": \"BBG000000001\", \\\\ FIGI инструмента по которому выставляется заявка. В данном случае используем Тинькофф Вечный портфель RUB \"quantity\": \"2\", \\\\ количество лотов инструмента \"price\": { \\\\ цена, по которой будет выставлена заявка \"nano\": 600000000, \"units\": \"5\" }, \"stopPrice\": { \\\\ стоп-цена, она же цена активации заявки. Т.е. когда цена инструмента на бирже достигнет установленной стоп-цены, будет выставлена заявка с указанными параметрами \"nano\": 700000000, \"units\": \"5\" }, \"direction\": \"STOP_ORDER_DIRECTION_BUY\", \\\\ Направление сделки, в данном случае покупка. \"accountId\": \"XXXXXXXXXX\", \\\\ номер счета с которого будет выставлена заявка \"expirationType\": \"STOP_ORDER_EXPIRATION_TYPE_GOOD_TILL_CANCEL\", \\\\ срок действия заявки. В данном случае пока не будет отменена \"stopOrderType\": \"STOP_ORDER_TYPE_STOP_LIMIT\" \\\\ Тип стоп заявки. В данном случае стоп-лимит. }"
  },
  {
    "h1": "Примеры запросов",
    "h2": "GetOperationsByCursor – Метод получения операций по счету с курсором",
    "fragment": "Задача: получить список операций по счету, за год с постраничным выводом. { \"accountId\": \"XXXXXXXXX\", \\\\ номер счета, единственный обязательный параметр в этом методе. Можно указать только его и получить первые 100 операции по счету \"instrumentId\": \"BBG000000001\", \\\\ параметр в котором вы можете указать figi или instrument_uid инструмента, по которому хотите получить операции. В данном случае используем Тинькофф Вечный портфель RUB \"from\": \"2021-11-07T12:49:35.896Z\", \\\\ дата начала периода, с которого отображаются операции. \"to\": \"2022-11-07T12:49:35.896Z\", \\\\ дата окончания периода, по который отображаются операции. \"limit\": 1000, \\\\ лимит вывода количества операций. 1000- максимальный лимит. По-умолчанию передается limit=100 \"operationTypes\": [ \"OPERATION_TYPE_BUY\" \\\\ Тип операций – покупка. ], \"state\": \"OPERATION_STATE_EXECUTED\" \\\\ Статус операций, в данном случае исполненные }"
  },
  {
    "h1": "Примеры запросов",
    "h2": "GetOperations – Метод получения операций по счету",
    "fragment": "Задача: получить список операций по счету, за год. { \"accountId\": \"XXXXXXXXXX\", \\\\ номер счета, единственный обязательный параметр в этом методе. Можно указать только его и получить первые 100 операции по счету \"figi\": \"BBG000000001\", \\\\ параметр в котором вы можете указать figi инструмента, по которому хотите получить операции. В данном случае используем Тинькофф Вечный портфель RUB \"from\": \"2021-11-07T12:49:35.896Z\", \\\\ дата начала периода, с которого отображаются операции. \"to\": \"2022-11-07T12:49:35.896Z\", \\\\ дата окончания периода, по который отображаются операции. \"state\": \"OPERATION_STATE_EXECUTED\" \\\\ Статус операций, в данном случае исполненные }"
  },
  {
    "h1": "Примеры запросов",
    "h2": "GetCandles – Метод получения свечей",
    "fragment": "Задача: получить минутные свечи за день. { \"from\": \"2022-11-08T05:47:40.866Z\", \\\\ Дата начала периода запрошенных свечей \"to\": \"2022-11-09T05:47:40.866Z\", \\\\ Дата окончания периода запрошенных свечей \"interval\": \"CANDLE_INTERVAL_1MIN\", \\\\Интервал свечей \"instrumentId\": \"BBG000000001\" \\\\ параметр в котором вы можете указать figi или instrument_uid инструмента, по которому хотите получить операции. В данном случае используем Тинькофф Вечный портфель RUB }"
  },
  {
    "h1": "Прекращение поддержки старой версии openAPI",
    "h2": "Без подзаголовка",
    "fragment": "Важно! С мая 2023 поддержка старой версии openapi прекращается. Клиенты, использующие старую версию и использующие сервера api-invest.tinkoff.ru/openapi, должны перейти на новую версию Tinkoff invest API. В новой версии поддерживаются все изменения брокера: мультисчета; поддержка фьючерсов и опционов; стриминги сделок, портфеля и позиций; большое количество новых методов и данных."
  },
  {
    "h1": "Прекращение поддержки старой версии openAPI",
    "h2": "Торговать на новой версией API - выгодно",
    "fragment": "Действует программа кэшбека в размере 10% с комиссии сделок, совершенных через API."
  },
  {
    "h1": "Прекращение поддержки старой версии openAPI",
    "h2": "Ссылки",
    "fragment": "Репозитарий новой версии: https://github.com/Tinkoff/investAPI Документация новой версии: https://tinkoff.github.io/investAPI/ Поддерживаются протоколы: gRPC – https://tinkoff.github.io/investAPI/grpc/ REST – https://tinkoff.github.io/investAPI/swagger-ui/"
  },
  {
    "h1": "Прекращение поддержки старой версии openAPI",
    "h2": "Вопросы",
    "fragment": "Если остались вопросы, пишите: в неофициальный телеграм-чат по почте invest-public-api@tinkoff.ru"
  },
  {
    "h1": "Ответы на частые вопросы",
    "h2": "Без подзаголовка",
    "fragment": "Можно ли вывести в API показатели компаний/прогнозы/доходности и т.д.? Какие документы регламентируют юридическую сторону работы API? Как открыть дополнительные брокерские счета для использования в TINKOFF INVEST API? Какая логика работы с мультисчетами? Поддерживаются ли сейчас мультисчета в TINKOFF INVEST API? Поддерживает ли TINKOFF INVEST API работу с внебиржевыми инструментами? Торговля бумагами Тинькофф через TINKOFF INVEST API Валюты в TINKOFF INVEST API Ответы на часто задаваемые вопросы, относящиеся к работе различных сервисов TINKOFF INVEST API FAQ Сервиса аккаунтов FAQ Сервиса инструментов FAQ Сервиса торговых поручений FAQ Сервиса операций FAQ Сервиса котировок FAQ Сервиса стоп-заявок FAQ Песочница"
  },
  {
    "h1": "Ответы на частые вопросы",
    "h2": "Условия использования",
    "fragment": "Можно ли сделать публичный сервис на основе TINKOFF INVEST API? Нет, TINKOFF INVEST API предоставляется только клиентам Тинькофф без права на ретрансляцию данных. Можно ли вывести в API показатели компаний/прогнозы/доходности и т.д.? Пока не имеем права выгружать эти данные для автоматизированных систем. Работаем над этим. Какие документы регламентируют юридическую сторону работы API? Сервис предоставляется в соответствии с пользовательским соглашением. Как открыть дополнительные брокерские счета для использования в TINKOFF INVEST API? Дополнительные счета Тинькофф Инвестиций открываются в мобильном приложении. Сделать это через TINKOFF INVEST API нельзя. Какая логика работы с мультисчетами? Каждый новый счет полностью изолирован от остальных - портфолио, операции, лимиты, гарантийные обеспечения, уровни достаточности средств учитываются по каждому счету отдельно. Поэтому может быть ситуация, при которой на одном счете средств хватает с избытком, а на другом при нехватке средств и активной маржинальной торговле может наступить маржин-колл. Поддерживаются ли сейчас мультисчета в TINKOFF INVEST API? Да, в TINKOFF INVEST API можно работать с несколькими счетами. Все ключевые методы принимают на вход параметр account_id (идентификатор счёта). Поддерживает ли TINKOFF INVEST API работу с внебиржевыми инструментами? В данный момент TINKOFF INVEST API предполагает работу только с биржевыми инструментами. Торговля бумагами Тинькофф через TINKOFF INVEST API Из-за огромного количества скальперских сделок мы ограничили торговлю БПИФ от УК \"Тинькофф Капитал\" в TINKOFF INVEST API. В данный момент действует ограничение в 100 сделок с этими бумагами в сутки. Валюты в TINKOFF INVEST API Получить список доступных валют можно при помощи метода getInstruments/currencies. Обратите внимание, что лотность валют ограничена лотностью, которую предоставляет биржа. Например, по евро и доллару 1 лот равен 1000 единиц валюты."
  },
  {
    "h1": "Ответы на частые вопросы",
    "h2": "SDK для Python",
    "fragment": "Официальные SDK: https://github.com/Tinkoff/invest-python"
  },
  {
    "h1": "Примеры",
    "h2": "Без подзаголовка",
    "fragment": "Больше примеров доступно здесь."
  },
  {
    "h1": "Примеры",
    "h2": "Получение и вывод в консоль свечей с часовым интервалом за год",
    "fragment": "examples/all_candles.py import os from datetime import timedelta from tinkoff.invest import CandleInterval, Client from tinkoff.invest.utils import now TOKEN = os.environ[\"INVEST_TOKEN\"] def main(): with Client(TOKEN) as client: for candle in client.get_all_candles( figi=\"BBG004730N88\", from_=now() - timedelta(days=365), interval=CandleInterval.CANDLE_INTERVAL_HOUR, ): print(candle) return 0 if __name__ == \"__main__\": main()"
  },
  {
    "h1": "Примеры",
    "h2": "Асинхронная функция получения и вывода в консоль свечей с часовым интервалом за год",
    "fragment": "examples/async_all_candles.py import asyncio import os from datetime import timedelta from tinkoff.invest import AsyncClient, CandleInterval from tinkoff.invest.utils import now TOKEN = os.environ[\"INVEST_TOKEN\"] async def main(): async with AsyncClient(TOKEN) as client: async for candle in client.get_all_candles( figi=\"BBG004730N88\", from_=now() - timedelta(days=365), interval=CandleInterval.CANDLE_INTERVAL_HOUR, ): print(candle) if __name__ == \"__main__\": asyncio.run(main())"
  },
  {
    "h1": "Примеры",
    "h2": "Асинхронная функция получения и вывода счетов пользователя",
    "fragment": "examples/async_client.py import asyncio import os from tinkoff.invest import AsyncClient TOKEN = os.environ[\"INVEST_TOKEN\"] async def main(): async with AsyncClient(TOKEN) as client: print(await client.users.get_accounts()) if __name__ == \"__main__\": asyncio.run(main())"
  },
  {
    "h1": "Примеры",
    "h2": "Асинхронная функция получения и вывода минутных свечей",
    "fragment": "examples/async_retrying_client.py import asyncio import logging import os from datetime import timedelta from tinkoff.invest import CandleInterval from tinkoff.invest.retrying.aio.client import AsyncRetryingClient from tinkoff.invest.retrying.settings import RetryClientSettings from tinkoff.invest.utils import now logging.basicConfig(format=\"%(asctime)s %(levelname)s:%(message)s\", level=logging.DEBUG) TOKEN = os.environ[\"INVEST_TOKEN\"] retry_settings = RetryClientSettings(use_retry=True, max_retry_attempt=2) async def main(): async with AsyncRetryingClient(TOKEN, settings=retry_settings) as client: async for candle in client.get_all_candles( figi=\"BBG000B9XRY4\", from_=now() - timedelta(days=301), interval=CandleInterval.CANDLE_INTERVAL_1_MIN, ): print(candle) if __name__ == \"__main__\": asyncio.run(main())"
  },
  {
    "h1": "Примеры",
    "h2": "Подписка на стрим котировок по минутным свечам и вывод получаемых свечей в консоль",
    "fragment": "examples/async_stream_client.py import asyncio import os from tinkoff.invest import ( AsyncClient, CandleInstrument, MarketDataRequest, SubscribeCandlesRequest, SubscriptionAction, SubscriptionInterval, ) TOKEN = os.environ[\"INVEST_TOKEN\"] async def main(): async def request_iterator(): yield MarketDataRequest( subscribe_candles_request=SubscribeCandlesRequest( subscription_action=SubscriptionAction.SUBSCRIPTION_ACTION_SUBSCRIBE, instruments=[ CandleInstrument( figi=\"BBG004730N88\", interval=SubscriptionInterval.SUBSCRIPTION_INTERVAL_ONE_MINUTE, ) ], ) ) while True: await asyncio.sleep(1) async with AsyncClient(TOKEN) as client: async for marketdata in client.market_data_stream.market_data_stream( request_iterator() ): print(marketdata) if __name__ == \"__main__\": asyncio.run(main())"
  },
  {
    "h1": "Примеры",
    "h2": "Отмена всех выставленных поручений",
    "fragment": "examples/cancel_orders.py import logging import os from tinkoff.invest import Client TOKEN = os.environ[\"INVEST_TOKEN\"] logger = logging.getLogger(__name__) logging.basicConfig(level=logging.INFO) def main(): with Client(TOKEN) as client: response = client.users.get_accounts() account, *_ = response.accounts account_id = account.id logger.info(\"Orders: %s\", client.orders.get_orders(account_id=account_id)) client.cancel_all_orders(account_id=account.id) logger.info(\"Orders: %s\", client.orders.get_orders(account_id=account_id)) if __name__ == \"__main__\": main()"
  },
  {
    "h1": "Примеры",
    "h2": "Функция получения и вывода счетов клиента",
    "fragment": "examples/client.py import os from tinkoff.invest import Client TOKEN = os.environ[\"INVEST_TOKEN\"] def main(): with Client(TOKEN) as client: print(client.users.get_accounts()) if __name__ == \"__main__\": main()"
  },
  {
    "h1": "Примеры",
    "h2": "Загрузка и вывод всех минутных свечей по интрументу",
    "fragment": "examples/download_all_candles.py import logging import os from datetime import timedelta from pathlib import Path from tinkoff.invest import CandleInterval, Client from tinkoff.invest.caching.market_data_cache.cache_settings import ( MarketDataCacheSettings, ) from tinkoff.invest.services import MarketDataCache from tinkoff.invest.utils import now TOKEN = os.environ[\"INVEST_TOKEN\"] logging.basicConfig(format=\"%(asctime)s %(levelname)s:%(message)s\", level=logging.DEBUG) def main(): with Client(TOKEN) as client: settings = MarketDataCacheSettings(base_cache_dir=Path(\"market_data_cache\")) market_data_cache = MarketDataCache(settings=settings, services=client) for candle in market_data_cache.get_all_candles( figi=\"BBG004730N88\", from_=now() - timedelta(days=3), interval=CandleInterval.CANDLE_INTERVAL_1_MIN, ): print(candle.time) return 0 if __name__ == \"__main__\": main()"
  },
  {
    "h1": "Примеры",
    "h2": "Асинхронная подписка на стрим минутных свечей",
    "fragment": "examples/easy_async_stream_client.py import asyncio import os from tinkoff.invest import ( AsyncClient, CandleInstrument, InfoInstrument, SubscriptionInterval, ) from tinkoff.invest.async_services import AsyncMarketDataStreamManager TOKEN = os.environ[\"INVEST_TOKEN\"] async def main(): async with AsyncClient(TOKEN) as client: market_data_stream: AsyncMarketDataStreamManager = ( client.create_market_data_stream() ) market_data_stream.candles.waiting_close().subscribe( [ CandleInstrument( figi=\"BBG004730N88\", interval=SubscriptionInterval.SUBSCRIPTION_INTERVAL_ONE_MINUTE, ) ] ) async for marketdata in market_data_stream: print(marketdata) market_data_stream.info.subscribe([InfoInstrument(figi=\"BBG004730N88\")]) if marketdata.subscribe_info_response: market_data_stream.stop() if __name__ == \"__main__\": asyncio.run(main())"
  },
  {
    "h1": "Примеры",
    "h2": "Простая подписка на стрим минутных свечей",
    "fragment": "examples/easy_stream_client.py import os from tinkoff.invest import ( CandleInstrument, Client, InfoInstrument, SubscriptionInterval, ) from tinkoff.invest.services import MarketDataStreamManager TOKEN = os.environ[\"INVEST_TOKEN\"] def main(): with Client(TOKEN) as client: market_data_stream: MarketDataStreamManager = client.create_market_data_stream() market_data_stream.candles.waiting_close().subscribe( [ CandleInstrument( figi=\"BBG004730N88\", interval=SubscriptionInterval.SUBSCRIPTION_INTERVAL_ONE_MINUTE, ) ] ) for marketdata in market_data_stream: print(marketdata) market_data_stream.info.subscribe([InfoInstrument(figi=\"BBG004730N88\")]) if marketdata.subscribe_info_response: market_data_stream.stop() if __name__ == \"__main__\": main()"
  },
  {
    "h1": "Примеры",
    "h2": "Получение списка операций и их постраничный вывод",
    "fragment": "examples/get_operations_by_cursor.py import os from tinkoff.invest import Client, GetOperationsByCursorRequest token = os.environ[\"INVEST_TOKEN\"] with Client(token) as client: accounts = client.users.get_accounts() account_id = accounts.accounts[0].id def get_request(cursor=\"\"): return GetOperationsByCursorRequest( account_id=account_id, instrument_id=\"BBG004730N88\", cursor=cursor, limit=1, ) operations = client.operations.get_operations_by_cursor(get_request()) print(operations) while operations.has_next: request = get_request(cursor=operations.next_cursor) operations = client.operations.get_operations_by_cursor(request) print(operations)"
  },
  {
    "h1": "Примеры",
    "h2": "Функция кэширования инструментов",
    "fragment": "examples/instrument_cache.py import logging import os from pprint import pprint from tinkoff.invest import Client, InstrumentIdType from tinkoff.invest.caching.instruments_cache.instruments_cache import InstrumentsCache from tinkoff.invest.caching.instruments_cache.settings import InstrumentsCacheSettings TOKEN = os.environ[\"INVEST_TOKEN\"] logging.basicConfig(level=logging.INFO) def main(): with Client(TOKEN) as client: inst = client.instruments.etfs().instruments[-1] pprint(inst) from_server = client.instruments.etf_by( id_type=InstrumentIdType.INSTRUMENT_ID_TYPE_UID, class_code=inst.class_code, id=inst.uid, ) pprint(from_server) settings = InstrumentsCacheSettings() instruments_cache = InstrumentsCache( settings=settings, instruments_service=client.instruments ) from_cache = instruments_cache.etf_by( id_type=InstrumentIdType.INSTRUMENT_ID_TYPE_UID, class_code=inst.class_code, id=inst.uid, ) pprint(from_cache) if str(from_server) != str(from_cache): raise Exception(\"cache miss\") if __name__ == \"__main__\": main()"
  },
  {
    "h1": "Примеры",
    "h2": "Функция получения списка инструментов подходящих под строку query",
    "fragment": "examples/instruments.py import os from tinkoff.invest import Client TOKEN = os.environ[\"INVEST_TOKEN\"] def main(): with Client(TOKEN) as client: r = client.instruments.find_instrument(query=\"BBG001M2SC01\") for i in r.instruments: print(i) if __name__ == \"__main__\": main()"
  },
  {
    "h1": "Примеры",
    "h2": "Функция логгирования ошибок",
    "fragment": "examples/logger.py import logging import os from tinkoff.invest import Client, RequestError TOKEN = os.environ[\"INVEST_TOKEN\"] logging.basicConfig(format=\"%(asctime)s %(levelname)s:%(message)s\", level=logging.INFO) logger = logging.getLogger(__name__) def main(): with Client(TOKEN) as client: _ = client.users.get_accounts().accounts try: client.users.get_margin_attributes(account_id=\"123\") except RequestError as err: tracking_id = err.metadata.tracking_id if err.metadata else \"\" logger.error(\"Error tracking_id=%s code=%s\", tracking_id, str(err.code)) if __name__ == \"__main__\": main()"
  },
  {
    "h1": "Примеры",
    "h2": "Подписка на стрим портфолио и вывод информации",
    "fragment": "examples/porfolio_stream_client.py import os from tinkoff.invest import Client TOKEN = os.environ[\"INVEST_TOKEN\"] def main(): with Client(TOKEN) as client: accounts = client.users.get_accounts() for portfolio in client.operations_stream.portfolio_stream( accounts=[acc.id for acc in accounts.accounts] ): print(portfolio) if __name__ == \"__main__\": main()"
  },
  {
    "h1": "Примеры",
    "h2": "Подписка на стрим позиций и вывод информации",
    "fragment": "examples/positions_stream.py import os from tinkoff.invest import Client TOKEN = os.environ[\"INVEST_TOKEN\"] def main(): with Client(TOKEN) as client: response = client.users.get_accounts() accounts = [account.id for account in response.accounts] for response in client.operations_stream.positions_stream(accounts=accounts): print(response) if __name__ == \"__main__\": main()"
  },
  {
    "h1": "Примеры",
    "h2": "Функция получения и вывода минутных свечей",
    "fragment": "examples/retrying_client.py import logging import os from datetime import timedelta from tinkoff.invest import CandleInterval from tinkoff.invest.retrying.settings import RetryClientSettings from tinkoff.invest.retrying.sync.client import RetryingClient from tinkoff.invest.utils import now logging.basicConfig(format=\"%(asctime)s %(levelname)s:%(message)s\", level=logging.DEBUG) TOKEN = os.environ[\"INVEST_TOKEN\"] retry_settings = RetryClientSettings(use_retry=True, max_retry_attempt=2) with RetryingClient(TOKEN, settings=retry_settings) as client: for candle in client.get_all_candles( figi=\"BBG000B9XRY4\", from_=now() - timedelta(days=301), interval=CandleInterval.CANDLE_INTERVAL_1_MIN, ): print(candle)"
  },
  {
    "h1": "Примеры",
    "h2": "Получение и вывод информации об аккаунте пользователя в песочнице",
    "fragment": "examples/sandbox_client.py import os from tinkoff.invest.sandbox.client import SandboxClient TOKEN = os.environ[\"INVEST_TOKEN\"] def main(): with SandboxClient(TOKEN) as client: print(client.users.get_info()) if __name__ == \"__main__\": main()"
  },
  {
    "h1": "Примеры",
    "h2": "Подписка на стрим минутных свечей и их вывод",
    "fragment": "examples/stream_client.py import os import time from tinkoff.invest import ( CandleInstrument, Client, MarketDataRequest, SubscribeCandlesRequest, SubscriptionAction, SubscriptionInterval, ) TOKEN = os.environ[\"INVEST_TOKEN\"] def main(): def request_iterator(): yield MarketDataRequest( subscribe_candles_request=SubscribeCandlesRequest( waiting_close=True, subscription_action=SubscriptionAction.SUBSCRIPTION_ACTION_SUBSCRIBE, instruments=[ CandleInstrument( figi=\"BBG004730N88\", interval=SubscriptionInterval.SUBSCRIPTION_INTERVAL_ONE_MINUTE, ) ], ) ) while True: time.sleep(1) with Client(TOKEN) as client: for marketdata in client.market_data_stream.market_data_stream( request_iterator() ): print(marketdata) if __name__ == \"__main__\": main()"
  },
  {
    "h1": "Примеры",
    "h2": "Создание тэйк-профит стоп ордера",
    "fragment": "examples/wiseplat_create_take_profit_stop_order.py \"\"\"Example - How to create takeprofit buy order.\"\"\" import logging import os from decimal import Decimal from tinkoff.invest import ( Client, InstrumentIdType, StopOrderDirection, StopOrderExpirationType, StopOrderType, ) from tinkoff.invest.exceptions import InvestError from tinkoff.invest.utils import decimal_to_quotation, quotation_to_decimal TOKEN = os.environ[\"INVEST_TOKEN\"] logging.basicConfig(format=\"%(asctime)s %(levelname)s:%(message)s\", level=logging.DEBUG) logger = logging.getLogger(__name__) def main(): \"\"\"Example - How to create takeprofit buy order.\"\"\" with Client(TOKEN) as client: response = client.users.get_accounts() account, *_ = response.accounts account_id = account.id logger.info(\"Orders: %s\", client.orders.get_orders(account_id=account_id)) figi = \"BBG004730ZJ9\" # BBG004730ZJ9 - VTBR / BBG004730N88 - SBER # getting the last price for instrument last_price = ( client.market_data.get_last_prices(figi=[figi]).last_prices[0].price ) last_price = quotation_to_decimal(last_price) print(f\"figi, last price = {last_price}\") # setting the percentage by which the takeprofit stop order # should be set below the last price percent_down = 5 # calculation of the price for takeprofit stop order calculated_price = last_price - last_price * Decimal(percent_down / 100) print(f\"calculated_price = {calculated_price}\") # getting the min price increment and the number of digits after point min_price_increment = client.instruments.get_instrument_by( id_type=InstrumentIdType.INSTRUMENT_ID_TYPE_FIGI, id=figi ).instrument.min_price_increment number_digits_after_point = 9 - len(str(min_price_increment.nano)) + 1 min_price_increment = quotation_to_decimal(min_price_increment) print( f\"min_price_increment = {min_price_increment}, \" f\"number_digits_after_point={number_digits_after_point}\" ) # calculation of the price for instrument which is # divisible to min price increment calculated_price = ( round(calculated_price / min_price_increment) * min_price_increment ) print( f\"let's send stop order at price = \" f\"{calculated_price:.{number_digits_after_point}f} divisible to \" f\"min price increment {min_price_increment}\" ) # creating takeprofit buy order stop_order_type = StopOrderType.STOP_ORDER_TYPE_TAKE_PROFIT direction = StopOrderDirection.STOP_ORDER_DIRECTION_BUY exp_type = StopOrderExpirationType.STOP_ORDER_EXPIRATION_TYPE_GOOD_TILL_CANCEL try: response = client.stop_orders.post_stop_order( figi=figi, quantity=1, price=decimal_to_quotation(Decimal(calculated_price)), stop_price=decimal_to_quotation(Decimal(calculated_price)), direction=direction, account_id=account_id, expiration_type=exp_type, stop_order_type=stop_order_type, expire_date=None, ) print(response) print(\"stop_order_id=\", response.stop_order_id) except InvestError as error: logger.error(\"Posting trade takeprofit order failed. Exception: %s\", error) if __name__ == \"__main__\": main()"
  },
  {
    "h1": "Примеры",
    "h2": "Отмена всех выставленных стоп ордеров",
    "fragment": "examples/wiseplat_cancel_all_stop_orders.py \"\"\"Example - How to cancel all stop orders.\"\"\" import logging import os from tinkoff.invest import Client from tinkoff.invest.exceptions import InvestError TOKEN = os.environ[\"INVEST_TOKEN\"] logging.basicConfig(format=\"%(asctime)s %(levelname)s:%(message)s\", level=logging.DEBUG) logger = logging.getLogger(__name__) def main(): \"\"\"Example - How to cancel all stop orders.\"\"\" with Client(TOKEN) as client: response = client.users.get_accounts() account, *_ = response.accounts account_id = account.id try: stop_orders_response = client.stop_orders.get_stop_orders( account_id=account_id ) logger.info(\"Stop Orders: %s\", stop_orders_response) for stop_order in stop_orders_response.stop_orders: client.stop_orders.cancel_stop_order( account_id=account_id, stop_order_id=stop_order.stop_order_id ) logger.info(\"Stop Order: %s was canceled.\", stop_order.stop_order_id) logger.info( \"Orders: %s\", client.stop_orders.get_stop_orders(account_id=account_id) ) except InvestError as error: logger.error(\"Failed to cancel all orders. Error: %s\", error) if __name__ == \"__main__\": main()"
  },
  {
    "h1": "Примеры",
    "h2": "Получение figi для тикера",
    "fragment": "examples/wiseplat_get_figi_for_ticker.py \"\"\"Example - How to get figi by name of ticker.\"\"\" import logging import os from pandas import DataFrame from tinkoff.invest import Client, SecurityTradingStatus from tinkoff.invest.services import InstrumentsService from tinkoff.invest.utils import quotation_to_decimal TOKEN = os.environ[\"INVEST_TOKEN\"] logging.basicConfig(format=\"%(asctime)s %(levelname)s:%(message)s\", level=logging.DEBUG) logger = logging.getLogger(__name__) def main(): \"\"\"Example - How to get figi by name of ticker.\"\"\" ticker = \"VTBR\" # \"BRH3\" \"SBER\" \"VTBR\" with Client(TOKEN) as client: instruments: InstrumentsService = client.instruments tickers = [] for method in [\"shares\", \"bonds\", \"etfs\", \"currencies\", \"futures\"]: for item in getattr(instruments, method)().instruments: tickers.append( { \"name\": item.name, \"ticker\": item.ticker, \"class_code\": item.class_code, \"figi\": item.figi, \"uid\": item.uid, \"type\": method, \"min_price_increment\": quotation_to_decimal( item.min_price_increment ), \"scale\": 9 - len(str(item.min_price_increment.nano)) + 1, \"lot\": item.lot, \"trading_status\": str( SecurityTradingStatus(item.trading_status).name ), \"api_trade_available_flag\": item.api_trade_available_flag, \"currency\": item.currency, \"exchange\": item.exchange, \"buy_available_flag\": item.buy_available_flag, \"sell_available_flag\": item.sell_available_flag, \"short_enabled_flag\": item.short_enabled_flag, \"klong\": quotation_to_decimal(item.klong), \"kshort\": quotation_to_decimal(item.kshort), } ) tickers_df = DataFrame(tickers) ticker_df = tickers_df[tickers_df[\"ticker\"] == ticker] if ticker_df.empty: logger.error(\"There is no such ticker: %s\", ticker) return figi = ticker_df[\"figi\"].iloc[0] print(f\"\\nTicker {ticker} have figi={figi}\\n\") print(f\"Additional info for this {ticker} ticker:\") print(ticker_df.iloc[0]) if __name__ == \"__main__\": main()"
  },
  {
    "h1": "Примеры",
    "h2": "Получение / установка баланса для песочницы. Получение / закрытие всех песочниц. Создание новой песочницы.",
    "fragment": "examples/wiseplat_set_get_sandbox_balance.py \"\"\" Example - How to set/get balance for sandbox account. How to get/close all sandbox accounts. How to open new sandbox account. \"\"\" import logging import os from datetime import datetime from decimal import Decimal from tinkoff.invest import MoneyValue from tinkoff.invest.sandbox.client import SandboxClient from tinkoff.invest.utils import decimal_to_quotation, quotation_to_decimal TOKEN = os.environ[\"INVEST_TOKEN\"] logging.basicConfig(format=\"%(asctime)s %(levelname)s:%(message)s\", level=logging.DEBUG) logger = logging.getLogger(__name__) def add_money_sandbox(client, account_id, money, currency=\"rub\"): \"\"\"Function to add money to sandbox account.\"\"\" money = decimal_to_quotation(Decimal(money)) return client.sandbox.sandbox_pay_in( account_id=account_id, amount=MoneyValue(units=money.units, nano=money.nano, currency=currency), ) def main(): \"\"\"Example - How to set/get balance for sandbox account. How to get/close all sandbox accounts. How to open new sandbox account.\"\"\" with SandboxClient(TOKEN) as client: # get all sandbox accounts sandbox_accounts = client.users.get_accounts() print(sandbox_accounts) # close all sandbox accounts for sandbox_account in sandbox_accounts.accounts: client.sandbox.close_sandbox_account(account_id=sandbox_account.id) # open new sandbox account sandbox_account = client.sandbox.open_sandbox_account() print(sandbox_account.account_id) account_id = sandbox_account.account_id # add initial 2 000 000 to sandbox account print(add_money_sandbox(client=client, account_id=account_id, money=2000000)) logger.info( \"positions: %s\", client.operations.get_positions(account_id=account_id) ) print( \"money: \", float( quotation_to_decimal( client.operations.get_positions(account_id=account_id).money[0] ) ), ) logger.info(\"orders: %s\", client.orders.get_orders(account_id=account_id)) logger.info( \"positions: %s\", client.operations.get_positions(account_id=account_id) ) logger.info( \"portfolio: %s\", client.operations.get_portfolio(account_id=account_id) ) logger.info( \"operations: %s\", client.operations.get_operations( account_id=account_id, from_=datetime(2023, 1, 1), to=datetime(2023, 2, 5), ), ) logger.info( \"withdraw_limits: %s\", client.operations.get_withdraw_limits(account_id=account_id), ) # add + 2 000 000 to sandbox account, total is 4 000 000 print(add_money_sandbox(client=client, account_id=account_id, money=2000000)) logger.info( \"positions: %s\", client.operations.get_positions(account_id=account_id) ) # close new sandbox account sandbox_account = client.sandbox.close_sandbox_account( account_id=sandbox_account.account_id ) print(sandbox_account) if __name__ == \"__main__\": main()"
  },
  {
    "h1": "Примеры",
    "h2": "Пример live стратегии для нескольких тикеров. Вывод OHLCV для каждой сформировавшейся свечи.",
    "fragment": "examples/wiseplat_live_strategy_print_ohlcv.py \"\"\" This code is an example of applying Trading Strategy for several Tickers. The strategy in this code is for demonstration only purposes - it outputs OHLCV values. Author: Oleg Shpagin, my github: https://github.com/WISEPLAT \"\"\" import asyncio import logging import os from datetime import timedelta from typing import List, Optional from tinkoff.invest import AioRequestError, AsyncClient, CandleInterval, HistoricCandle from tinkoff.invest.async_services import AsyncServices from tinkoff.invest.utils import now TOKEN = os.environ[\"INVEST_TOKEN\"] logging.basicConfig(format=\"%(asctime)s %(levelname)s:%(message)s\", level=logging.DEBUG) logger = logging.getLogger(__name__) class LogOnlyCandlesStrategy: \"\"\"This class is responsible for a strategy. You can put here your methods for your strategy.\"\"\" def __init__( self, figi: str, timeframe: CandleInterval, days_back: int, check_interval: int, client: Optional[AsyncServices], ): self.account_id = None self.figi = figi self.timeframe = timeframe self.days_back = days_back self.check_interval = check_interval self.client = client self.candles: List[HistoricCandle] = [] async def get_historical_data(self): \"\"\" Gets historical data for the instrument. Returns list of candles. Requests all the candles of timeframe from days_back to now. :return: list of HistoricCandle \"\"\" logger.debug( \"Start getting historical data for %s days back from now. figi=%s\", self.days_back, self.figi, ) async for candle in self.client.get_all_candles( figi=self.figi, from_=now() - timedelta(days=self.days_back), to=now(), interval=self.timeframe, ): if candle not in self.candles: if candle.is_complete: self.candles.append(candle) logger.debug(\"Found %s - figi=%s\", candle, self.figi) async def ensure_market_open(self): \"\"\" Ensure that the market is open. Loop until the instrument is available. :return: when instrument is available for trading \"\"\" trading_status = await self.client.market_data.get_trading_status( figi=self.figi ) while not ( trading_status.market_order_available_flag and trading_status.api_trade_available_flag ): logger.debug(\"Waiting for the market to open. figi=%s\", self.figi) await asyncio.sleep(60) trading_status = await self.client.market_data.get_trading_status( figi=self.figi ) async def main_cycle(self): \"\"\"Main cycle for live strategy.\"\"\" while True: try: await self.ensure_market_open() await self.get_historical_data() # put your strategy code here for live # to generate signals for buying or selling tickers logger.debug( \"- live mode: run some strategy code to buy or sell - figi=%s\", self.figi, ) except AioRequestError as are: logger.error(\"Client error %s\", are) await asyncio.sleep(self.check_interval) async def start(self): \"\"\"Strategy starts from this function.\"\"\" if self.account_id is None: try: self.account_id = ( (await self.client.users.get_accounts()).accounts.pop().id ) except AioRequestError as are: logger.error(\"Error taking account id. Stopping strategy. %s\", are) return await self.main_cycle() async def run_strategy(portfolio, timeframe, days_back, check_interval): \"\"\"From this function we are starting strategy for every ticker from portfolio. \"\"\" async with AsyncClient(token=TOKEN, app_name=\"TinkoffApp\") as client: strategy_tasks = [] for instrument in portfolio: strategy = LogOnlyCandlesStrategy( figi=instrument, timeframe=timeframe, days_back=days_back, check_interval=check_interval, client=client, ) strategy_tasks.append(asyncio.create_task(strategy.start())) await asyncio.gather(*strategy_tasks) if __name__ == \"__main__\": sber_figi = \"BBG004730N88\" vtbr_figi = \"BBG004730ZJ9\" portfolio = {sber_figi, vtbr_figi} timeframe = CandleInterval.CANDLE_INTERVAL_1_MIN days_back = 1 check_interval = 10 # seconds to check interval for new completed candle loop = asyncio.get_event_loop() task = loop.create_task( run_strategy( portfolio=portfolio, timeframe=timeframe, days_back=days_back, check_interval=check_interval, ) ) loop.run_until_complete(task)"
  },
  {
    "h1": "Готовые работы",
    "h2": "Готовые стратегии",
    "fragment": "Функция создает дополнительный столбец с действиями (\"ma200_support_action\"), куда записываются сигналы на шорт или лонг по условиям. Затем данные агрегируются и выводятся в виде списка акций, по которым пришли сигналы, в порядке убывания даты сигнала. import logging import os from datetime import timedelta from decimal import Decimal from matplotlib import pyplot as plt from tinkoff.invest import CandleInterval, Client from tinkoff.invest.strategies.base.account_manager import AccountManager from tinkoff.invest.strategies.moving_average.plotter import ( MovingAverageStrategyPlotter, ) from tinkoff.invest.strategies.moving_average.signal_executor import ( MovingAverageSignalExecutor, ) from tinkoff.invest.strategies.moving_average.strategy import MovingAverageStrategy from tinkoff.invest.strategies.moving_average.strategy_settings import ( MovingAverageStrategySettings, ) from tinkoff.invest.strategies.moving_average.strategy_state import ( MovingAverageStrategyState, ) from tinkoff.invest.strategies.moving_average.supervisor import ( MovingAverageStrategySupervisor, ) from tinkoff.invest.strategies.moving_average.trader import MovingAverageStrategyTrader logging.basicConfig(format=\"%(asctime)s %(levelname)s:%(message)s\", level=logging.INFO) logger = logging.getLogger(__name__) TOKEN = os.environ[\"INVEST_TOKEN\"] FIGI = os.environ[\"INVEST_FIGI\"] ACCOUNT_ID = os.environ[\"INVEST_ACCOUNT_ID\"] def main(): with Client(TOKEN) as services: settings = MovingAverageStrategySettings( share_id=FIGI, account_id=ACCOUNT_ID, max_transaction_price=Decimal(10000), candle_interval=CandleInterval.CANDLE_INTERVAL_1_MIN, long_period=timedelta(minutes=100), short_period=timedelta(minutes=20), std_period=timedelta(minutes=30), ) account_manager = AccountManager(services=services, strategy_settings=settings) state = MovingAverageStrategyState() strategy = MovingAverageStrategy( settings=settings, account_manager=account_manager, state=state, ) signal_executor = MovingAverageSignalExecutor( services=services, state=state, settings=settings, ) supervisor = MovingAverageStrategySupervisor() trader = MovingAverageStrategyTrader( strategy=strategy, settings=settings, services=services, state=state, signal_executor=signal_executor, account_manager=account_manager, supervisor=supervisor, ) plotter = MovingAverageStrategyPlotter(settings=settings) initial_balance = account_manager.get_current_balance() for i in range(5): logger.info(\"Trade %s\", i) trader.trade() current_balance = account_manager.get_current_balance() logger.info(\"Initial balance %s\", initial_balance) logger.info(\"Current balance %s\", current_balance) events = supervisor.get_events() plotter.plot(events) plt.show()"
  },
  {
    "h1": "Сервис предоставления справочной информации о пользователе и его счетах в Тинькофф Инвестициях",
    "h2": "Получение списка счетов пользователя",
    "fragment": "Тинькофф Инвестиции позволяют открывать несколько счетов каждому пользователю. Счета так же могут иметь различные типы (брокерский счёт, ИИС, инвесткопилка). Для получения списка счетов, их статусов и типов используется метод getAccounts. Данный метод возвращает только те счета, к которым у пользователя есть доступ. Т.е заблокированные счета выводиться в данном методе не будут. При запросе метода с токеном для одного счета возвращаются данные только по счету, к которому выдан доступ токеном."
  },
  {
    "h1": "Сервис предоставления справочной информации о пользователе и его счетах в Тинькофф Инвестициях",
    "h2": "Получение текущих лимитов запросов пользователя.",
    "fragment": "TINKOFF INVEST API обладает системой динамического назначения лимитов запросов для пользователя. Подробнее о тарифной политике можно почитать по ссылке: Лимиты в TINKOFF INVEST API. В ответе данного метода можно получить информацию по лимитам для каждого метода сервиса TINKOFF INVEST API, а также лимиты, касающиеся stream-соединений."
  },
  {
    "h1": "Сервис предоставления справочной информации о пользователе и его счетах в Тинькофф Инвестициях",
    "h2": "Получение маржинальных показателей по счёту",
    "fragment": "TINKOFF INVEST API предоставляет своим пользователям возможность использовать маржинальную торговлю. Маржинальная торговля — это режим, в котором можно совершать сделки не только со своими деньгами и ценными бумагами, но и с активами, которые вы как бы берёте в долг у брокера. Подробнее о маржинальной торговле: Маржинальная торговля. Для получения показателей маржинальной торговли используется метод getMarginAttributes. Метод getMarginAttributes возвращает следующие параметры: liquid_portfolio - Стоимость плановых позиций активов, которые признаны ликвидными (для которых определены ставки риска). starting_margin - Сумма модулей стоимостей плановых позиций активов, которые признаны ликвидными, умноженных на начальные ставки риска minimal_margin - Сумма модулей стоимостей плановых позиций активов, которые признаны ликвидными, умноженных на минимальные ставки риска funds_sufficiency_level - Уровень достаточности средств. (Стоимость портфеля - Мин.маржа)/(Нач.маржа – Мин.маржа). Округляем до двух знаков после запятой. amount_of_missing_funds - Объем недостающих средств. Высчитывается по формуле starting_margin - liquid_portfolio . corrected_Margin - Начальная маржа, в которой плановые позиции рассчитываются с учётом активных заявок на покупку позиций лонг или продажу позиций шорт"
  },
  {
    "h1": "Сервис предоставления справочной информации о пользователе и его счетах в Тинькофф Инвестициях",
    "h2": "Получение информации о статусе пользователя",
    "fragment": "Для определения различных атрибутов пользователя можно использовать метод getInfo. Данный метод позволяет узнать имеет ли пользователь статус квалифицированного инвестора, является ли премиальным клиентом, а также получить список типов инструментов, к которым имеет доступ по итогам тестирования."
  },
  {
    "h1": "Методы",
    "h2": "UsersService",
    "fragment": "Сервис предназначен для получения: 1. списка счетов пользователя; 2. маржинальных показателей по счёту. Методы сервиса GetAccounts Метод получения счетов пользователя. Тело запроса — GetAccountsRequest Тело ответа — GetAccountsResponse GetMarginAttributes Расчёт маржинальных показателей по счёту. Тело запроса — GetMarginAttributesRequest Тело ответа — GetMarginAttributesResponse GetUserTariff Запрос тарифа пользователя. Тело запроса — GetUserTariffRequest Тело ответа — GetUserTariffResponse GetInfo Метод получения информации о пользователе. Тело запроса — GetInfoRequest Тело ответа — GetInfoResponse Сообщения методов GetAccountsRequest Запрос получения счетов пользователя. GetAccountsResponse Список счетов пользователя. Account Информация о счёте. GetMarginAttributesRequest Запрос маржинальных показателей по счёту GetMarginAttributesResponse Маржинальные показатели по счёту. GetUserTariffRequest Запрос текущих лимитов пользователя. GetUserTariffResponse Текущие лимиты пользователя. UnaryLimit Лимит unary-методов. StreamLimit Лимит stream-соединений. GetInfoRequest Запрос информации о пользователе. GetInfoResponse Информация о пользователе. Enums AccountType Тип счёта. AccountStatus Статус счёта. AccessLevel Уровень доступа к счёту. SecurityTradingStatus Нестандартные типы данных MoneyValue Денежная сумма в определенной валюте Quotation Котировка - денежная сумма без указания валюты"
  },
  {
    "h1": "FAQ",
    "h2": "Без подзаголовка",
    "fragment": "Как быстро после появления счёта можно начинать с ним работать? Обычно новый счёт становится доступен для работы через TINKOFF INVEST API в течении часа после открытия. В редких случаях эта задержка может составлять до двух часов. Какие есть варианты значения поля qualified_for_work_with Поле qualified_for_work_with определяет, какие типы тестов пройдены клиентом в мобильном приложении, возможные варианты: По типам инструментов: derivative - Фьючерсы и опционы structured_bonds - Структурные облигации closed_fund - Закрытые паевые фонды bond - Облигации с низким рейтингом structured_income_bonds - Облигации со структурным доходом foreign_shares - Иностранные акции, не включенных в котировальные списки биржи foreign_etf - Иностранные ETF foreign_bond - Еврооблигации russian_shares - Акции, не включенные в котировальные списки По типам сделок: leverage - Маржинальная торговля, необеспеченные сделки на заемные средства repo - Договора репо"
  },
  {
    "h1": "Сервис предоставления справочной информации о ценных бумагах",
    "h2": "Получение параметров ценных бумаг",
    "fragment": "Получение справочной информации об инструментах, торгуемых на бирже, является первоочередной задачей, которая стоит перед разработчиком торгового робота. Для реализации этой потребности в TINKOFF INVEST API существует набор unary-методов. Обратите внимание, что методы разделены по типам инструментов (акции, облигации, фонды и т.д.). Например, для получения списка облигаций используется метод getInstruments/bonds, а для получения информации по конкретной облигации метод getInstruments/bondBy. Методы получения информации по конкретному инструменту позволяют использовать в качестве идентификатора figi, isin или связку тикер плюс класс-код. Подробнее об особенностях идентификации инструментов можно почитать по ссылке: Идентификация инструментов"
  },
  {
    "h1": "Сервис предоставления справочной информации о ценных бумагах",
    "h2": "Получение расписания торгов",
    "fragment": "Для определения времени запуска или остановки торгового робота разработчику требуется также учитывать расписание торгов на той или иной торговой площадке внутри брокера TINKOFF, (Подробнее о режимах торгов). Такая информация предоставляется методом getTradingSchedules. Данный метод позволяет получить информацию как по конкретной бирже, так и по всему списку доступных в TINKOFF INVEST API торговых площадок. Обратите внимание, что расписание торгов может меняться в связи с какими-либо внешними обстоятельствами — специалисты Тинькофф стараются максимально оперативно реагировать на такие изменения. Поэтому разумнее не ориентироваться на расписание, запрошенное по длительному периоду, а запрашивать режимы торгов на более короткие интервалы, например, на текущий день. Метод getTradingSchedules позволяет получать расписание торгов на период не длиннее одной недели с текущего дня (запрос раcписания в прошлом недоступен). Так же важно понимать, что в процессе работы торговой площадки могут случаться моменты приостановки торгов по той или иной ценной бумаге (например, в следствии резко возросшей волатильности). Поэтому для определения доступности в данный момент торгов по конкретному инструменту лучше использовать параметр trading_status, который возвращается в рамках подписки на получение статуса инструмента сервиса котировок. Важно!!! Метод getTradingSchedules возвращает торговое расписание на секции биржи внутри брокера TINKOFF. Данное расписание может не совпадать с реальным расписанием торгов на бирже."
  },
  {
    "h1": "Сервис предоставления справочной информации о ценных бумагах",
    "h2": "Получение расписания выплаты купонов по облигациям",
    "fragment": "Облигация — это долговая ценная бумага, почти как долговая расписка. Выпуская облигации, компания или государство берет деньги в долг и затем возвращает их с процентами(Подробнее про облигации). Операции по регулярным выплатам процентов по облигации называются купонами. Для получения графика таких выплат используется метод getAccruedInterests. Метод позволяет получить график выплаты купонов для запрошенного периода времени."
  },
  {
    "h1": "Сервис предоставления справочной информации о ценных бумагах",
    "h2": "Получения размера гарантийного обеспечения по фьючерсу",
    "fragment": "Фьючерс — это договор между покупателем и продавцом о поставке базового актива в будущем или о выплате одной из сторон другой стороне разницы между стоимостью контракта и стоимостью базового актива в будущем (Срочный рынок). Для операций с фьючерсами брокером \"замораживается\" определённый размер гарантийного обеспечения на счёте пользователя. Для получения информации о размере этого обеспечения используется метод getFuturesMargin. Обратите внимание, что размер гарантийного обеспечения может отличаться для операций покупки и продажи фьючерса."
  },
  {
    "h1": "Сервис предоставления справочной информации о ценных бумагах",
    "h2": "Получение и изменение списка избранных инструментов",
    "fragment": "Используя метод GetFavorites можно получить список избранных инструментов клиента. Данный метод может использоваться разработчиками для получения списка инструментов, которые робот добавил в избранное используя метод EditFavorites. Для добавления или удаления инструментов из списка избранных можно использовать EditFavorites. Данный метод позволяет разработчикам автоматизировать выделение наиболее интересных инструментов путем редактирования списка избранных инструментов. Использование метода ограничено 100 инструментов. При попытке передать больше 100 инструментов будет возвращена ошибка \"code\":\"30091\" и \"message\":\"quantity of instruments can't be more than 100\" Важно!!! Если вы хотите добавить в список избранных инструментов валюту, то это необходимо делать через валюту с лотностью = 1. Инструменты валюты с разной лотностью имеют разные значения идентификаторов. Например, FIGI доллара США с лотностью 1000 - TCS0013HGFT4, а FIGI доллара США с лотностью 1 - USD000UTSTOM. FIGI евро с лотностью 1000 - BBG0013HJJ31, а FIGI доллара США с лотностью 1 - EUR000UTSTOM. Приведем пояснение, есть позиция - валюта (например, доллар). У позиции есть разные инструменты, которыми можно торговать. Например, у доллара это могут быть инструменты с лотностью в 1 доллар или 1000 долларов. Так же все инструменты добавленные в избранное будут отображаться в списке избранных в мобильном приложении Инвестиции и на сайте Тинькофф Инвестиции. Определение биржи на которой исполняются расчеты по инструменту Для определения биржи на которой исполняются расчеты по финансовому инструменту в TINKOFF INVEST API добавлен параметр real_exchange. Список методов, возвращающих в ответе биржу, на которой исполняются расчеты: GetInstrumentBy - Метод получения основной информации об инструменте. GetBondBy - Метод получения облигации по её идентификатору. GetBonds - Метод получения списка облигаций. GetShareBy - Метод получения акции по её идентификатору. GetShares - Метод получения списка акций. GetEtfBy - Метод получения инвестиционного фонда по его идентификатору. GetEtfs - Метод получения списка инвестиционных фондов. GetFutureBy - Метод получения фьючерса по его идентификатору. GetFutures - Метод получения списка фьючерсов. GetCurrencyBy - Метод получения валюты по её идентификатору. GetCurrencies - Метод получения списка валют. Поиск инструментов Для поиска инструментов в TINKOFF INVEST API предусмотрено большое количество методов. Для поиска по идентификаторам вы можете воспользоваться следующими методами в зависимости от типа искомого инструмента: GetInstrumentBy - Метод получения основной информации об инструменте. GetBondBy - Метод получения облигации по её идентификатору. GetBonds - Метод получения списка облигаций. GetShareBy - Метод получения акции по её идентификатору. GetShares - Метод получения списка акций. GetEtfBy - Метод получения инвестиционного фонда по его идентификатору. GetEtfs - Метод получения списка инвестиционных фондов. GetFutureBy - Метод получения фьючерса по его идентификатору. GetFutures - Метод получения списка фьючерсов. GetCurrencyBy - Метод получения валюты по её идентификатору. GetCurrencies - Метод получения списка валют. Так же разработан метод поиска инструмента по различным параметрам - FindInstrument. Данный метод выполняет регистронезависимый поиск по вхождению строки query согласно следующему приоритету: position_uid uid figi isin ticker name Так же используя метод FindInstrument можно найти базовый актив фьючерса. Для этого достаточно передать в query значение параметра basic_asset_position_uid, возвращаемое методами GetFutureBy и GetFutures. Доступность торговли инструмента через API Для получения информации о возможности торговли инструментом через API в сервисе инструментов в методе FindInstrument существует параметр api_trade_available_flag. Если api_trade_available_flag = true, то торговля инструментом через API доступна. Справочник стран Для загрузки справочника стран в TINKOFF INVEST API существует метод getCountries. Данный метод возвращает массив объектов, который содержит двухбуквенный и трехбуквенный код страны, а так же полное и краткое наименование страны. Полученный список стран можно применять для сопоставления страны риска актива. Активы В TINKOFF INVEST API представлены два метода для получения активов. Используя метод getAssets сервиса инструментов можно получить список всех активов. Метод работает для всех инструментов, за исключением срочных - опционов и фьючерсов. Данный метод возвращает краткую информацию об активе: Идентификатор Тип актива Название актива Массив инструментов актива Используя метод getAssetBy сервиса инструментов можно найти актив по его идентификатору. Этот метод возвращает более подробную информацию о запрошенном активе. Набор данных отличается в зависимости от типа актива. Бренды В TINKOFF INVEST API представлены два метода для получения брендов. Используя метод getBrands сервиса инструментов можно получить список всех брендов. Используя метод getBrandBy сервиса инструментов можно найти бренд по его идентификатору. Поиск инструмента по позиции Для поиска инструмента по идентификатору позиции (Position_uid) добавлен тип идентификатора инструмента - INSTRUMENT_ID_TYPE_POSITION_UID. Использовать id_type = INSTRUMENT_ID_TYPE_POSITION_UID можно методах: GetInstrumentBy - Метод получения основной информации об инструменте. GetBondBy - Метод получения облигации по её идентификатору. GetShareBy - Метод получения акции по её идентификатору. GetEtfBy - Метод получения инвестиционного фонда по его идентификатору. GetFutureBy - Метод получения фьючерса по его идентификатору. GetOptionBy - Метод получения опциона по его идентификатору. GetCurrencyBy - Метод получения валюты по её идентификатору. Получение информации по опционам В TINKOFF INVEST API добавлены методы: GetOptionBy - Метод получения опциона по его идентификатору. GetOptions - Метод получения опционов. С помощью данных методов можно получить информацию об опционах, страйках и датах экспирации. Так же можно получить информацию о базовом активе опциона, найти его по идентификатору позиции базового инструмента (basicAssetPositionUid). В метод getPositions добавлен массив опционов в портфеле. Важно! На данный момент получить информацию об опционах в методе FindInstrument нельзя. Торговые статусы инструментов и расписание торгов Информацию о статусах инструментов и расписаниях торгов вы можете получить на странице Торговые статусы инструментов и расписание торгов. Так же рекомендуем смотреть актуальную информацию по режимам и статусам торгов на сайтах Московской биржи и СПБ биржи. Доступность торговли инструментом квалифицированному инвестору Для того что бы определить доступность торговли инструментом для не квалифицированных инструментов в методах сервиса инструментов добавлен флаг for_qual_investor_flag. for_qual_investor_flag - флаг, отображающий доступность торговли инструментом только для квалифицированных инвесторов. График выплаты дивидендов по инструменту Для получения информации по срокам выплаты дивидендов по инструменту необходимо использовать метод getDividends. Необходимо учитывать, что входной параметр to - Окончание запрашиваемого периода в часовом поясе UTC, фильтрует выходные данные по параметру record_date - дате фиксации реестра."
  },
  {
    "h1": "Методы",
    "h2": "InstrumentsService",
    "fragment": "Сервис предназначен для получения: 1. информации об инструментах; 2. расписания торговых сессий; 3. календаря выплат купонов по облигациям; 4. размера гарантийного обеспечения по фьючерсам; 5. дивидендов по ценной бумаге. Методы сервиса TradingSchedules Метод получения расписания торгов торговых площадок. Тело запроса — TradingSchedulesRequest Тело ответа — TradingSchedulesResponse BondBy Метод получения облигации по её идентификатору. Тело запроса — InstrumentRequest Тело ответа — BondResponse Bonds Метод получения списка облигаций. Тело запроса — InstrumentsRequest Тело ответа — BondsResponse GetBondCoupons Метод получения графика выплат купонов по облигации. Тело запроса — GetBondCouponsRequest Тело ответа — GetBondCouponsResponse CurrencyBy Метод получения валюты по её идентификатору. Тело запроса — InstrumentRequest Тело ответа — CurrencyResponse Currencies Метод получения списка валют. Тело запроса — InstrumentsRequest Тело ответа — CurrenciesResponse EtfBy Метод получения инвестиционного фонда по его идентификатору. Тело запроса — InstrumentRequest Тело ответа — EtfResponse Etfs Метод получения списка инвестиционных фондов. Тело запроса — InstrumentsRequest Тело ответа — EtfsResponse FutureBy Метод получения фьючерса по его идентификатору. Тело запроса — InstrumentRequest Тело ответа — FutureResponse Futures Метод получения списка фьючерсов. Тело запроса — InstrumentsRequest Тело ответа — FuturesResponse OptionBy Метод получения опциона по его идентификатору. Тело запроса — InstrumentRequest Тело ответа — OptionResponse Options Deprecated Метод получения списка опционов. Тело запроса — InstrumentsRequest Тело ответа — OptionsResponse OptionsBy Метод получения списка опционов. Тело запроса — FilterOptionsRequest Тело ответа — OptionsResponse ShareBy Метод получения акции по её идентификатору. Тело запроса — InstrumentRequest Тело ответа — ShareResponse Shares Метод получения списка акций. Тело запроса — InstrumentsRequest Тело ответа — SharesResponse GetAccruedInterests Метод получения накопленного купонного дохода по облигации. Тело запроса — GetAccruedInterestsRequest Тело ответа — GetAccruedInterestsResponse GetFuturesMargin Метод получения размера гарантийного обеспечения по фьючерсам. Тело запроса — GetFuturesMarginRequest Тело ответа — GetFuturesMarginResponse GetInstrumentBy Метод получения основной информации об инструменте. Тело запроса — InstrumentRequest Тело ответа — InstrumentResponse GetDividends Метод для получения событий выплаты дивидендов по инструменту. Тело запроса — GetDividendsRequest Тело ответа — GetDividendsResponse GetAssetBy Метод получения актива по его идентификатору. Тело запроса — AssetRequest Тело ответа — AssetResponse GetAssets Метод получения списка активов. Метод работает для всех инструментов, за исключением срочных - опционов и фьючерсов. Тело запроса — AssetsRequest Тело ответа — AssetsResponse GetFavorites Метод получения списка избранных инструментов. Тело запроса — GetFavoritesRequest Тело ответа — GetFavoritesResponse EditFavorites Метод редактирования списка избранных инструментов. Тело запроса — EditFavoritesRequest Тело ответа — EditFavoritesResponse GetCountries Метод получения списка стран. Тело запроса — GetCountriesRequest Тело ответа — GetCountriesResponse FindInstrument Метод поиска инструмента. Тело запроса — FindInstrumentRequest Тело ответа — FindInstrumentResponse GetBrands Метод получения списка брендов. Тело запроса — GetBrandsRequest Тело ответа — GetBrandsResponse GetBrandBy Метод получения бренда по его идентификатору. Тело запроса — GetBrandRequest Тело ответа — Brand Сообщения методов TradingSchedulesRequest Запрос расписания торгов. TradingSchedulesResponse Список торговых площадок. TradingSchedule Данные по торговой площадке. TradingDay Информация о времени торгов. InstrumentRequest Запрос получения инструмента по идентификатору. InstrumentsRequest Запрос получения инструментов. FilterOptionsRequest Параметры фильтрации опционов BondResponse Информация об облигации. BondsResponse Список облигаций. GetBondCouponsRequest Запрос купонов по облигации. GetBondCouponsResponse Купоны по облигации. Coupon Объект передачи информации о купоне облигации. CurrencyResponse Данные по валюте. CurrenciesResponse Данные по валютам. EtfResponse Данные по фонду. EtfsResponse Данные по фондам. FutureResponse Данные по фьючерсу. FuturesResponse Данные по фьючерсам. OptionResponse Данные по опциону. OptionsResponse Данные по опционам. Option Опцион. ShareResponse Данные по акции. SharesResponse Данные по акциям. Bond Объект передачи информации об облигации. Currency Объект передачи информации о валюте. Etf Объект передачи информации об инвестиционном фонде. Future Объект передачи информации о фьючерсе. Share Объект передачи информации об акции. GetAccruedInterestsRequest Запрос НКД по облигации GetAccruedInterestsResponse НКД облигации AccruedInterest Операция начисления купонов. GetFuturesMarginRequest Запрос информации о фьючерсе GetFuturesMarginResponse Данные по фьючерсу InstrumentResponse Данные по инструменту. Instrument Объект передачи основной информации об инструменте. GetDividendsRequest Запрос дивидендов. GetDividendsResponse Дивиденды. Dividend Информация о выплате. AssetRequest Запрос актива по идентификатору. AssetResponse Данные по активу. AssetsRequest Запрос списка активов. AssetsResponse Список активов. AssetFull Asset Информация об активе. AssetCurrency Валюта. AssetSecurity Ценная бумага. AssetShare Акция. AssetBond Облигация. AssetStructuredProduct Структурная нота. AssetEtf Фонд. AssetClearingCertificate Клиринговый сертификат участия. Brand Бренд. AssetInstrument Идентификаторы инструмента. InstrumentLink Связь с другим инструментом. GetFavoritesRequest Запрос списка избранных инструментов, входные параметры не требуются. GetFavoritesResponse В ответ передаётся список избранных инструментов в качестве массива. FavoriteInstrument Массив избранных инструментов. EditFavoritesRequest Запрос редактирования списка избранных инструментов. EditFavoritesRequestInstrument Массив инструментов для редактирования списка избранных инструментов. EditFavoritesResponse Результат редактирования списка избранных инструментов. GetCountriesRequest Запрос справочника стран. GetCountriesResponse Справочник стран. CountryResponse Данные о стране. FindInstrumentRequest Запрос на поиск инструментов. FindInstrumentResponse Результат поиска инструментов. InstrumentShort Краткая информация об инструменте. GetBrandsRequest Запрос списка брендов. GetBrandRequest Запрос бренда. GetBrandsResponse Список брендов. Enums CouponType Тип купонов. OptionDirection Тип опциона по направлению сделки. OptionPaymentType Тип расчетов по опциону. OptionStyle Тип опциона по стилю. OptionSettlementType Тип опциона по способу исполнения. InstrumentIdType Тип идентификатора инструмента. Подробнее об идентификации инструментов: Идентификация инструментов InstrumentStatus Статус запрашиваемых инструментов. ShareType Тип акций. AssetType Тип актива. StructuredProductType Тип структурной ноты. EditFavoritesActionType Тип действия со списком избранных инструментов. RealExchange Реальная площадка исполнения расчётов. RiskLevel Уровень риска облигации. SecurityTradingStatus Нестандартные типы данных MoneyValue Денежная сумма в определенной валюте Quotation Котировка - денежная сумма без указания валюты Что такое Figi инструмента? FIGI(англ.: Financial Instrument Global Identifier) — глобальный идентификатор финансового инструмента. Представляет собой 12-символьный код из латинских букв и цифр, определяется как идентификатор ценной бумаги на торговой площадке (бирже), которая является некоторым \"источником цен\". Нужно понимать, что не все инструменты, доступные в Тинькофф Инвестициях, имеют общепринятый Figi. Поэтому не гарантируется уникальность инструментов с другими источниками. Узнать актуальный Figi-идентификатор инструмента можно при помощи методов сервиса инструментов. На данный момент основным идентификатором внутри Тинькофф Инвестиций является uid, который позволяет избежать возможной путаницы. Как мне найти Figi инструмента по его названию, тикеру или isin? Методы поиска инструментов по идентификатору (BondBy, CurrencyBy, EtfBy, FutureBy, ShareBy) позволяют получить информацию об инструменте зная его Figi или связку ticker + class_code. Если же эти идентификаторы вам неизвестны, вы можете получить полный список инструментов определённого типа методами запроса списков инструментов (Bonds, Currencies, Etfs, Futures, Shares) и выполнить поиск по известным параметрам самостоятельно. Сделать это можно в коде робота или при помощи любого доступного gRPC-клиента, например, Kreya. Инструкция по настройке Kreya доступна по ссылке. Что такое class_code и где его найти? Сlass_code — это технический параметр \"Режим торгов\", используемый для обозначения секции биржи, на которой торгуется данный инструмент. Узнать его можно, получив детали по инструменту методами сервиса инструментов. Как понять, что бумага доступна для торговли через TINKOFF INVEST API? Чтобы получить все доступные для торговли инструменты определённого типа можно воспользоваться соответствующими методами, передав параметр instrument_status = INSTRUMENT_STATUS_BASE: * Bonds * Currencies * Etfs * Futures * Shares Если же нет необходимости получать полный список инструментов, можно использовать параметр api_trade_available_flag из ответа метода получения инструмента по его идентификатору (BondBy, CurrencyBy, EtfBy, FutureBy, ShareBy). Этот флаг отвечает за доступность инструмента для торгов через TINKOFF INVEST API. Кроме того следует учитывать расписание работы бирж и торговый статус инструмента. Подробнее: Торговые статусы инструментов и расписание торгов. Что такое накопленный купонный доход облигации и как его узнать? Купон, или купонный доход — это процентные выплаты держателям облигаций со стороны эмитента, то есть компании или госоргана, выпустивших этот тип ценных бумаг. Даты выплат процентов по облигациям и размер купона известны заранее. Размер купона задается в процентах от номинала — то есть от цены облигации при ее выпуске. Величина купона может быть фиксированной или плавающей — то есть привязанной к инфляции, ключевой ставке Центробанка России или другим ориентирам. Иногда у облигации может вовсе не быть купона. Купонный доход по облигациям. Получить календарь купонных выплат можно методом GetAccruedInterests. Как узнать стоимость шага цены(min_price_increment_amount) фьючерса? Данный параметр может изменяться довольно часто в течении дня, поэтому для его получения существует отдельный метод сервиса инструментов GetFuturesMargin. Как узнать на какой бирже исполняются расчеты по инструменту? Для определения биржи на которой исполняются расчеты по финансовому инструменту в TINKOFF INVEST API добавлен параметр real_exchange. Список методов возвращающих в ответе биржу на которой исполняются расчеты: GetInstrumentBy - Метод получения основной информации об инструменте. GetBondBy - Метод получения облигации по её идентификатору. GetBonds - Метод получения списка облигаций. GetShareBy - Метод получения акции по её идентификатору. GetShares - Метод получения списка акций. GetEtfBy - Метод получения инвестиционного фонда по его идентификатору. GetEtfs - Метод получения списка инвестиционных фондов. GetFutureBy - Метод получения фьючерса по его идентификатору. GetFutures - Метод получения списка фьючерсов. GetCurrencyBy - Метод получения валюты по её идентификатору. GetCurrencies - Метод получения списка валют. GetOptionBy - Метод получения опциона по его идентификатору. GetOptions - Метод получения опционов. Как найти базовый актив фьючерса? Используя метод FindInstrument можно найти базовый актив фьючерса. Для этого достаточно передать в query значение параметра basic_asset_position_uid, возвращаемое методами GetFutureBy и GetFutures. Как получить и изменить список избранных инструментов? Используя метод GetFavorites можно получить список избранных инструментов клиента. Данный метод может использоваться разработчиками для получения списка инструментов, которые робот добавил в избранное используя метод EditFavorites. Для добавления или удаления инструментов из списка избранных можно использовать EditFavorites. Данный метод позволяет разработчикам автоматизировать выделение наиболее интересных инструментов путем редактирования списка избранных инструментов. Использование метода ограничено 100 инструментов. При попытке передать больше 100 инструментов будет возвращена ошибка \"code\":\"30091\" и \"message\":\"quantity of instruments can't be more than 100\". Важно!!! Если вы хотите добавить в список избранных инструментов валюту, то это необходимо делать через валюту с лотностью = 1. Инструменты валюты с разной лотностью имеют разные значения идентификаторов. Например, FIGI доллара США с лотностью 1000 - TCS0013HGFT4, а FIGI доллара США с лотностью 1 - USD000UTSTOM. FIGI евро с лотностью 1000 - BBG0013HJJ31, а FIGI доллара США с лотностью 1 - EUR000UTSTOM. Как отличить инструмент доступный для ИИС? В методах получения информации об инструментах добавлен флаг For_iis_flag принимающий булево значение в зависимости от доступности инструмента для ИИС. Как получить информацию об активах? В TINKOFF INVEST API представлены два метода для получения активов. Используя метод getAssets сервиса инструментов можно получить список всех активов. Метод работает для всех инструментов, за исключением срочных - опционов и фьючерсов. Используя метод getAssetBy сервиса инструментов можно найти актив по его идентификатору. Этот метод возвращает более подробную информацию о запрошенном активе. Набор данных отличается в зависимости от типа актива. Как получить информацию об брендах? В TINKOFF INVEST API представлены два метода для получения брендов. Используя метод getBrands сервиса инструментов можно получить список всех брендов. Используя метод getBrandBy сервиса инструментов можно найти бренд по его идентификатору. Как по позиции найти инструмент? Для поиска инструмента по идентификатору позиции (Position_uid) добавлен тип идентификатора инструмента - INSTRUMENT_ID_TYPE_POSITION_UID. Использовать id_type = INSTRUMENT_ID_TYPE_POSITION_UID можно методах: GetInstrumentBy - Метод получения основной информации об инструменте. GetBondBy - Метод получения облигации по её идентификатору. GetShareBy - Метод получения акции по её идентификатору. GetEtfBy - Метод получения инвестиционного фонда по его идентификатору. GetFutureBy - Метод получения фьючерса по его идентификатору. GetOptionBy - Метод получения опциона по его идентификатору. GetCurrencyBy - Метод получения валюты по её идентификатору. Ставки риска и их коэфффиценты Чтобы лучше понять тему, вы можете ознакомиться с материалами, указанными в ссылках. Здесь же мы приведем лишь краткое определения и раскроем суть параметров. Ставка риска — это показатель, который брокер использует для расчета суммы, которую вам нужно иметь на счете, чтобы открыть или поддерживать непокрытую позицию. Чем ниже ставка риска, тем крупнее может быть непокрытая позиция — то есть брокер будет готов одолжить больше активов. И наоборот — с высокой ставкой риска размер кредитного плеча в сделке будет небольшим или его не будет вовсе. Больше о ставках риска. Стандартный и повышенный уровни риска. Клиенты российских брокеров — физические лица — делятся на две категории: клиенты со стандартным уровнем риска (КСУР) и клиенты с повышенным уровнем риска (КПУР). Клиентам со стандартным уровнем доступно меньшее кредитное плечо, чем КПУР. Кредитное плечо — это беспроцентный заем, который брокер предоставляет инвестору для совершения сделок на более крупные суммы. Это соотношение между собственными средствами трейдера и заемными деньгами, предоставляемыми брокером или дилинговым центром на специальных условиях. Начальная маржа — это стоимость всех ликвидных активов и фьючерсов в портфеле инвестора, приведенная к рублям по биржевому курсу и умноженная на ставки риска этих активов Скорректированная маржа — это показатель, аналогичный начальной марже, но при этом учитывающий выставленные вами лимитные заявки на увеличение позиции (на любую покупку или на продажу в шорт). Минимальная маржа — это половина от начальной или скорректированной маржи портфеля. Лонг, или длинная позиция, — это сделка по покупке актива, когда инвестор ожидает роста его цены. Если инвесторы хотят заработать на растущем рынке, они торгуют в лонг. Как торговать в шорт? Шорт или короткая позиция, - это сделка по продаже полученного в долг актива с целью через некоторое время выкупить его дешевле и заработать на разнице цен. Когда инвесторы хотят получить прибыль за счет снижения стоимости актива, они торгуют в шорт (также известен как «игра на понижение» или «непокрытая продажа»). Как торговать в шорт? В методе сервиса инструментов в методах есть ряд параметров, связанных со ставками риска: klong - Коэффициент ставки риска длинной позиции по клиенту. 2 – клиент со стандартным уровнем риска (КСУР). 1 – клиент с повышенным уровнем риска (КПУР). kshort - Коэффициент ставки риска короткой позиции по клиенту. 2 – клиент со стандартным уровнем риска (КСУР). 1 – клиент с повышенным уровнем риска (КПУР). dlong - Ставка риска начальной маржи для КСУР лонг. dshort - Ставка риска начальной маржи для КСУР шорт. dlong_min - Ставка риска начальной маржи для КПУР лонг. dshort_min - Ставка риска начальной маржи для КПУР шорт. Коэффициенты маржинальной торговли появляются только на тех инструментах, которые были в перечне ликвидного имущества. Как узнать торгуется ли инструмент на выходных? Для отображения информации о возможности торговли инструментам по выходным добавлен флаг weekend_flag. Какие заявки по опционам возможно выставить? Торговля опционами через API в данный момент не доступна. Что такое liquidity_flag? Ликвидность — это способность быстро продать какой-то актив по рыночной цене, то есть без скидок. Чем быстрее это можно сделать, тем выше ликвидность актива. Ликвидность инструмента на фондовом рынке оценивают по количеству совершаемых сделок (то есть по объему торгов) и величине спреда. Спред — это разница между максимальными ценами заявок на покупку и минимальными ценами заявок на продажу. Чем больше сделок и меньше разница, тем выше ликвидность. Раз в полчаса брокер рассчитывает ликвидность по всем финансовым инструментом: Для облигаций: liquidity = ((Среднедневная цена * current_nominal)/100) * (Дневной объем торгов) В остальных случаях: liquidity = (Среднедневная цена) * (Дневной объем торгов) На основе значения liqudity для разных типов финансовых инструментов устанавливается значение флага liquidity_flag, который принимает для значения: true - инструмент считается ликвидным false - инструмент не считается ликвидным"
  },
  {
    "h1": "Глоссарий и дополнительная информация о методах сервиса инструментов",
    "h2": "Без подзаголовка",
    "fragment": "Наименование сущностей Актив (asset) - ценная бумага. Сущность верхнего уровня может иметь несколько вложенных позиций (positions), а позиции содержат в свою очередь инструменты (instruments). В TINKOFF INVEST API существуют следующие виды активов: ASSET_TYPE_UNSPECIFIED – тип не определён; ASSET_TYPE_CURRENCY – валюта; ASSET_TYPE_COMMODITY – товар; ASSET_TYPE_INDEX – индекс; ASSET_TYPE_SECURITY – ценная бумага. Для получения информации об активах вы можете использовать: - метод getAssets, с помощью которого можно получить список всех активов. Активы, имеющие связанные с ними инструменты, придут с массивом идентификаторов этих инструментов. Метод работает для всех инструментов, за исключением срочных - опционов и фьючерсов. Данный метод возвращает краткую информацию об активе: * Идентификатор * Тип актива * Название актива * Массив инструментов актива метод getAssetBy, с помощью которого можно найти актив по его идентификатору. Этот метод возвращает более подробную информацию о запрошенном активе. Расширенное описание актива включает в себя детализированную информацию в зависимости от типа актива, информацию о бренде, владеющим данным активом, и связанные с активом инструменты. Позиция (position) - это совокупность актива и торговой площадки. Сущность второго уровня вложенности, содержит информацию о позициях. Инструмент (instrument) - сущность третьего уровня, содержит информацию об инструментах. Инструменты изменяют позиции. Каждая из сущностей имеет свой уникальный идентификатор uid. Общие определения для параметров Exchange - торговая площадка (секция биржи). В данном параметре возвращается наименование секции биржи, которое может быть использовано для получения информации о расписании торгов на данной секции. Real_exchange - реальная торговая площадка (биржа). Данный параметр возвращает значение биржи, на которой торгуется инструмент. Или же значение REAL_EXCHANGE_OTC, указывающее на то, что инструмент является внебиржевым. Есть всего две реальные биржевые площадки - Мосбиржа и СПБ (REAL_EXCHANGE_MOEX, REAL_EXCHANGE_RTS). Опционы Опционы - это контракты, которые предусматривают право владельца опциона купить или продать базовый актив в указанный период и по определенной цене. Актив, в отношении которого заключается опцион, называется базовым активом. Например, им может выступать акция X. Опционы выступают финансовыми инструментами, связанными с конкретными активами. В TINKOFF INVEST API добавлены методы: GetOptionBy - Метод получения опциона по его идентификатору. GetOptions - Метод получения опционов. С помощью данных методов можно получить информацию об опционах, страйках (strike_price) и датах экспирации. Так же можно получить информацию о базовом активе опциона, найти его по идентификатору позиции базового инструмента (basicAssetPositionUid). Чтобы найти опционы через их базовый актив, вы должны: 1. В ответе метода getAssets найти необходимый вам актив. Вы можете использовать поле name для определения актива по его названию. 2. Передать значение поля uid необходимого актива во входной параметр basicAssetUid метода OptionsBy. Метод OptionsBy вернет вам все опционы базового актива с таким uid."
  },
  {
    "h1": "Сервис работы с торговыми поручениями",
    "h2": "Метод выставления заявок",
    "fragment": "Одной из главных функций торгового робота, безусловно, является выставление на бирже заявок. Для решения этой задачи можно использовать unary-метод postOrder. Unary-метод postOrder позволяет выставлять все типы заявок (рыночные, лимитные). PostOrder принимает на вход параметр instrument_id - Идентификатор инструмента, принимает значения Figi или instrument_uid. Подробнее можно ознакомится на странице с информаций об идентификаторах. Подробнее о торговых поручениях, их видах и особенностях исполнения на биржах можно почитать в статье: Работа с торговыми поручениями. Важно! Для исключения дублирования заявок в процессе работы используется параметр order_id, который требуется сгенерировать любым удобным способом перед вызовом метода. Если сервис получит несколько запросов с одинаковым order_id, то на биржу выставится только одно торговое поручение. Все последующие запросы, содержащие существующий order_id, будут возвращать статус этого торгового поручения. Важно! На данный момент мы имеем два параметра с одинаковым наименованием: order_id как входной параметр - ключ идемпотентности. Срок хранения ключа идемпотентности один год. order_id как выходной параметр - биржевой идентификатор заявки, используемый в дальнейшем для отслеживания статуса ордера. При выполнении операций с облигациями следует также учитывать накопленный купонный доход. Размер НКД можно узнать при помощи параметра aci_value методов получения информации по облигациям или метода выставления торгового поручения. Обратите внимание, что в параметре aci_value возвращается размер НКД в валюте расчётов за 1 лот. Т.е. при покупке облигаций к стоимости сделки будет добавлено произведение НКД на количество лотов в сделке (aci_value*quantity), при продаже на это произведение сумма сделки будет уменьшена. Выставлять заявку с ценой с отрицательным значением возможно только для фьючерсов, в ином случае метод вернет ошибку. Рекомендация! Поскольку на данный момент нет возможности выставить заявку стоимостью свыше 6 млн через Tinkoff Invest API (потребуется подтверждение заявки по sms), необходимо разбивать заявки стоимостью свыше 6 млн на заявки меньшего размера."
  },
  {
    "h1": "Сервис работы с торговыми поручениями",
    "h2": "Получение списка активных заявок по счёту",
    "fragment": "Для того чтобы торговому роботу более эффективно управлять торговыми поручениями, ему нужно иметь возможность получать список активных на данный момент заявок. Для решения этой задачи используется метод getOrders. Обратите внимание, что данный метод возвращает только активные торговые поручения, т.е. после исполнения заявка пропадает из возвращаемого списка."
  },
  {
    "h1": "Сервис работы с торговыми поручениями",
    "h2": "Получение статуса торгового поручения",
    "fragment": "Несмотря на то, что статус исполнения поданного торгового поручения можно получить повторным вызовом метода выставления (с тем же параметром order_id), рекомендуется использовать для этих целей метод getOrderState. Данный метод возвращает, в том числе, стадии выполнения заявки (массив stages). Важно! Метод получения статуса торгового поручения не предусмотрен для получения глубокой истории и может не возвращать информацию по поручениям \"старше\" одних суток."
  },
  {
    "h1": "Сервис работы с торговыми поручениями",
    "h2": "Идентификатор ключа идемпотентности",
    "fragment": "Допустим, вы оформляете ордер на покупку ценной бумаги. Запрос может потеряться в пути, и тогда хорошая идея попробовать отправить его снова. Проблема в том, что возможно на самом деле потерялся не запрос, а ответ. Тогда в результате будет создано два ордера. Поэтому для этой операции выдвигается требование идемпотентности. Это свойство означает, что сколько бы раз операция не была вызвана, эффект будет одинаковым. В нашем примере, должно быть не важно, один раз был отправлен запрос или 10 – должен быть создан ровно один или ноль (в случае ошибки) ордеров. Стандартный способ достичь этого свойства – генерация на стороне клиента ключа идемпотентности. Это просто некое уникальное значение. На стороне обработки запроса выполняется только та операция, ключ которой еще не встречался. Таким образом становится возможно делать retry безопасно. Важно! В целях сохранения единообразия в запросах метода postOrder параметр order_id - ключ идемпотентности, передаваемый от клиента. А в ответах метода postOrder order_id - биржевой идентификатор заявки. Ключом идемпотентности, передаваемым от клиента, в ответах методов является параметр order_request_id. В параметр order_id запроса метода getOrderState необходимо передавать order_id из ответа метода postOrder, т.е. биржевой идентификатор заявки. Повторное использование одного и того же order_id в запросах метода postOrder в случае, если уже существует успешно размещенный ордер с таким order_id, приведет к ошибке."
  },
  {
    "h1": "Сервис работы с торговыми поручениями",
    "h2": "Отмена торгового поручения",
    "fragment": "Далеко не все торговые поручения, выставляемые на торговую площадку, могут и должны быть исполнены. Ситуация на рынке меняется динамично, поэтому торговому роботу необходима возможность отменять выставленные заявки. Для реализации этой функциональности используется метод cancelOrder."
  },
  {
    "h1": "Сервис работы с торговыми поручениями",
    "h2": "Stream исполнения поручений пользователя",
    "fragment": "TINKOFF INVEST API предоставляет stream с трансляцией исполнения сделок. В данный стрим попадают все совершённые сделки по всем счетам пользователя. Для сохранения стабильного подключения при отсутствии данных в stream-соединении сервером периодически отправляется ping-пакет. Клиенту реагировать на него нет необходимости."
  },
  {
    "h1": "Сервис работы с торговыми поручениями",
    "h2": "Изменение выставленных заявок",
    "fragment": "Для изменения уже выставленных поручений в TINKOFF INVEST API добавлен метод replaceOrder. Данный метод позволяет изменить существующую выставленную заявку, путем ее отмены и выставления новой заявки с измененными параметрами. Для использования данного метода необходимо использовать идентификатор заявки на бирже, полученный при выставлении заявки с помощью Unary-метода postOrder. Во время использования метода, могут произойти различные события на разных этапах исполнения. Так если ошибка произойдет из-за невозможности отмены поручения, то вернется ошибка с кодом 30059, и описание причины в message. В случаях если после отмены поручения невозможно выставить новое поручение, то вернется ошибка метода postOrder с соответствующим кодом и описанием. Все коды и описания ошибок вы можете найти в соответствующем разделе. TradesStream - стрим совершенных сделок пользователя В TINKOFF INVEST API представлен gRPC server-side TradesStream получения сделок с биржи. Стрим предназначен для получения событий по поручениям пользователя, по факту их исполнения. Использование TradesStream поможет в быстром получении информации об исполнении поручения, и выполненных сделках в рамках поручения, с отображением номера счета, на котором выполнилось поручение. Для работы со стрим-соединениями также существуют ограничения, согласно лимитной политике Торговые статусы инструментов и расписание торгов Информацию о статусах инструментов и расписаниях торгов вы можете получить на странице Торговые статусы инструментов и расписание торгов. Так же рекомендуем смотреть актуальную информацию по режимам и статусам торгов на сайтах Московской биржи и СПБ биржи. Выставление заявок по опционам На данный момент в TINKOFF INVEST API для работы с опционами доступны только лимитные заявки. Рыночная заявка, Тейк-профиты и стоп-заявки появятся совсем скоро."
  },
  {
    "h1": "Методы",
    "h2": "OrdersStreamService",
    "fragment": "Методы сервиса TradesStream Stream сделок пользователя Тело запроса — TradesStreamRequest Тело ответа — TradesStreamResponse"
  },
  {
    "h1": "Методы",
    "h2": "OrdersService",
    "fragment": "Сервис предназначен для работы с торговыми поручениями: 1. выставление; 2. отмена; 3. получение статуса; 4. расчёт полной стоимости; 5. получение списка заявок. Методы сервиса PostOrder Метод выставления заявки. Тело запроса — PostOrderRequest Тело ответа — PostOrderResponse CancelOrder Метод отмены биржевой заявки. Тело запроса — CancelOrderRequest Тело ответа — CancelOrderResponse GetOrderState Метод получения статуса торгового поручения. Тело запроса — GetOrderStateRequest Тело ответа — OrderState GetOrders Метод получения списка активных заявок по счёту. Тело запроса — GetOrdersRequest Тело ответа — GetOrdersResponse ReplaceOrder Метод изменения выставленной заявки. Тело запроса — ReplaceOrderRequest Тело ответа — PostOrderResponse Сообщения методов TradesStreamRequest Запрос установки соединения. TradesStreamResponse Информация о торговых поручениях. OrderTrades Информация об исполнении торгового поручения. OrderTrade Информация о сделке. PostOrderRequest Запрос выставления торгового поручения. PostOrderResponse Информация о выставлении поручения. CancelOrderRequest Запрос отмены торгового поручения. CancelOrderResponse Результат отмены торгового поручения. GetOrderStateRequest Запрос получения статуса торгового поручения. GetOrdersRequest Запрос получения списка активных торговых поручений. GetOrdersResponse Список активных торговых поручений. OrderState Информация о торговом поручении. OrderStage Сделки в рамках торгового поручения. ReplaceOrderRequest Запрос изменения выставленной заявки. Enums OrderDirection Направление операции. OrderType Тип заявки. OrderExecutionReportStatus Текущий статус заявки (поручения) PriceType Тип цены. SecurityTradingStatus Нестандартные типы данных MoneyValue Денежная сумма в определенной валюте Quotation Котировка - денежная сумма без указания валюты Для чего используется параметр order_id метода PostOrder? На данный момент мы имеем два параметра с одинаковым наименованием: order_id как входной параметр - ключ идемпотентности в формате UID. Срок хранения ключа идемпотентности один год. order_id как выходной параметр - биржевой идентификатор заявки, используемый в дальнейшем для отслеживания статуса ордера. В первом случае order_id используется в качестве ключа идемпотентности в формате UID. Это значит, что многократный вызов метода PostOrder с одинаковым order_id не приведёт к выставлению более одного торгового поручения. При вызове метода происходит проверка уникальности связки order_id и account_id, если указанная пара не найдена, то создаётся новое торговое поручение, а если указанная связка уже существует (поручение с данным order_id по данному номеру счёта было выставлено раньше), то метод PostOrder вернёт статус уже выставленного торгового поручения, т.е. отработает согласно логике метода GetOrderState. Можно ли увидеть ключ идемпотентности (order_id) в операциях, выставленных поручениях и т.п.? В данный момент order_id используется исключительно как ключ идемпотентности и не \"прокидывается\" в другие сущности системы. Есть планы в будущем отображать переданный ключ в операциях. Как долго хранится ключ идемпотентности (order_id) на стороне брокера? Ключ хранится год, но пока никаких гарантий его сохранности дать не можем (механизм вероятно будет пересматриваться). Пока подразумевается полная уникальность переданного order_id в разрезе номера счёта (account_id). Что передавать в параметр quantity метода PostOrder? Количество бумаг или количество лотов? Метод PostOrder принимает в качестве параметра quantity требуемое количество лотов. Многие инструменты имеют лотность отличную от единицы, это следует обязательно учитывать при выставлении торговых поручений. Как рассчитать полную стоимость сделки? Полная стоимость сделки включает в себя не только сумму операции покупки или продажи биржевого инструмента, но и комиссии брокера, сервисные комиссии, гарантийное обеспечение для операций с фьючерсами и т.п. Рассчитать размеры комиссий можно из описания вашего тарифа, но нужно учитывать, что комиссии берутся за сделки, а не за поручение, т.е. одно торговое поручение может рождать несколько сделок. Процент комиссии фиксированный в зависимости от тарифа. Размер начальной комиссии и фактической можно узнать в деталях торгового поручения (методом GetOrderState). Подробнее про расчёт стоимости сделок с фьючерсами и облигациями: Цены облигаций и фьючерсов. Можно ли получить список уже исполненных торговых поручений? В данный момент метод GetOrders возвращает только список активных торговых поручений, т.е. поручений, которые ещё не исполнены и не отменены. Получить полный список уже исполненных торговых поручений в данный момент невозможно. Какие статусы торговых поручений бывают и что они значат? Описание статусной модели торговых поручений: Статусная модель торговых поручений. Некоторые нюансы исполнения поручений: Алгоритм и особенности исполнения торговых поручений. Почему лимитная заявка исполнилась по другой цене? Лимитное торговое поручение исполняется либо по указанной при её выставлении цене, либо по цене \"лучшей\" для определённого направления сделки. Этот механизм на бирже называется Best Execution и подразумевает исполнение торгового поручения по цене выгоднее, указанной в поручении. Как перевести цену поручения в тип Quotation? Подробнее о работе с нестандартными типами данных: Нестандартные типы данных TINKOFF INVEST API Как изменить выставленную заявку? Для изменения выставленного торгового поручения в TINKOFF INVEST API добавлен метод replaceOrder. Данный метод позволяет изменить существующую выставленную заявку, путем ее отмены и выставления новой заявки с измененными параметрами. Можно ли выставлять поручения по счету инвест копилки? Нет, при попытке выставления поручений по счету инвест копилки в методе PostOrder в ответ будет возвращена ошибка с \"code\":\"40004\" и \"message\": \"Working with orders is not available with this account\". Необходимо ли включение маржинальной торговли для торгов на срочном рынке? Да, для выставления поручений на срочном рынке, необходимо включить маржинальную торговлю в приложении и терминале. Иначе будет возвращена ошибка 30051 из Списка кодов ошибок Чем отличается рыночная заявка от лимитной? Помимо рыночных и лимитных заявок, Tinkoff Invest API позволяет выставлять заявки типа \"Лучшая цена\". Что такое заявка «Лучшая цена»? Чем отличается метод GetOrders и методом GetOrderState? Существуют ли ограничения на стоимость заявки? Да, на данный момент такие ограничения существуют. Поскольку на данный момент нет возможности выставить заявку стоимостью выше установленных значений для каждой из валют в Tinkoff Invest API (потребуется подтверждение заявки по sms), необходимо разбивать такие заявки на заявки меньшего размера. В случае, если вы превысите лимит, вы получите ошибку 90003. Все коды ошибок. Лимиты для на стоимость заявки для разных валют"
  },
  {
    "h1": "Таблица возвращаемых типов значений для различных методов и параметров",
    "h2": "Без подзаголовка",
    "fragment": "В таблице ниже отображены возвращаемые типы значений для различных типов инструментов в различных методах и их параметрах."
  },
  {
    "h1": "Формулы расчета реальной стоимости инструментов в валюте",
    "h2": "Без подзаголовка",
    "fragment": "price — текущая котировка ценной бумаги; nominal — номинал облигации; min_price_increment — шаг цены; min_price_increment_amount — стоимость шага цены; lot - лотность инструмента. Акции price * lot Облигации Пункты цены для котировок облигаций представляют собой проценты номинала облигации. Для пересчёта пунктов в валюту можно воспользоваться формулой: price / 100 * nominal Валюта price * lot / nominal Важно! При торговле валютой необходимо учитывать, что такие валюты как Иена, Армянский драм и Тенге имеют nominal = 100 Фьючерсы Стоимость фьючерсов также предоставляется в пунктах, для пересчёта можно воспользоваться формулой: price / min_price_increment * min_price_increment_amount"
  },
  {
    "h1": "Сервис получения информации о портфеле по конкретному счёту",
    "h2": "Получение списка операций по счёту",
    "fragment": "В процессе работы торговому роботу требуется получать информацию об операциях по счёту. Например, чтобы корректно рассчитывать доходности и собирать статистику своей работы. Для реализации данных потребностей можно использовать метод getOperations, а также более новый метод getOperationsByCursor. При работе с данными методами необходимо учитывать особенности взаимодействия. Метод getOperationsByCursor является более предпочтительным для использования, возвращает список всех операций по указанному счету. Данный метод возвращает информацию обо всех операциях, в том числе отмененных, поддерживает пагинацию и расширенную фильтрацию. Плюс данный метод обладает всеми преимуществами метода getOperations. Важно!!! Метод getOperations не поддерживает опционы. Для получения информации по операциям с опционами мы рекомендуем использовать метод getOperationsByCursor. Для вызова данных методов во входных параметрах достаточно указать только account_id. Метод getOperations, в том числе, возвращает отменённые операции (параметр state), это нужно обязательно учитывать в алгоритме работы. Важно!!! Метод getOperations возвращает только последнюю тысячу операций. Команда TINKOFF INVEST API не рекомендует использовать метод получения операций для идентификации изменения статусов торговых поручений, т.к. некоторые операции могут происходить с задержкой относительно реального исполнения. Для получения статусов исполнения торговых поручений рекомендуется использовать соответствующий stream сервиса работы с торговыми поручениями."
  },
  {
    "h1": "Сервис получения информации о портфеле по конкретному счёту",
    "h2": "На что нужно обратить внимание в методах получения списка операций",
    "fragment": "id операций могут меняться со временем. Не стоит ориентироваться на id операций, как на первичный ключ. Если у вас есть потребность перезагрузить историю операций, при повторном запросе операции, рекомендуем старые id операции удалить. По инструментам, прошедшим корпоративные действия, история операций может быть не полной как в api, так и в мобильном приложении. Для получения точной информации рекомендуем воспользоваться брокерским отчетом."
  },
  {
    "h1": "Сервис получения информации о портфеле по конкретному счёту",
    "h2": "Получение портфолио",
    "fragment": "Для получения торговым роботом текущего состояния портфеля по счёту используется метод getPortfolio. Данный метод в отличие от метода getPositions возвращает также статистическую информацию по портфелю (абсолютные и относительные доходности, текущую стоимость активов и т.п.). Обратите внимание, что для расчёта суммарной стоимости активов используются текущие цены биржевых инструментов. Если торги в данный момент не ведутся, то берётся цена закрытия последней торговой сессии. Важно!!! в данный момент запрос портфолио по счету инвесткопилки ( \"type\": \"ACCOUNT_TYPE_INVEST_BOX\") не доступен. В данный метод добавлен булев параметр blocked, принимающий значение true, если инструмент заблокирован депозитарием. Значения средних цен покупки инструментов (параметры average_position_price, average_position_price_pt и average_position_price_fifo) рассчитываются асинхронно. Возможна задержка в пересчёте до одной секунды. Параметр average_position_price - Средневзвешенная цена позиции. Параметр average_position_price_fifo - Средняя цена позиции по методу FIFO. Более подробно о методах расчета с примерами можно почитать на сайте Тинькофф."
  },
  {
    "h1": "Сервис получения информации о портфеле по конкретному счёту",
    "h2": "Получение списка позиций портфеля по счёту",
    "fragment": "Для принятия решений торговому роботу требуется получать список актуальных позиций в портфеле, т.е. количество ценных бумаг, валютных позиций по счёту, включая заблокированные средства. Для этого используется метод getPositions. Команда TINKOFF INVEST API рекомендует использовать именно этот метод, когда требуется получить актуальный список позиций, т.к. он является более быстрым и \"лёгким\" по сравнению с методом получения портфолио. В данном методе также возвращается тип инструмента для списка ценно-бумажных позиций портфеля в параметре instrument_type. В данный метод добавлен булев параметр exchange_blocked, принимающий значение true, если инструмент заблокирован депозитарием. В метод getPositions добавлен массив опционов в портфеле. Важно!!!. Данный метод не возвращает объём средств, заблокированных под гарантийное обеспечение фьючерсов. Для получения этой информации воспользуйтесь методом getWithdrawLimits."
  },
  {
    "h1": "Сервис получения информации о портфеле по конкретному счёту",
    "h2": "Получение доступного остатка для вывода денежных средств",
    "fragment": "Метод getWithdrawLimits позволяет в удобном виде получить доступный для вывода баланс денежных средств, а также количество заблокированных валютных позиций."
  },
  {
    "h1": "Сервис получения информации о портфеле по конкретному счёту",
    "h2": "Получение различных отчётов",
    "fragment": "TINKOFF INVEST API позволяет получать различные отчёты. Например, брокерский отчёт или справка о доходах за пределами РФ. Обратите внимание, что операции формирования отчётов достаточно трудоёмки, поэтому существуют ограничения на период формирования отчёта и лимиты на количество вызовов соответствующих методов. Запрос справки о доходах за пределами РФ работает корректно в случае, если верхний интервал запрашиваемых дат не позднее, чем 2 рабочих дня от текущей даты."
  },
  {
    "h1": "Сервис получения информации о портфеле по конкретному счёту",
    "h2": "Стрим позиций и доходности портфеля",
    "fragment": "Для получения информации об изменении портфеля по факту совершения сделок также можно подписаться на gRPC server-side stream PortfolioStream. Стрим позиций и доходностей портфеля возвращает статистическую информацию по портфелю (абсолютные и относительные доходности, текущую стоимость активов и т.п.). Средневзвешенная цена позиции, текущая рассчитанная доходность, текущая цена инструмента, средняя цена лота в позиции по методу FIFO - возвращаются в валюте инструмента. Средняя цена лота в позиции в пунктах (для фьючерсов) - возвращает количество в пунктах."
  },
  {
    "h1": "Сервис получения информации о портфеле по конкретному счёту",
    "h2": "Стрим изменения позиций портфеля",
    "fragment": "PositionsStream - gRPC server-side stream, предназначенный для получения информации по изменению позиций портфеля. Стрим в качестве входного необязательного параметра принимает массив идентификаторов счетов, по которым вы хотите получать изменения позиций. В качестве сообщений стрима приходят изменения позиций, объекты money, securities, futures, options, а также дата и время операции, изменившей позицию. Торговые статусы инструментов и расписание торгов Информацию о статусах инструментов и расписаниях торгов вы можете получить на странице Торговые статусы инструментов и расписание торгов. Также рекомендуем смотреть актуальную информацию по режимам и статусам торгов на сайтах Московской биржи и СПБ биржи."
  },
  {
    "h1": "Методы",
    "h2": "OperationsService",
    "fragment": "Сервис предназначен для получения: 1. списка операций по счёту; 2. портфеля по счёту; 3. позиций ценных бумаг на счёте; 4. доступного остатка для вывода средств; 5. получения различных отчётов. Методы сервиса GetOperations Метод получения списка операций по счёту.При работе с данным методом необходимо учитывать особенности взаимодействия с данным методом. Тело запроса — OperationsRequest Тело ответа — OperationsResponse GetPortfolio Метод получения портфеля по счёту. Тело запроса — PortfolioRequest Тело ответа — PortfolioResponse GetPositions Метод получения списка позиций по счёту. Тело запроса — PositionsRequest Тело ответа — PositionsResponse GetWithdrawLimits Метод получения доступного остатка для вывода средств. Тело запроса — WithdrawLimitsRequest Тело ответа — WithdrawLimitsResponse GetBrokerReport Метод получения брокерского отчёта. Тело запроса — BrokerReportRequest Тело ответа — BrokerReportResponse GetDividendsForeignIssuer Метод получения отчёта \"Справка о доходах за пределами РФ\". Тело запроса — GetDividendsForeignIssuerRequest Тело ответа — GetDividendsForeignIssuerResponse GetOperationsByCursor Метод получения списка операций по счёту с пагинацией. При работе с данным методом необходимо учитывать особенности взаимодействия с данным методом. Тело запроса — GetOperationsByCursorRequest Тело ответа — GetOperationsByCursorResponse"
  },
  {
    "h1": "Методы",
    "h2": "OperationsStreamService",
    "fragment": "Методы сервиса PortfolioStream Server-side stream обновлений портфеля Тело запроса — PortfolioStreamRequest Тело ответа — PortfolioStreamResponse PositionsStream Server-side stream обновлений информации по изменению позиций портфеля Тело запроса — PositionsStreamRequest Тело ответа — PositionsStreamResponse Сообщения методов OperationsRequest Запрос получения списка операций по счёту. OperationsResponse Список операций. Operation Данные по операции. OperationTrade Сделка по операции. PortfolioRequest Запрос получения текущего портфеля по счёту. PortfolioResponse Текущий портфель по счёту. PositionsRequest Запрос позиций портфеля по счёту. PositionsResponse Список позиций по счёту. WithdrawLimitsRequest Запрос доступного для вывода остатка. WithdrawLimitsResponse Доступный для вывода остаток. PortfolioPosition Позиции портфеля. VirtualPortfolioPosition PositionsSecurities Баланс позиции ценной бумаги. PositionsFutures Баланс фьючерса. PositionsOptions Баланс опциона. BrokerReportRequest BrokerReportResponse GenerateBrokerReportRequest GenerateBrokerReportResponse GetBrokerReportRequest GetBrokerReportResponse BrokerReport GetDividendsForeignIssuerRequest GetDividendsForeignIssuerResponse GenerateDividendsForeignIssuerReportRequest Объект запроса формирования отчёта \"Справка о доходах за пределами РФ\". GetDividendsForeignIssuerReportRequest Объект запроса сформированного отчёта \"Справка о доходах за пределами РФ\". GenerateDividendsForeignIssuerReportResponse Объект результата задачи запуска формирования отчёта \"Справка о доходах за пределами РФ\". GetDividendsForeignIssuerReportResponse DividendsForeignIssuerReport Отчёт \"Справка о доходах за пределами РФ\". PortfolioStreamRequest Запрос установки stream-соединения. PortfolioStreamResponse Информация по позициям и доходностям портфелей. PortfolioSubscriptionResult Объект результата подписки. AccountSubscriptionStatus Счет клиента. GetOperationsByCursorRequest Запрос списка операций по счёту с пагинацией. GetOperationsByCursorResponse Список операций по счёту с пагинацией. OperationItem Данные об операции. OperationItemTrades Массив с информацией о сделках. OperationItemTrade Сделка по операции. PositionsStreamRequest Запрос установки stream-соединения позиций. PositionsStreamResponse Информация по изменению позиций портфеля. PositionsSubscriptionResult Объект результата подписки. PositionsSubscriptionStatus Счет клиента. PositionData Данные о позиции портфеля. PositionsMoney Валютная позиция портфеля. Enums OperationState Статус запрашиваемых операций. OperationType Тип операции. PortfolioSubscriptionStatus Результат подписки. PositionsAccountSubscriptionStatus Результат подписки. PortfolioRequest.CurrencyRequest SecurityTradingStatus Нестандартные типы данных MoneyValue Денежная сумма в определенной валюте Quotation Котировка - денежная сумма без указания валюты Можно ли узнать идентификатор поручения из операции? Нет, в данный момент такой информации в операции нет, но мы работаем над этим. Почему в операции пустой Figi? Такое возможно для операций внесения денежных средств и подобных, т.к. нет связанного с операцией биржевого инструмента Будут ли отображаться операции по бумагам, которые прошли делистинг? Да, такие операции отображаться будут. В том числе будут отображаться операции по бумагам после различных корпоративных действий. Подробнее: Корпоративные действия. Параметр quantity в лотах или количествах? В рамках сервиса операций данный параметр всегда передаётся в лотах инструмента. Как с помощью TINKOFF INVEST API получить брокерский отчёт? Для получения брокерского отчёта можно воспользоваться методом GetBrokerReport. Обратите внимание, что получение брокерского отчёта асинхронно, т.е. сперва вы запрашиваете формирование отчёта (отправляя пакет generate_broker_report_request), получаете идентификатор задачи формирования отчёта (параметр task_id). После этого вы можете запросить отчёт по его идентификатору, в случае если формирование отчёта ещё не закончено, вы получите соответствующее сообщение об ошибке. Подробнее о брокерском отчёте: Отчёты и справки. Как получить информацию о позициях и доходности портфеля? Для получения информации о позиция и доходности портфеля необходимо подписаться на на метод PortfolioStream или выполнить запросы в метод получения портфеля и метод получения позиций по счету. В PortfolioStream не отображаются заблокированные биржей бумаги. Получить заблокированные бумаги можно в методе GetPortfolio и GetPossitions. Как получить информацию об операциях? Для получения информации об операциях в TINKOFF INVEST API предусмотрен метод getOperationsByCursor. Данный метод имеет широкие возможности фильтрации, а также возвращает постраничную информацию об операциях. Для вызова метода во входных параметрах достаточно указать только account_id. Также в TINKOFF INVEST API для получения списка операций существует метод getOperations, являющийся более старой версией метода getOperationsByCursor. Однако, метод getOperationsByCursor является более предпочтительным для использования. Для вызова метода getOperations во входных параметрах достаточно указать только account_id. Важно!!! Метод getOperations возвращает только последнюю тысячу операций. Как понять какие бумаги в портфеле заблокированы по решению ЦБ? В методах getPortfolio и getPositions добавлены специальные булевы параметры, означающие, что данный инструмент заблокирован депозитарием. В чем различие между параметрами positions.blocked и positions.blocked_lots в методе getPortfolio? При выставлении лимитных заявок блокируется выставленное количество бумаг на счет, это количество и является значением параметра positions.blocked_lots. Параметр positions.blocked, булевый параметр, значение которого отображает заблокирован ли инструмент депозитарием. Что за значения приходят в positions.expectedYield в методе getPortfolio? В методе getPortfolio в параметрах positions.expectedYield и positions.expectedYieldFifo возвращается значение текущей рассчитанной доходность позиции - это значение в валюте инструмента."
  },
  {
    "h1": "Особенности методов сервиса операций, которые необходимо учитывать при работе",
    "h2": "На что нужно обратить внимание в методах получения списка операций",
    "fragment": "id операций могут меняться со временем. Не стоит ориентироваться на id операций, как на первичный ключ. Если у вас есть потребность перезагрузить историю операций, при повторном запросе операции, рекомендуем старые id операции удалить. По инструментам, прошедшим корпоративные действия, история операций может быть не полной как в api, так и в мобильном приложении. Для получения точной информации рекомендуем воспользоваться брокерским отчетом. В id комиссий приходит parent_operation_id . В методе getOperations, информация, возвращаемая по операциям с опционами, отображается не корректно. Для получения списка операций с опционами необходимо использовать метод getOperationsByCursor. Получение списка операций методом getOperationsByCursor рекомендуется использовать limit>2, чтобы избежать проблем с задублированными операциями и не возможностью перемещаться по cursor. Все типы операций, подразумевающие начисление и выплаты по погашению облигаций, вариационной марже, дивидендам, налогам, не отображают данные о количестве инструментов, по которым произошли начисления."
  },
  {
    "h1": "Сервис котировок",
    "h2": "Без подзаголовка",
    "fragment": "Все методы сервиса котировок принимают на вход instrumentId - параметр, в который можно передать значение instrument_uid или FIGI. Получить более подробную информацию можно на странице об идентификаторах инструментов. Данный сервис предназначен для получения различной (в т.ч. исторической) биржевой информации. Существует два варианта взаимодействия с сервисом котировок: Unary-методы — данный вариант следует использовать в случаях, когда не требуется оперативность получения информации или для загрузки исторических данных. Существует ограничение на количество запросов в минуту, подробнее: Лимитная политика. Bidirectional-stream — используется для получения биржевой информации в реальном времени с минимально возможными задержками. Для работы со стрим-соединениями также существуют ограничения, согласно лимитной политике. Server-side-stream — используется для получения биржевой информации в реальном времени с минимально возможными задержками. В отличие от MarketDataStream в данном стриме передаётся объект, содержащий все типы подписок. ServerSideStream необходим для корректной трансляции маркетдаты в браузерные клиенты по gRPC-web, который не поддерживает bidirection стримы. Для работы со стрим-соединениями также существуют ограничения, согласно лимитной политике. Важно! В сервисе TINKOFF INVEST API для отображения цен облигаций и фьючерсов используются пункты. Для облигаций один пункт равен одному проценту номинала облигации. Для расчёта реальной стоимости фьючерса можно воспользоваться формулой: price / min_price_increment * min_price_increment_amount"
  },
  {
    "h1": "Сервис котировок",
    "h2": "Формулы расчета реальной стоимости инструментов в валюте",
    "fragment": "price — текущая котировка ценной бумаги; nominal — номинал облигации; min_price_increment — шаг цены; min_price_increment_amount — стоимость шага цены; lot - лотность инструмента. Акции price * lot Облигации Пункты цены для котировок облигаций представляют собой проценты номинала облигации. Для пересчёта пунктов в валюту можно воспользоваться формулой: price / 100 * nominal price / 100 * nominal + current_nkd Используется для подсчета с учетом НКД НКД - накопленный купонный доход. Может возвращаться в параметрах current_nkd или aci_value. Валюта price * lot / nominal Важно! При торговле валютой необходимо учитывать, что такие валюты как Иена, Армянский драм и Тенге имеют nominal = 100 Фьючерсы Стоимость фьючерсов также предоставляется в пунктах, для пересчёта можно воспользоваться формулой: price / min_price_increment * min_price_increment_amount"
  },
  {
    "h1": "Сервис котировок",
    "h2": "Получение исторических свечей",
    "fragment": "В процессе разработки торгового робота требуется анализировать различную историческую информацию. Например, свечи. Для получения исторических свечей по инструменту можно использовать метод getCandles. Обратите внимание, что максимально допустимый период получения свечей за один запрос — 1 календарный год. Получение данных за более длинный период возможно поочередным вызовом метода."
  },
  {
    "h1": "Сервис котировок",
    "h2": "Получение цен последних сделок",
    "fragment": "В процессе работы алгоритма торговли может потребоваться получение цены последней сделки по инструменту или инструментам. Для реализации данной потребности следует использовать метод getLastPrices. Используя данный метод, вы можете получить цены последних сделок всех доступных для торговли инструментов — для этого требуется передать пустой массив instruments. Если для реализации алгоритма требуется оперативно получать информацию о цене последней сделки, то команда TINKOFF INVEST API рекомендует использовать подписку на поток обезличенных сделок в рамках stream-соединения сервиса."
  },
  {
    "h1": "Сервис котировок",
    "h2": "Получение текущего стакана",
    "fragment": "Биржевой стакан — один из ключевых показателей торгового инструмента. Стакан содержит заявки пользователей на покупку или продажу определённого инструмента (подробнее: Биржевой стакан). Для получения стакана можно использовать метод getOrderbook. Данный метод также позволяет получать время формирования стакана на бирже, а также время получения цены закрытия и цены последней сделки. Для высоколиквидных инструментов на бирже стакан может изменяться несколько раз за секунду, поэтому использование unary-метода не всегда будет удобным. Поэтому рекомендуется использовать подписку на стаканы в рамках stream-соединения сервиса."
  },
  {
    "h1": "Сервис котировок",
    "h2": "Bidirectional-stream получения биржевой информации",
    "fragment": "В рамках stream-соединения можно получать поток интересующих данных. В рамках одного соединения пользователь может подписаться на получение: стаканов (с глубиной 1, 10, 20, 30, 40 или 50); свечей; потока обезличенных сделок; статуса торговли инструментов; цен последних сделок; информации о своих подписках. Важно. В рамках одного запроса можно управлять подпиской только одного типа данных. Т.е. чтобы подписаться на свечи и стаканы требуется отправить два запроса marketdataRequest, содержащие информацию об изменении статуса подписки на свечи и стаканы соответственно. Для сохранения стабильного подключения при отсутствии данных в stream-соединении сервером периодически отправляется ping-пакет. Клиенту реагировать на него нет необходимости. Обратите внимание, что максимальное количество подписок на одно соединение ограничено лимитной политикой TINKOFF INVEST API. Однако, это ограничение не распространяется на подписку info (получение торгового статуса инструмента). Особенности трансляции свечей Свечи в рамках bidirectional-stream собираются \"на лету\" из ленты обезличенных сделок. Свечи отправляются не чаще одного раза в 300мс + свеча закрытия периода сбора. Однако, бывают ситуации, что сделки с биржи фактически доходят уже после окончания периода сбора свечи, в таком случае в стрим отправляется ещё одна (или более) \"корректирующая\" свеча. В случае если необходимо получать свечи после закрытия интервала, то необходимо использовать параметр waiting_close. Получения исторических рыночных данных по инструментам в виде годового архива Используя метод GetHistory можно получить zip-архив исторических минутных свечей за год. Обратите внимание, что максимально допустимый период получения свечей за один запрос — 1 календарный год. Получение данных за более длинный период возможно поочередным вызовом метода. Также в методе GetHistory для удобства представлен скрипт получения zip-архивов по списку инструментов за все доступные года. Скрипт выполняет поочередный вызов метода по всем доступным годам. Обратите внимание на то, что данные в архиве обновляются раз в сутки, как правило ночью, соответственно текущего дня в архиве не будет. Лимиты на количество запросов на подписку Для всех типов подписок в Bidirectional-stream установлены ограничения максимального количества запросов на подписку. Если количество запросов за минуту превысит 100, то для всех элементов будет установлен статус SUBSCRIPTION_STATUS_TOO_MANY_REQUESTS. Получение информации о своих подписках Для получения информации о своих подписках в методе marketDataStream предусмотрен специальный запрос на получение информации о своих подписках - get_my_subscriptions. Получение своих подписок Для получения списка своих подписок можно запросить в методе marketDataStream GetMySubscriptions. Получение цены закрытия В процессе работы алгоритма торговли может потребоваться получение цены закрытия по инструменту или инструментам. Для реализации данной потребности следует использовать метод GetClosePrices. Используя данный метод, вы можете получить цены закрытия всех доступных для торговли инструментов — для этого требуется передать пустой массив instruments. Данный метод для всех бумаг возвращает цену закрытия за предыдущий торговый день. Принимает на вход instrumentId - параметр, в который можно передать значение instrument_uid или FIGI. Торговые статусы инструментов и расписание торгов Информацию о статусах инструментов и расписаниях торгов вы можете получить на странице Торговые статусы инструментов и расписание торгов. Также рекомендуем смотреть актуальную информацию по режимам и статусам торгов на сайтах Московской биржи и СПБ биржи."
  },
  {
    "h1": "Методы",
    "h2": "MarketDataService",
    "fragment": "Сервис получения биржевой информации: 1. свечи; 2. стаканы; 3. торговые статусы; 4. лента сделок. Методы сервиса GetCandles Метод запроса исторических свечей по инструменту. Тело запроса — GetCandlesRequest Тело ответа — GetCandlesResponse GetLastPrices Метод запроса цен последних сделок по инструментам. Тело запроса — GetLastPricesRequest Тело ответа — GetLastPricesResponse GetOrderBook Метод получения стакана по инструменту. Тело запроса — GetOrderBookRequest Тело ответа — GetOrderBookResponse GetTradingStatus Метод запроса статуса торгов по инструментам. Тело запроса — GetTradingStatusRequest Тело ответа — GetTradingStatusResponse GetTradingStatuses Метод запроса статуса торгов по инструментам. Тело запроса — GetTradingStatusesRequest Тело ответа — GetTradingStatusesResponse GetLastTrades Метод запроса обезличенных сделок за последний час. Тело запроса — GetLastTradesRequest Тело ответа — GetLastTradesResponse GetClosePrices Метод запроса цен закрытия торговой сессии по инструментам. Тело запроса — GetClosePricesRequest Тело ответа — GetClosePricesResponse"
  },
  {
    "h1": "Методы",
    "h2": "MarketDataStreamService",
    "fragment": "Методы сервиса MarketDataStream Bi-directional стрим предоставления биржевой информации. Тело запроса — MarketDataRequest Тело ответа — MarketDataResponse MarketDataServerSideStream Server-side стрим предоставления биржевой информации. Тело запроса — MarketDataServerSideStreamRequest Тело ответа — MarketDataResponse Сообщения методов MarketDataRequest Запрос подписки или отписки на определённые биржевые данные. MarketDataServerSideStreamRequest MarketDataResponse Пакет биржевой информации по подписке. SubscribeCandlesRequest subscribeCandles | Изменения статуса подписки на свечи. CandleInstrument Запрос изменения статус подписки на свечи. SubscribeCandlesResponse Результат изменения статус подписки на свечи. CandleSubscription Статус подписки на свечи. SubscribeOrderBookRequest Запрос на изменение статуса подписки на стаканы. OrderBookInstrument Запрос подписки на стаканы. SubscribeOrderBookResponse Результат изменения статуса подписки на стаканы. OrderBookSubscription Статус подписки. SubscribeTradesRequest Изменение статуса подписки на поток обезличенных сделок. TradeInstrument Запрос подписки на поток обезличенных сделок. SubscribeTradesResponse Результат изменения статуса подписки на поток обезличенных сделок. TradeSubscription Статус подписки. SubscribeInfoRequest Изменение статуса подписки на торговый статус инструмента. InfoInstrument Запрос подписки на торговый статус. SubscribeInfoResponse Результат изменения статуса подписки на торговый статус. InfoSubscription Статус подписки. SubscribeLastPriceRequest Изменение статуса подписки на цену последней сделки по инструменту. LastPriceInstrument Запрос подписки на последнюю цену. SubscribeLastPriceResponse Результат изменения статуса подписки на цену последней сделки. LastPriceSubscription Статус подписки на цену последней сделки. Candle Пакет свечей в рамках стрима. OrderBook Пакет стаканов в рамках стрима. Order Массив предложений/спроса. Trade Информация о сделке. TradingStatus Пакет изменения торгового статуса. GetCandlesRequest Запрос исторических свечей. GetCandlesResponse Список свечей. HistoricCandle Информация о свече. GetLastPricesRequest Запрос получения цен последних сделок. GetLastPricesResponse Список цен последних сделок. LastPrice Информация о цене последней сделки. GetOrderBookRequest Запрос стакана. GetOrderBookResponse Информация о стакане. GetTradingStatusRequest Запрос получения торгового статуса. GetTradingStatusesRequest Запрос получения торгового статуса. GetTradingStatusesResponse Информация о торговом статусе. GetTradingStatusResponse Информация о торговом статусе. GetLastTradesRequest Запрос обезличенных сделок за последний час. GetLastTradesResponse Обезличенных сделок за последний час. GetMySubscriptions Запрос активных подписок. GetClosePricesRequest Запрос цен закрытия торговой сессии по инструментам. InstrumentClosePriceRequest Запрос цен закрытия торговой сессии по инструменту. GetClosePricesResponse Цены закрытия торговой сессии по инструментам. InstrumentClosePriceResponse Цена закрытия торговой сессии по инструменту. Enums SubscriptionAction Тип операции со списком подписок. SubscriptionInterval Интервал свечи. SubscriptionStatus Результат подписки. TradeDirection Направление сделки. CandleInterval Интервал свечей. SecurityTradingStatus Нестандартные типы данных MoneyValue Денежная сумма в определенной валюте Quotation Котировка - денежная сумма без указания валюты Что такое шаг цены? Шаг цены — это минимальное изменение цены определенного инструмента. Пример Шаг цены для инструмента = 0.1, а последняя цена = 10.5 — это означает, что заявка может быть выставлена по одной из следующих цен: 10.4 10.5 10.6 Цена 10.55 будет некорректной и заявка не будет выставлена. def isValidPrice(price: BigDecimal, increment: BigDecimal): Boolean = { price % increment == 0 } isValidPrice(10.1, 0.1) // true isValidPrice(10.16, 0.1) // false Отличие лотов и количества инструментов При работе с сервисом TINKOFF INVEST API следует обращать особое внимание на различия понятий лот и количество ценных бумаг. Все цены в сервисе котировок предоставляются за одну ценную бумагу. Данное правило касается методов GetLastPrice, GetCandles, а так же подписки на эти данные в рамках stream-соединений данного сервиса. При получении данных по стакану или сделкам объём этих сделок отображается в лотах. Т.е. параметр quantity метода GetOrderBook и пакета trade в рамках stream-соединений сервиса отображается в лотах Цены облигаций и фьючерсов Цены облигаций и фьючерсов в TINKOFF INVEST API предоставляются в пунктах. Методика расчёта стоимости лота в валюте отличается в зависимости от типа биржевого инструмента."
  },
  {
    "h1": "Методы",
    "h2": "Формулы расчета реальной стоимости инструментов в валюте",
    "fragment": "price — текущая котировка ценной бумаги; nominal — номинал облигации; min_price_increment — шаг цены; min_price_increment_amount — стоимость шага цены; lot - лотность инструмента. Акции price * lot Облигации Пункты цены для котировок облигаций представляют собой проценты номинала облигации. Для пересчёта пунктов в валюту можно воспользоваться формулой: price / 100 * nominal Валюта price * lot / nominal Важно! При торговле валютой необходимо учитывать, что такие валюты как Иена, Армянский драм и Тенге имеют nominal = 100 Фьючерсы Стоимость фьючерсов так же предоставляется в пунктах, для пересчёта можно воспользоваться формулой: price / min_price_increment * min_price_increment_amount Так же при работе с фьючерсами важно учитывать размер гарантийного обеспечения. Узнать эти параметры фьючерсов можно при помощи метода: getFuturesMargin. Подробнее про срочный рынок читайте тут Какие интервалы доступны при запросе исторических свечей? Метод GetCandles позволяет получать исторические свечи разных таймфреймов. Существует ограничение на максимальный и минимальный период запроса для каждого интервала свечей: Важно! При запросе дневных свечей CANDLE_INTERVAL_DAY время, переданное в поля from и to игнорируется, Т.е. при запросе дневной свечи по интервалу с 12:00 01.01.2021 по 07:00 02.01.2021 вернётся две дневных свечи за 01.01.2021 и за 02.01.2021 Важно! При попытке получить данные с временным интервалом меньше временного интервала данного таймфрейма, ответом метода будет возвращен пустой массив. Например, если интервал при запросе дневных свечей (CANDLE_INTERVAL_DAY) инструмента будет 1 час. Как одним запросом получить последние цены по нескольким инструментам? Для получения цен последних сделок по массиву инструментов можно методом GetLastPrices. Во входные параметры метода можно передать массив идентификаторов инструментов. Как подписаться на разные типы данных в рамках stream-соединения сервиса котировок? Bi-directional stream Сервиса котировок поддерживает одновременную подписку на разные типы данных (свечи, стаканы, сделки и т.п.) в рамках одного соединения. Для этого следует последовательно отправить пакеты подписки на разные данные. Т.е. отдельно реализуется подписка на свечи, отдельно на стаканы и т.п. Подробнее можно узнать в примерах выбранного вами SDK. Внебиржевые инструменты в TINKOFF INVEST API В данный момент TINKOFF INVEST API предполагает работу только с биржевыми инструментами. Какие данные отливаются в стриминг стаканов? Пока только биржевые. Внебиржевые стаканы, например, TRRE, не транслируются в режиме стриминга. Торговля бумагами Тинькофф через TINKOFF INVEST API Из-за огромного количества скальперских сделок мы закрыли торговлю БПИФ от УК \"Тинькофф Капитал\" в TINKOFF INVEST API. Список бумаг смотрите здесь. Валюты в TINKOFF INVEST API Получить список доступных валют можно при помощи метода getInstruments/currencies. Обратите внимание, что лотность валют ограничена лотностью, которая предоставляет биржа. Например, операции с Евро и Долларами возможны только на количества кратные 1000. Почему отличаются исторические цены в TINKOFF INVEST API и других источниках? Исторические данные Тинькофф Инвестиций могут отличаться от данных, которые предоставляют другие сервисы. Связано это может быть как с различными источниками первичных данных, так и с различными алгоритмами их обработки и агрегации. Как получить исторические рыночные данные? Исторические рыночные данные можно загрузить в виде архива используя метод Загрузка исторических рыночных данных в виде архива. Какое максимальное количество запросов на подписку в MarketDataStream? Для всех типов подписок в методе установлены ограничения максимального количества запросов на подписку. Если количество запросов за минуту превысит 100, то для всех элементов будет установлен статус SUBSCRIPTION_STATUS_TOO_MANY_REQUESTS. Максимальное количество запросов в минуту = 100. Как узнать дату, с которой можно получить свечи по инструменту? Для того что бы понять с какой даты запрашивать свечи по инструменту в Сервис инструментов TINKOFF INVEST API добавлены параметры first_1min_candle_date и first_1day_candle_date. Данные параметры возвращаются в методах получения информации об инструментах. Параметр first_1min_candle_date возвращает дату первой минутной свечи, а first_1day_candle_date дату первой дневной свечи. Как узнать доступности торгов инструментом через API? Узнать доступность торгов инструментом можно по параметру api_trade_available_flag в методе getTradingStatus или FindInstrument. Какой идентификатор инструмента использовать для получения данных в сервисе котировок? Все методы сервиса котировок принимают на вход instrumentId - параметр, в который можно передать значение instrument_uid или FIGI. Получить более подробную информацию можно на странице об идентификаторах инструментов."
  },
  {
    "h1": "Получение исторических рыночных данных",
    "h2": "Загрузка исторических рыночных данных в виде архива",
    "fragment": "TINKOFF INVEST API предоставляет своим пользователям возможность получения исторических рыночных данных по инструментам за год в виде архива. Для загрузки истории котировок можно воспользоваться специальным методом или подготовленными скриптом и справочником figi. Метод загрузки исторических рыночных данных по инструменту в виде годового архива Для загрузки исторических рыночных данных в виде архива по определенному инструменту необходимо передать GET запрос на url: https://invest-public-api.tinkoff.ru/history-data с указанными ниже параметрами, а также Bearer token'ом. GetHistoryRequest GetHistoryResponse Пример запроса curl -X GET --location \"https://invest-public-api.tinkoff.ru/history-data?figi=BBG00QKJSX05&year=2022\" \\ -H \"Authorization: Bearer token\" Скрипт получения исторических рыночных данных по инструментам в виде годового архива Для загрузки истории котировок за весь доступный период можно воспользоваться специальным подготовленным скриптом, а так же справочником figi. Вы можете создать свой справочник необходимых Вам figi по аналогии с представленным, назвать его figi.txt и сохранить в той же директории, где сохраните скрипт. Перед запуском скрипта download_md.sh необходимо добавить токен доступа в специальный параметр. Параметры настройки скрипта download_md.sh Результат работы скрипта В результате успешного выполнения скрипта в директории, откуда запущен скрипт, будут сохранены zip-архивы, разбитые по инструментам и годам исторических рыночных данных. Порядок следования полей в выходном файле: Идентификатор инструмента (FIGI) Дата и время начала свечи (UTC) Цена открытия (open) Цена закрытия (close) Максимальная цена за интервал (high) Минимальная цена за интервал (low) Объем в лотах (volume) Важно!!! Просим обратить внимание на то, что данные в архиве обновляются раз в сутки, как правило ночью, соответственно текущего дня в архиве не будет."
  },
  {
    "h1": "Сервис работы со стоп-ордерами",
    "h2": "Без подзаголовка",
    "fragment": "В процессе работы торговый робот может использовать возможности стоп-заявки. стоп-заявка или (стоп-ордер, стоп-приказ) — это особый вид торгового поручения, который трансформируется в биржевое торговое поручение с заданными параметрами при достижении какого-то условия. Подробнее про типы стоп-заявок можно почитать по ссылке. Несмотря на то, что TINKOFF INVEST API предоставляет интерфейс работы со стоп-заявками, наша команда рекомендует реализовывать данную функциональность на стороне торгового робота. Сделать это можно при помощи отслеживания цены и выставления биржевых торговых поручений."
  },
  {
    "h1": "Сервис работы со стоп-ордерами",
    "h2": "Метод выставления стоп-заявки",
    "fragment": "Для выставления стоп-заявки используется метод PostStopOrder. Обратите внимание на параметр expiration_type, он отвечает за время жизни (экспирации) заявки. Например, значение GoodTillCancel говорит, что такая заявка будет активна до отмены, а GoodTillDate — что заявка будет активна до определённой даты (параметр expire_date)."
  },
  {
    "h1": "Сервис работы со стоп-ордерами",
    "h2": "Метод получения списка активных стоп-заявок",
    "fragment": "Для получения полного списка стоп-заявок рекомендуется использовать метод GetStopOrders. Обратите внимание, что метод вернёт только стоп-заявку, которые ещё не были конвертированы в реальные торговые поручения."
  },
  {
    "h1": "Сервис работы со стоп-ордерами",
    "h2": "Метод отмены стоп-заявки",
    "fragment": "Для отмены активной стоп-заявки используется метод CancelStopOrder."
  },
  {
    "h1": "Методы",
    "h2": "StopOrdersService",
    "fragment": "Сервис предназначен для работы со стоп-заявками: 1. выставление; 2. отмена; 3. получение списка стоп-заявок. Методы сервиса PostStopOrder Метод выставления стоп-заявки. Тело запроса — PostStopOrderRequest Тело ответа — PostStopOrderResponse GetStopOrders Метод получения списка активных стоп заявок по счёту. Тело запроса — GetStopOrdersRequest Тело ответа — GetStopOrdersResponse CancelStopOrder Метод отмены стоп-заявки. Тело запроса — CancelStopOrderRequest Тело ответа — CancelStopOrderResponse Сообщения методов PostStopOrderRequest Запрос выставления стоп-заявки. PostStopOrderResponse Результат выставления стоп-заявки. GetStopOrdersRequest Запрос получения списка активных стоп-заявок. GetStopOrdersResponse Список активных стоп-заявок. CancelStopOrderRequest Запрос отмены выставленной стоп-заявки. CancelStopOrderResponse Результат отмены выставленной стоп-заявки. StopOrder Информация о стоп-заявке. Enums StopOrderDirection Направление сделки стоп-заявки. StopOrderExpirationType Тип экспирации стоп-заявке. StopOrderType Тип стоп-заявки. SecurityTradingStatus Нестандартные типы данных MoneyValue Денежная сумма в определенной валюте Quotation Котировка - денежная сумма без указания валюты Можно ли узнать, что торговое поручение было создано из стоп-заявки? В данный момент соотнести стоп-заявку с торговым поручением можно лишь по косвенным признакам (тип, количество инструментов, цена и т.п.). В будущих обновления такая функциональность появится. Можно ли получить информацию об исполненных или снятых стоп-заявках? На текущий момент такая функциональность не предоставляется, но планируется в будущих релизах."
  },
  {
    "h1": "Песочница TINKOFF INVEST API",
    "h2": "Адреса сервиса TINKOFF INVEST API Sandbox",
    "fragment": "Для работы с песочницей существуют два способа: Все вызовы сервиса песочницы выполняются по адресу sandbox-invest-public-api.tinkoff.ru:443. Пользоваться методами Sandbox-сервиса. Команда TINKOFF INVEST API рекомендует пользоваться первым способом. Различия работы контуров описаны на странице."
  },
  {
    "h1": "Песочница TINKOFF INVEST API",
    "h2": "Методы по работе со счетами песочницы.",
    "fragment": "Для тестирования своего торгового робота в песочнице можно использовать неограниченное количество счетов, которые существуют только в песочнице и не имеют отношения к реальным торгам на бирже. OpenSandboxAccount — метод создания специального счёта песочницы; SandboxPayIn — пополнение баланса счёта песочницы; CloseSandboxAccount — метод закрытия счёта в песочнице. Обратите внимание, что пополнение счёта песочницы возможно только в рублях. Для выполнения операций с другой валютой расчётов, следует эту валюту сперва купить c помощью метода PostOrder. Для получения списка своих счетов в песочнице используется метод getAccount. Важно! Все счета в песочнице являются виртуальными и могут быть удалены в любой момент времени. Если созданный ранее счёт не найден, создайте, пожалуйста, новый. Счета хранятся 3 месяца с даты последнего использования. Важно! В песочнице отсутствуют стоп-заявки, маржинальные показатели, а также не производится расчёт дополнительных показателей счёта, ставок риска и размер гарантийного обеспечения, ликвидности портфеля."
  },
  {
    "h1": "Песочница TINKOFF INVEST API",
    "h2": "Методы получения состояния портфеля в песочнице",
    "fragment": "Методы получения операций и портфеля аналогичны таким же методам основных сервисов: getSandboxOperations — получение операций по счёту; getSandboxPortfolio — получение портфолио по счёту; getSandboxPositions — получение списка позиций по счёту. Обратите, что для методов песочницы не рассчитываются некоторые статистические параметры портфеля, такие как относительная и абсолютные доходности и т.п."
  },
  {
    "h1": "Песочница TINKOFF INVEST API",
    "h2": "Методы по работе с торговыми поручениями в песочнице",
    "fragment": "Параметры методов выставления, отмены, получения статуса торгового поручения в песочнице аналогичны методам основной работы с TINKOFF INVEST API. postSandboxOrder — выставление торгового поручения; getSandboxOrderState — получение статуса торгового поручения; cancelSandboxOrder — отмена выставленного торгового поручения; getSandboxOrders — получение списка торговых поручений по счёту;"
  },
  {
    "h1": "Песочница TINKOFF INVEST API",
    "h2": "Методы сервиса операций в песочнице",
    "fragment": "GetDividendsForeignIssuer - получение отчёта \"Справка о доходах за пределами РФ\"; Обращаем ваше внимание, что в данном методе песочницы будет возвращать: \"div_foreign_issuer_report\": { \"dividends_foreign_issuer_report\": [], \"itemsCount\": 0, \"pagesCount\": 0, \"page\": 0 }, \"payload\": \"div_foreign_issuer_report\" GetBrokerReport - получение брокерского отчёта; Обращаем ваше внимание, что в данном методе песочницы будет возвращать: \"get_broker_report_response\": { \"broker_report\": [], \"itemsCount\": 0, \"pagesCount\": 0, \"page\": 0 }, \"payload\": \"get_broker_report_response\" PortfolioStream - server-side stream обновлений портфеля; PositionsStream - server-side stream обновлений информации по изменению позиций портфеля; GetPortfolio - получение портфеля по счёту."
  },
  {
    "h1": "Песочница TINKOFF INVEST API",
    "h2": "Методы сервиса ордеров в песочнице",
    "fragment": "TradesStream - получение портфеля по счёту."
  },
  {
    "h1": "Песочница TINKOFF INVEST API",
    "h2": "Методы сервиса cчетов в песочнице",
    "fragment": "GetMarginAttributes - получение портфеля по счёту. Обращаем ваше внимание, что в данном методе песочницы будут возвращены: значение параметра liquid_portfolio (ликвидной стоимости портфеля) = стоимости портфеля. starting_margin = corrected_margin = minimal_margin = amount_of_missing_funds = 0 funds_sufficiency_level = 2 Алгоритм исполнения торговых поручений в песочнице Алгоритм исполнения торговых поручений в песочнице отличается от \"боевого\" алгоритма. Также следует обязательно учитывать, что в песочнице полностью отсутствует влияние совершаемых сделок на рынок. Рыночные заявки в песочнице исполняются по last_price полученному с биржи. При выставлении торгового поручения со счёта песочницы сразу же списываются активы или начисляются валютные средства. Операции при этом появятся только при исполнении торгового поручения. Сервис получает от торговых площадок информацию о последних сделках по всем инструментам. Если для инструмента есть активные торговые поручения в песочнице, то сервис определяет сделки, цена для которых пройдена. Например, существует заявка на покупку акции по цене 100 руб.; если цена инструмента в последней сделке с биржи равна 100 или менее рублей, то заявка исполняется по цене, которая была в ней указана (т.е. по 100 руб). Если же заявка на продажу, то она исполнится, когда цена последней сделки будет 100 или более рублей. Все неисполненные торговые поручения в песочнице удаляются после окончания торговой сессии. Списанные активы возвращаются на счёт."
  },
  {
    "h1": "Методы",
    "h2": "SandboxService",
    "fragment": "Сервис для работы с песочницей TINKOFF INVEST API Методы сервиса OpenSandboxAccount Метод регистрации счёта в песочнице. Тело запроса — OpenSandboxAccountRequest Тело ответа — OpenSandboxAccountResponse GetSandboxAccounts Метод получения счетов в песочнице. Тело запроса — GetAccountsRequest Тело ответа — GetAccountsResponse CloseSandboxAccount Метод закрытия счёта в песочнице. Тело запроса — CloseSandboxAccountRequest Тело ответа — CloseSandboxAccountResponse PostSandboxOrder Метод выставления торгового поручения в песочнице. Тело запроса — PostOrderRequest Тело ответа — PostOrderResponse ReplaceSandboxOrder Метод изменения выставленной заявки. Тело запроса — ReplaceOrderRequest Тело ответа — PostOrderResponse GetSandboxOrders Метод получения списка активных заявок по счёту в песочнице. Тело запроса — GetOrdersRequest Тело ответа — GetOrdersResponse CancelSandboxOrder Метод отмены торгового поручения в песочнице. Тело запроса — CancelOrderRequest Тело ответа — CancelOrderResponse GetSandboxOrderState Метод получения статуса заявки в песочнице. Заявки хранятся в таблице 7 дней. Тело запроса — GetOrderStateRequest Тело ответа — OrderState GetSandboxPositions Метод получения позиций по виртуальному счёту песочницы. Тело запроса — PositionsRequest Тело ответа — PositionsResponse GetSandboxOperations Метод получения операций в песочнице по номеру счёта. Тело запроса — OperationsRequest Тело ответа — OperationsResponse GetSandboxOperationsByCursor Метод получения операций в песочнице по номеру счета с пагинацией. Тело запроса — GetOperationsByCursorRequest Тело ответа — GetOperationsByCursorResponse GetSandboxPortfolio Метод получения портфолио в песочнице. Тело запроса — PortfolioRequest Тело ответа — PortfolioResponse SandboxPayIn Метод пополнения счёта в песочнице. Тело запроса — SandboxPayInRequest Тело ответа — SandboxPayInResponse GetSandboxWithdrawLimits Метод получения доступного остатка для вывода средств в песочнице. Тело запроса — WithdrawLimitsRequest Тело ответа — WithdrawLimitsResponse Сообщения методов OpenSandboxAccountRequest Запрос открытия счёта в песочнице. пустой запрос OpenSandboxAccountResponse Номер открытого счёта в песочнице. CloseSandboxAccountRequest Запрос закрытия счёта в песочнице. CloseSandboxAccountResponse Результат закрытия счёта в песочнице. пустой ответ SandboxPayInRequest Запрос пополнения счёта в песочнице. SandboxPayInResponse Результат пополнения счёта, текущий баланс."
  },
  {
    "h1": "Методы",
    "h2": "Нестандартные типы данных",
    "fragment": "MoneyValue Денежная сумма в определенной валюте Quotation Котировка - денежная сумма без указания валюты Что такое песочница? Песочница - это эмулятор торгов, в котором можно проверить торговый алгоритм, не выводя поручения на биржу и не рискуя реальными деньгами. При этом для работы с песочницей используется реальная биржевая информация. Подробнее о методах песочницы и алгоритмах исполнения заявок: песочница в TINKOFF INVEST API Как работает исполнение поручений в песочнице? Для исполнения заявок используются данные по последним сделкам биржи. Подробнее: Алгоритм исполнения заявок в песочнице Как считается средняя цена покупки инструмента в песочнице? В данный момент средняя цена покупки в песочнице не рассчитывается. Мы работаем над этим. Работают ли шорты в текущей песочнице? В текущей версии песочницы можно эмулировать торговлю в шорт. Однако при этом не производится расчётов шорта, баланс ценных бумаг в портфеле просто уходит в минус и не влечёт дополнительных расходов. Почему не работает расчёт маржинальных показателей счёта в песочнице? В данный момент в песочнице не производится расчёт дополнительных показателей счёта, ставок риска и размер гарантийного обеспечения. Баланс счёта в песочнице может быть отрицательным и это не влечёт никаких последствий (блокировка лимитов, маржинколл и т.п.) Почему заявка в песочнице не исполняется? Для исполнения заявок используются данные по последним сделкам биржи. Подробнее: Алгоритм исполнения заявок в песочнице. Поэтому исполнение поручений в песочнице напрямую зависит от активности рынка и стоимости актива на этом рынке. Лимитная заявка может не исполняться по причине недостижения установленной цены на бирже. Рыночная же может не исполняться по причине отсутствия сделок с данными инструментов (низкая ликвидность). У меня пропал счёт в песочнице, что делать? TINKOFF INVEST API не гарантирует долговременного хранения информации о счёте в песочнице. Если ваш счёт песочницы \"пропал\", создайте новый и продолжайте свои тесты."
  },
  {
    "h1": "Методы",
    "h2": "Метод получения доступного остатка для вывода средств в песочнице",
    "fragment": "getSandboxWithdrawLimits - Метод получения доступного остатка для вывода средств в песочнице отображает только список валютных позиций портфеля."
  },
  {
    "h1": "Методы",
    "h2": "Повторное выставление заявки в песочнице",
    "fragment": "ReplaceSandboxOrder - метод отмены и повторного выставления уже выставленной заявки."
  },
  {
    "h1": "Отличия работы методов в песочнице и на продовом контуре.",
    "h2": "Без подзаголовка",
    "fragment": "Все вызовы продового сервиса выполняются по адресу invest-public-api.tinkoff.ru:443. Все вызовы сервиса песочницы выполняются по адресу sandbox-invest-public-api.tinkoff.ru:443. Используя адрес песочницы Вы можете выполнять практически те же запросы, что и по адресу продового контура. Исключения в работе сервисов или методов описаны в таблице ниже. Это сделано для поддержания единообразия кода и легкости перехода из песочницы на продовый контур. Более детальные различия работы контуров описаны на странице. | Сервисы | Продовый контур | Песочница | |:--------------------------------------------------------------------------------------|:---------------:|:---------:| | Сервис инструментов | Да | Да | | Сервис аккаунтов | Да | Да | | getMarginAttributes | Да | Да | | Сервис операций | Да | Да | |getBrokerReport | Да | Да | |PortfolioStream | Да | Да | |PositionsStream | Да | Да | |getDividendsForeignIssuer | Да | Да | |getWithdrawLimits | Да | Да | | Сервис котировок | Да | Да | | Сервис стоп-заявок | Да | Нет | | Песочницы | Да | Да | | Сервис торговых поручений | Да | Да | |TradeStream | Да | Да | Важно! В песочнице также не рассчитывается комиссия, ликвидность портфеля, а также отсутствуют маржинальные показатели."
  },
  {
    "h1": "Ошибки TINKOFF INVEST API",
    "h2": "Без подзаголовка",
    "fragment": "Некоторые ошибки"
  }
]